<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Building Privacy-Protecting Infrastructure</title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="description" content="What is privacy-protecting infrastructure? Why do we need it and how we can build it? We&#x27;ll look at Waku, the communication layer for Web3. We&#x27;ll see how it uses ZKPs to incentivize and protect the Waku network. We&#x27;ll also look at Zerokit, a library that makes it easier to use ZKPs in different environments. After reading this, I hope you&#x27;ll better understand the importance of privacy-protecting infrastructure and how we can build it."/><link rel="shortcut icon" href="/assets/logo/vac/favicon.ico"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="vacp2p"/><meta name="twitter:site" content="@vacp2p"/><meta name="twitter:title" content="Building Privacy-Protecting Infrastructure"/><meta name="twitter:description" content="What is privacy-protecting infrastructure? Why do we need it and how we can build it? We&#x27;ll look at Waku, the communication layer for Web3. We&#x27;ll see how it uses ZKPs to incentivize and protect the Waku network. We&#x27;ll also look at Zerokit, a library that makes it easier to use ZKPs in different environments. After reading this, I hope you&#x27;ll better understand the importance of privacy-protecting infrastructure and how we can build it."/><meta name="twitter:image" content="https://staging.vac.dev/compiled-assets/img/building_private_infra_intro.png"/><meta property="og:url" content="https://staging.vac.dev//building-privacy-protecting-infrastructure"/><meta property="og:image" content="https://staging.vac.dev/compiled-assets/img/building_private_infra_intro.png"/><meta property="og:site_name" content="Building Privacy-Protecting Infrastructure"/><meta property="og:title" content="Building Privacy-Protecting Infrastructure"/><meta property="og:description" content="What is privacy-protecting infrastructure? Why do we need it and how we can build it? We&#x27;ll look at Waku, the communication layer for Web3. We&#x27;ll see how it uses ZKPs to incentivize and protect the Waku network. We&#x27;ll also look at Zerokit, a library that makes it easier to use ZKPs in different environments. After reading this, I hope you&#x27;ll better understand the importance of privacy-protecting infrastructure and how we can build it."/><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/e068b41030ceede6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e068b41030ceede6.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cdd95df0746869ac.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cdd95df0746869ac.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-a14325fd952bf0eb.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-ada0258e433ba222.js" defer=""></script><script src="/_next/static/chunks/pages/_app-91f05ffa21c9a6ec.js" defer=""></script><script src="/_next/static/chunks/eb1842f2-90eb16656390ba2a.js" defer=""></script><script src="/_next/static/chunks/399-b4b9981c243e7c94.js" defer=""></script><script src="/_next/static/chunks/108-374a17adb21bb412.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...path%5D%5D-9c3054039bf889f4.js" defer=""></script><script src="/_next/static/-5vfLOflCSkQPJRugO7ZO/_buildManifest.js" defer=""></script><script src="/_next/static/-5vfLOflCSkQPJRugO7ZO/_ssgManifest.js" defer=""></script><script src="/_next/static/-5vfLOflCSkQPJRugO7ZO/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><svg width="0" height="0" xmlns="http://www.w3.org/2000/svg" style="display:none"><defs><filter id="colored"><feColorMatrix type="matrix" values="1.00 0 0 0 0 0 1.00 0 0 0 0 0 1.00 0 0 0 0 0 1 0"></feColorMatrix></filter></defs></svg><style nonce="logos">
      #nprogress {
        pointer-events: none;
      }
      #nprogress .bar {
        background: #000000;
        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
      }
      #nprogress .peg {
        display: block;
        position: absolute;
        right: 0px;
        width: 100px;
        height: 100%;
        box-shadow: 0 0 10px #000000, 0 0 5px #000000;
        opacity: 1;
        -webkit-transform: rotate(3deg) translate(0px, -4px);
        -ms-transform: rotate(3deg) translate(0px, -4px);
        transform: rotate(3deg) translate(0px, -4px);
      }
      #nprogress .spinner {
        display: block;
        position: fixed;
        z-index: 1031;
        top: 15px;
        right: 15px;
      }
      #nprogress .spinner-icon {
        width: 18px;
        height: 18px;
        box-sizing: border-box;
        border: solid 2px transparent;
        border-top-color: #000000;
        border-left-color: #000000;
        border-radius: 50%;
        -webkit-animation: nprogresss-spinner 400ms linear infinite;
        animation: nprogress-spinner 400ms linear infinite;
      }
      .nprogress-custom-parent {
        overflow: hidden;
        position: relative;
      }
      .nprogress-custom-parent #nprogress .spinner,
      .nprogress-custom-parent #nprogress .bar {
        position: absolute;
      }
      @-webkit-keyframes nprogress-spinner {
        0% {
          -webkit-transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
        }
      }
      @keyframes nprogress-spinner {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style><div class="Style_container__qv2Yk Styles_common_container__u_XHj template-container"><header class="Styles_container__5FUI_ Style_header__IYvBP undefined"><div class="Styles_innerWrapper__ZInvp"><div class="logo-holder button vac" style="display:inline-block"><svg width="45" height="43" viewBox="0 0 35 43" fill="none" xmlns="http://www.w3.org/2000/svg" class="vac-logo"><g clip-path="url(#clip0_917_3082)"><path d="M24.9034 14.8217C24.6824 11.2666 23.5308 7.8298 21.5623 4.84994C22.543 4.19721 23.7374 3.93844 24.9034 4.12603C25.492 4.23064 26.0472 4.4722 26.5233 4.83086C26.9994 5.18951 27.3828 5.65504 27.6421 6.18916C28.0141 7.1512 28.1335 8.19117 27.989 9.21147C27.9754 9.6728 27.8955 10.1299 27.7516 10.5688C27.6613 10.8504 27.5322 11.1183 27.3682 11.3651C27.166 11.69 26.9466 12.0041 26.7109 12.3062C26.1084 13.1206 25.5607 14.0073 24.9034 14.8217Z" fill="#999999"></path><path d="M16.7058 7.58268C15.8382 5.99003 14.5344 4.67263 12.9447 3.78217L10.9546 2.69631C10.9546 2.69631 13.2551 -0.778436 16.1945 0.162641C19.134 1.10372 18.1846 7.4017 17.5821 9.80869" fill="#4D4D4D"></path><path d="M20.3209 41.6243C17.4179 40.4118 16.2129 38.3668 14.6975 36.919C13.1821 35.4711 12.8717 29.3903 13.1638 24.6126C13.456 19.8348 17.4909 11.528 17.5822 9.80869C17.6735 8.08941 15.4643 5.17569 13.5655 3.78217C11.6491 2.2631 9.29769 1.38272 6.84668 1.2666L8.36207 2.51534C9.74965 3.67359 9.42101 3.98125 9.22018 6.26155C9.01935 8.54185 8.72722 15.6904 8.70896 21.8436C8.70896 30.3495 6.73713 32.7022 13.0178 38.8373C14.1564 40.1358 15.6863 41.0368 17.3814 41.4072C21.6902 43.036 24.228 43.2712 20.3209 41.6243Z" fill="#1A1A1A"></path><path d="M17.9839 7.07618C17.5904 9.58823 16.8212 12.0281 15.7016 14.3152C14.6765 16.6746 13.7925 19.0918 13.0543 21.5543C12.076 25.3846 11.8405 29.3642 12.3605 33.2816C12.4325 34.6426 12.8065 35.9712 13.4559 37.1726C14.1362 38.1272 14.9759 38.9596 15.939 39.6338C17.8321 41.3312 20.1651 42.4718 22.6761 42.9276C20.068 40.8547 18.189 38.0165 17.3083 34.8199C16.3002 31.5246 16.6412 27.9684 18.2577 24.9205C18.7142 24.0699 19.2436 23.2555 19.7731 22.4411L24.4653 15.3287C24.7022 15.0187 24.8815 14.6694 24.9948 14.2971C25.0769 13.891 25.0769 13.4727 24.9948 13.0665C24.3347 9.48034 22.792 6.11109 20.5034 3.25758C19.9266 2.35717 19.1529 1.59688 18.2395 1.033C17.3262 0.46911 16.2966 0.116066 15.2269 0C15.7121 0.03052 16.1783 0.198543 16.5699 0.484084C16.9616 0.769625 17.2622 1.16066 17.4361 1.61069C17.8159 2.51034 18.0085 3.47679 18.0021 4.45202C18.0507 5.32627 18.0446 6.20267 17.9839 7.07618Z" fill="#808080"></path><path d="M34.927 21.7174C34.8742 21.5895 34.8068 21.4681 34.7261 21.3554C34.5725 21.0145 34.3893 20.6875 34.1784 20.3781C34.0141 20.1429 33.8315 19.9257 33.6489 19.7085C33.2107 19.1294 33.0829 18.3874 32.5352 17.8988C32.2726 17.6504 32.0907 17.33 32.0126 16.9787C31.9346 16.6273 31.964 16.2609 32.097 15.9261C32.2066 15.6366 32.4074 15.4013 32.5352 15.1298C32.6706 14.7258 32.7195 14.2982 32.6786 13.8744C32.6378 13.4505 32.5081 13.0398 32.2979 12.6685C31.7956 11.6016 31.1838 10.5888 30.4721 9.64624C29.5227 8.32511 28.5185 7.05828 27.4596 5.82764C27.6672 6.89431 27.6423 7.99266 27.3865 9.04902C27.2386 9.62495 27.0432 10.1879 26.8023 10.7321C26.4264 11.4007 26.0118 12.0473 25.5608 12.6685C23.2238 16.2881 20.832 19.9076 18.349 23.4004C17.0435 25.5573 16.3321 28.0161 16.2859 30.5309C16.0848 32.9993 16.618 35.472 17.8195 37.6433C18.5687 38.8742 19.4502 40.021 20.4486 41.0637C21.0694 41.7334 21.7814 42.8735 22.6395 43.0726C22.7491 42.041 22.9499 40.6475 23.096 39.6159C23.3338 37.934 23.8782 36.3089 24.7027 34.8201C25.1895 33.7601 26.0543 32.9158 27.1309 32.4493C27.9135 32.2862 28.7218 32.2862 29.5044 32.4493C29.9422 32.4221 30.3812 32.4221 30.819 32.4493C31.2686 32.4735 31.7149 32.3597 32.097 32.1235C32.3186 31.968 32.5024 31.7655 32.6351 31.5307C32.7677 31.2959 32.8459 31.0347 32.8638 30.7662C32.9186 30.2791 32.9186 29.7874 32.8638 29.3003C32.8245 28.9868 32.8685 28.6686 32.9916 28.3773C33.2473 27.8525 34.0141 27.6172 34.0689 27.02C34.0476 26.7523 33.9665 26.4927 33.8315 26.2599C33.7604 26.1456 33.7228 26.014 33.7228 25.8798C33.7228 25.7456 33.7604 25.614 33.8315 25.4998C33.8315 25.4998 34.0506 25.355 34.1236 25.2464C34.2051 25.1396 34.2492 25.0093 34.2492 24.8754C34.2492 24.7415 34.2051 24.6112 34.1236 24.5044C33.9428 24.2955 33.8006 24.0566 33.7037 23.7986C33.695 23.6656 33.715 23.5323 33.7622 23.4075C33.8094 23.2827 33.8828 23.1692 33.9776 23.0747C34.1732 22.888 34.3945 22.7295 34.6348 22.6041C34.7511 22.5516 34.8541 22.4739 34.9362 22.3769C35.0183 22.2798 35.0776 22.1658 35.1095 22.0431C35.0688 21.9246 35.0069 21.8143 34.927 21.7174Z" fill="#CCCCCC"></path><path d="M34.3062 20.5771C34.478 20.8248 34.619 21.0922 34.7261 21.3734C34.8037 21.4816 34.8709 21.5967 34.9269 21.7173L34.3062 20.5771Z" fill="#CCCCCC"></path><path d="M10.133 33.4262C9.0523 28.5693 8.7138 23.5789 9.12886 18.6223C9.12886 16.1429 11.265 2.44302 7.79605 1.41145C4.85656 0.524668 2.53783 3.94512 2.53783 3.94512C0.667683 7.68216 -0.206002 11.8316 1.36513e-05 15.9982C2.30048 38.8193 17.6735 41.4615 18.2577 41.7149C18.2577 41.7149 11.4476 39.2898 10.133 33.4262Z" fill="#09212A"></path></g><defs><clipPath id="clip0_917_3082"><rect width="35" height="43"></rect></clipPath></defs></svg></div><div class="Styles_searchBox__5X2m1"><div class="Styles_container__ddCFx "><div class="logos-search-box Styles_searchBox__xWHyX"><div><input type="text" placeholder="Search Vac Research" value=""/></div></div></div></div></div></header><div class="page-info"><h1 style="display:none">Vac Research</h1><div class="page-info-sub"><i>Mar 16 2023</i><br/><span>staging.vac.dev</span></div></div><main class="undefined Styles_common_main__4v7gP Styles_common_main__4v7gP"><aside class="Styles_container__3yUcn Style_sidebar__mLS5A Styles_common_sidebar__QAVov hidden-scroll Styles_hideDesktopToggleButton__L_Rik"><div class="sidebar-toggle-button button Styles_mobile___qAwf"><svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 4h14c.55 0 1-.45 1-1s-.45-1-1-1H1c-.55 0-1 .45-1 1s.45 1 1 1Zm14 8H1c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1Zm0-5H1c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1Z" fill="#F2F2F2"></path></svg></div><div class="logo-holder button vac" style="display:inline-block"><svg width="45" height="43" viewBox="0 0 35 43" fill="none" xmlns="http://www.w3.org/2000/svg" class="vac-logo"><g clip-path="url(#clip0_917_3082)"><path d="M24.9034 14.8217C24.6824 11.2666 23.5308 7.8298 21.5623 4.84994C22.543 4.19721 23.7374 3.93844 24.9034 4.12603C25.492 4.23064 26.0472 4.4722 26.5233 4.83086C26.9994 5.18951 27.3828 5.65504 27.6421 6.18916C28.0141 7.1512 28.1335 8.19117 27.989 9.21147C27.9754 9.6728 27.8955 10.1299 27.7516 10.5688C27.6613 10.8504 27.5322 11.1183 27.3682 11.3651C27.166 11.69 26.9466 12.0041 26.7109 12.3062C26.1084 13.1206 25.5607 14.0073 24.9034 14.8217Z" fill="#999999"></path><path d="M16.7058 7.58268C15.8382 5.99003 14.5344 4.67263 12.9447 3.78217L10.9546 2.69631C10.9546 2.69631 13.2551 -0.778436 16.1945 0.162641C19.134 1.10372 18.1846 7.4017 17.5821 9.80869" fill="#4D4D4D"></path><path d="M20.3209 41.6243C17.4179 40.4118 16.2129 38.3668 14.6975 36.919C13.1821 35.4711 12.8717 29.3903 13.1638 24.6126C13.456 19.8348 17.4909 11.528 17.5822 9.80869C17.6735 8.08941 15.4643 5.17569 13.5655 3.78217C11.6491 2.2631 9.29769 1.38272 6.84668 1.2666L8.36207 2.51534C9.74965 3.67359 9.42101 3.98125 9.22018 6.26155C9.01935 8.54185 8.72722 15.6904 8.70896 21.8436C8.70896 30.3495 6.73713 32.7022 13.0178 38.8373C14.1564 40.1358 15.6863 41.0368 17.3814 41.4072C21.6902 43.036 24.228 43.2712 20.3209 41.6243Z" fill="#1A1A1A"></path><path d="M17.9839 7.07618C17.5904 9.58823 16.8212 12.0281 15.7016 14.3152C14.6765 16.6746 13.7925 19.0918 13.0543 21.5543C12.076 25.3846 11.8405 29.3642 12.3605 33.2816C12.4325 34.6426 12.8065 35.9712 13.4559 37.1726C14.1362 38.1272 14.9759 38.9596 15.939 39.6338C17.8321 41.3312 20.1651 42.4718 22.6761 42.9276C20.068 40.8547 18.189 38.0165 17.3083 34.8199C16.3002 31.5246 16.6412 27.9684 18.2577 24.9205C18.7142 24.0699 19.2436 23.2555 19.7731 22.4411L24.4653 15.3287C24.7022 15.0187 24.8815 14.6694 24.9948 14.2971C25.0769 13.891 25.0769 13.4727 24.9948 13.0665C24.3347 9.48034 22.792 6.11109 20.5034 3.25758C19.9266 2.35717 19.1529 1.59688 18.2395 1.033C17.3262 0.46911 16.2966 0.116066 15.2269 0C15.7121 0.03052 16.1783 0.198543 16.5699 0.484084C16.9616 0.769625 17.2622 1.16066 17.4361 1.61069C17.8159 2.51034 18.0085 3.47679 18.0021 4.45202C18.0507 5.32627 18.0446 6.20267 17.9839 7.07618Z" fill="#808080"></path><path d="M34.927 21.7174C34.8742 21.5895 34.8068 21.4681 34.7261 21.3554C34.5725 21.0145 34.3893 20.6875 34.1784 20.3781C34.0141 20.1429 33.8315 19.9257 33.6489 19.7085C33.2107 19.1294 33.0829 18.3874 32.5352 17.8988C32.2726 17.6504 32.0907 17.33 32.0126 16.9787C31.9346 16.6273 31.964 16.2609 32.097 15.9261C32.2066 15.6366 32.4074 15.4013 32.5352 15.1298C32.6706 14.7258 32.7195 14.2982 32.6786 13.8744C32.6378 13.4505 32.5081 13.0398 32.2979 12.6685C31.7956 11.6016 31.1838 10.5888 30.4721 9.64624C29.5227 8.32511 28.5185 7.05828 27.4596 5.82764C27.6672 6.89431 27.6423 7.99266 27.3865 9.04902C27.2386 9.62495 27.0432 10.1879 26.8023 10.7321C26.4264 11.4007 26.0118 12.0473 25.5608 12.6685C23.2238 16.2881 20.832 19.9076 18.349 23.4004C17.0435 25.5573 16.3321 28.0161 16.2859 30.5309C16.0848 32.9993 16.618 35.472 17.8195 37.6433C18.5687 38.8742 19.4502 40.021 20.4486 41.0637C21.0694 41.7334 21.7814 42.8735 22.6395 43.0726C22.7491 42.041 22.9499 40.6475 23.096 39.6159C23.3338 37.934 23.8782 36.3089 24.7027 34.8201C25.1895 33.7601 26.0543 32.9158 27.1309 32.4493C27.9135 32.2862 28.7218 32.2862 29.5044 32.4493C29.9422 32.4221 30.3812 32.4221 30.819 32.4493C31.2686 32.4735 31.7149 32.3597 32.097 32.1235C32.3186 31.968 32.5024 31.7655 32.6351 31.5307C32.7677 31.2959 32.8459 31.0347 32.8638 30.7662C32.9186 30.2791 32.9186 29.7874 32.8638 29.3003C32.8245 28.9868 32.8685 28.6686 32.9916 28.3773C33.2473 27.8525 34.0141 27.6172 34.0689 27.02C34.0476 26.7523 33.9665 26.4927 33.8315 26.2599C33.7604 26.1456 33.7228 26.014 33.7228 25.8798C33.7228 25.7456 33.7604 25.614 33.8315 25.4998C33.8315 25.4998 34.0506 25.355 34.1236 25.2464C34.2051 25.1396 34.2492 25.0093 34.2492 24.8754C34.2492 24.7415 34.2051 24.6112 34.1236 24.5044C33.9428 24.2955 33.8006 24.0566 33.7037 23.7986C33.695 23.6656 33.715 23.5323 33.7622 23.4075C33.8094 23.2827 33.8828 23.1692 33.9776 23.0747C34.1732 22.888 34.3945 22.7295 34.6348 22.6041C34.7511 22.5516 34.8541 22.4739 34.9362 22.3769C35.0183 22.2798 35.0776 22.1658 35.1095 22.0431C35.0688 21.9246 35.0069 21.8143 34.927 21.7174Z" fill="#CCCCCC"></path><path d="M34.3062 20.5771C34.478 20.8248 34.619 21.0922 34.7261 21.3734C34.8037 21.4816 34.8709 21.5967 34.9269 21.7173L34.3062 20.5771Z" fill="#CCCCCC"></path><path d="M10.133 33.4262C9.0523 28.5693 8.7138 23.5789 9.12886 18.6223C9.12886 16.1429 11.265 2.44302 7.79605 1.41145C4.85656 0.524668 2.53783 3.94512 2.53783 3.94512C0.667683 7.68216 -0.206002 11.8316 1.36513e-05 15.9982C2.30048 38.8193 17.6735 41.4615 18.2577 41.7149C18.2577 41.7149 11.4476 39.2898 10.133 33.4262Z" fill="#09212A"></path></g><defs><clipPath id="clip0_917_3082"><rect width="35" height="43"></rect></clipPath></defs></svg></div><div class="Styles_desktop__VH2y3 defaultSidebar Styles_container__4YC7p"><nav class="sidebarNav hidden-scroll"><ul class="sidebar-menu mainMenu Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-0"><span></span><ul class="sidebar-menu  Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Main" href="/">Main</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="principles" href="/principles">Principles</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Research areas" href="/research-areas">Research areas</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Projects" href="/projects">Projects</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Open Research Problems" href="/open-problems">Open Research Problems</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="publications" href="/publications">Publications</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="contribute" href="/contribute">Contribute</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="media" href="/media">Media</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li></ul><br/></li></ul><br/><ul class="sidebar-menu subMenu Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-0"><a class="" title="research" href="/research">Research</a><ul class="sidebar-menu  Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Waku for All Decentralized Applications and Infrastructures" href="/waku-for-all">Waku for All Decentralized Applications and Infrastructures</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="active" title="Building Privacy-Protecting Infrastructure" href="/building-privacy-protecting-infrastructure">Building Privacy-Protecting Infrastructure</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay" href="/wakuv2-relay-anon">Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Noise handshakes as key-exchange mechanism for Waku" href="/wakuv2-noise">Noise handshakes as key-exchange mechanism for Waku</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Waku v2 Ambient Peer Discovery" href="/wakuv2-apd">Waku v2 Ambient Peer Discovery</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Introducing nwaku" href="/introducing-nwaku">Introducing nwaku</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Opinion: Pseudo-ethics in the Surveillance Tech Industry" href="/ethics-surveillance-tech">Opinion: Pseudo-ethics in the Surveillance Tech Industry</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li><span class="button">...</span></li></ul><br/></li></ul><div class="external_links"><div><div class="menuitem-title"><span class="cap">Resources</span></div><ul><li><a href="https://rfc.vac.dev/" target="_blank">&gt; Specs/RFCs</a></li><li><a href="https://forum.vac.dev/" target="_blank">&gt; Forum</a></li><li><a href="https://waku.org" target="_blank">&gt; Waku.org</a></li></ul></div></div></nav></div></aside><article class="Styles_container__pG0bG Style_content__NTXHZ Styles_common_content__Myi5Z"><div class="Style_container__qc2tD"><h2 class="Style_container__eSI4Q serif">Building Privacy-Protecting Infrastructure</h2><div class="serif"><i>Nov 04 2022</i><i> - </i>by<!-- --><a title="oskarth" href="/authors/oskarth"><span><i> <!-- -->oskarth<!-- --></i></span></a></div></div><p><em>This write-up is based on a talk given at DevCon 6 in Bogota, a video can be found <!-- --><a href="https://www.youtube.com/watch?v=CW1DYJifdhs">here<!-- --></a></em></p>
<!-- --><h3><a class="anchor" id="intro"></a><a class="ha" href="#intro">Intro<!-- --></a></h3>
<!-- --><p>In this write-up, we are going to talk about building privacy-protecting
infrastructure.  What is it, why do we need it and how can we build it?<!-- --></p>
<!-- --><p>We&#x27;ll look at Waku, the communication layer for Web3. We&#x27;ll look at how we are
using Zero Knowledge (ZK) technology to incentivize and protect the Waku
network. We&#x27;ll also look at Zerokit, a library we are writing to make ZKP easier
to use in different environments.<!-- --></p>
<!-- --><p>At the end of this write-up, I hope you&#x27;ll come away with an understanding of
the importance of privacy-protecting infrastructure and how we can build it.<!-- --></p>
<!-- --><h3><a class="anchor" id="about"></a><a class="ha" href="#about">About<!-- --></a></h3>
<!-- --><p>First, briefly about Vac. We build public good protocols for the decentralized
web, with a focus on privacy and communication. We do applied research based on
which we build protocols, libraries and publications. We are also the custodians
of protocols that reflect a set of principles.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/building_private_infra_principles.png" alt="Principles"/><figcaption>Principles<!-- --></figcaption></figure>
<!-- --><p>It has its origins in the <!-- --><a href="https://status.im/">Status app<!-- --></a> and trying to improve
the underlying protocols and infrastructure. We build <!-- --><a href="https://waku.org/">Waku<!-- --></a>,
among other things.<!-- --></p>
<!-- --><h3><a class="anchor" id="why-build-privacy-protecting-infrastructure"></a><a class="ha" href="#why-build-privacy-protecting-infrastructure">Why build privacy-protecting infrastructure?<!-- --></a></h3>
<!-- --><p>Privacy is the power to selectively reveal yourself. It is a requirement for
freedom and self-determination.<!-- --></p>
<!-- --><p>Just like you need decentralization in order to get censorship-resistance, you
need privacy to enable freedom of expression.<!-- --></p>
<!-- --><p>To build applications that are decentralized and privacy-protecting, you need
the base layer, the infrastructure itself, to have those properties.<!-- --></p>
<!-- --><p>We see this a lot. It is easier to make trade-offs at the application layer than
doing them at the base layer. You can build custodial solutions on top of a
decentralized and non-custodial network where participants control their own
keys, but you can&#x27;t do the opposite.<!-- --></p>
<!-- --><p>If you think about it, buildings can be seen as a form of privacy-protecting
infrastructure. It is completely normal and obvious in many ways, but when it
comes to the digital realm our mental models and way of speaking about it hasn&#x27;t
caught up yet for most people.<!-- --></p>
<!-- --><p>I&#x27;m not going too much more into the need for privacy or what happens when you
don&#x27;t have it, but suffice to say it is an important property for any open
society.<!-- --></p>
<!-- --><p>When we have conversations, true peer-to-peer offline conversations, we can talk
privately. If we use cash to buy things we can do commerce privately.<!-- --></p>
<!-- --><p>On the Internet, great as it is, there are a lot of forces that makes this
natural state of things not the default. Big Tech has turned users into a
commodity, a product, and monetized user&#x27;s attention for advertising. To
optimize for your attention they need to surveil your habits and activities, and
hence breach your privacy. As opposed to more old-fashioned models, where
someone is buying a useful service from a company and the incentives are more
aligned.<!-- --></p>
<!-- --><p>We need to build credibly neutral infrastructure that protects your privacy at
the base layer, in order to truly enable applications that are
censorship-resistant and encourage meaningful freedom of expression.<!-- --></p>
<!-- --><h3><a class="anchor" id="web3-infrastructure"></a><a class="ha" href="#web3-infrastructure">Web3 infrastructure<!-- --></a></h3>
<!-- --><p>Infrastructure is what lies underneath. Many ways of looking at this but I&#x27;ll
keep it simple as per the original Web3 vision. You had Ethereum for
compute/consensus, Swarm for storage, and Whisper for messaging. Waku has taken
over the mantle from Whisper and is a lot more
<!-- --><a href="https://vac.dev/fixing-whisper-with-waku">usable<!-- --></a> today than Whisper ever was,
for many reasons.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/web3_holy_trinity.png" alt="Web3 Infrastructure"/><figcaption>Web3 Infrastructure<!-- --></figcaption></figure>
<!-- --><p>On the privacy-front, we see how Ethereum is struggling. It is a big UX problem,
especially when you try to add privacy back &quot;on top&quot;. It takes a lot of effort
and it is easier to censor. We see this with recent action around Tornado Cash.
Compare this with something like Zcash or Monero, where privacy is there by
default.<!-- --></p>
<!-- --><p>There are also problems when it comes to the p2p networking side of things, for
example with Ethereum validator privacy and hostile actors and jurisdictions. If
someone can easily find out where a certain validator is physically located,
that&#x27;s a problem in many parts of the world. Being able to have stronger
privacy-protection guarantees would be very useful for high-value targets.<!-- --></p>
<!-- --><p>This doesn&#x27;t begin to touch on the so called &quot;dapps&quot; that make a lot of
sacrifices in how they function, from the way domains work, to how websites are
hosted and the reliance on centralized services for communication. We see this
time and time again, where centralized, single points of failure systems work
for a while, but then eventually fail.<!-- --></p>
<!-- --><p>In many cases an individual user might not care enough though, and for platforms
the lure to take shortcuts is strong. That is why it is important to be
principled, but also pragmatic in terms of the trade-offs that you allow on top.
We&#x27;ll touch more on this in the design goals around modularity that Waku has.<!-- --></p>
<!-- --><h3><a class="anchor" id="zk-for-privacy-protecting-infrastructure"></a><a class="ha" href="#zk-for-privacy-protecting-infrastructure">ZK for privacy-protecting infrastructure<!-- --></a></h3>
<!-- --><p>ZKPs are a wonderful new tool. Just like smart contracts enables programmable
money, ZKPs allow us to express fundamentally new things. In line with the great
tradition of trust-minimization, we can prove statement while revealing the
absolute minimum information necessary. This fits the definition of privacy, the
power to selectively reveal yourself, perfectly. I&#x27;m sure I don&#x27;t need to tell
anyone reading this but this is truly revolutionary. The technology is advancing
extremely fast and often it is our imagination that is the limit.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/building_private_infra_zk.png" alt="Zero knowledge"/><figcaption>Zero knowledge<!-- --></figcaption></figure>
<!-- --><h3><a class="anchor" id="waku"></a><a class="ha" href="#waku">Waku<!-- --></a></h3>
<!-- --><p>What is Waku? It is a set of modular protocols for p2p communication. It has a
focus on privacy, security and being able to run anywhere. It is the spiritual
success to Whisper.<!-- --></p>
<!-- --><p>By modular we mean that you can pick and choose protocols and how you use them
depending on constraints and trade-offs. For example, bandwidth usage vs
privacy.<!-- --></p>
<!-- --><p>It is designed to work in resource restricted environments, such as mobile
phones and in web browsers. It is important that infrastructure meets users
where they are and supports their real-world use cases. Just like you don&#x27;t need
your own army and a castle to have your own private bathroom, you shouldn&#x27;t need
to have a powerful always-on node to get reasonable privacy and
censorship-resistance. We might call this self-sovereignty.<!-- --></p>
<!-- --><h3><a class="anchor" id="waku---adaptive-nodes"></a><a class="ha" href="#waku---adaptive-nodes">Waku - adaptive nodes<!-- --></a></h3>
<!-- --><p>One way of looking at Waku is as an open service network. There are nodes with
varying degrees of capabilities and requirements. For example when it comes to
bandwidth usage, storage, uptime, privacy requirements, latency requirements,
and connectivity restrictions.<!-- --></p>
<!-- --><p>We have a concept of adaptive nodes that can run a variety of protocols. A node
operator can choose which protocols they want to run. Naturally, there&#x27;ll be
some nodes that do more consumption and other nodes that do more provisioning.
This gives rise to the idea of a service network, where services are provided
for and consumed.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/building_private_infra_adaptive.png" alt="Adaptive Nodes"/><figcaption>Adaptive Nodes<!-- --></figcaption></figure>
<!-- --><h3><a class="anchor" id="waku---protocol-interactions"></a><a class="ha" href="#waku---protocol-interactions">Waku - protocol interactions<!-- --></a></h3>
<!-- --><p>There are many protocols that interact. Waku Relay protocol is based on libp2p
GossipSub for p2p messaging. We have filter for bandwidth-restricted nodes to
only receive subset of messages. Lightpush for nodes with short connection
windows to push messages into network. Store for nodes that want to retrieve
historical messages.<!-- --></p>
<!-- --><p>On the payload layer, we provide support for Noise handshakes/key-exchanges.
This means that as a developers, you can get end-to-end encryption and expected
guarantees out of the box. We have support for setting up a secure channel from
scratch, and all of this paves the way for providing Signal&#x27;s Double Ratchet at
the protocol level much easier. We also have experimental support for
multi-device usage. Similar features have existed in for example the Status app
for a while, but with this we make it easier for any platform using Waku to use
it.<!-- --></p>
<!-- --><p>There are other protocols too, related to peer discovery, topic usage, etc. See
<!-- --><a href="https://rfc.vac.dev/">specs<!-- --></a> for more details.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/building_private_infra_interactions.png" alt="Protocol Interactions"/><figcaption>Protocol Interactions<!-- --></figcaption></figure>
<!-- --><h3><a class="anchor" id="waku---network"></a><a class="ha" href="#waku---network">Waku - Network<!-- --></a></h3>
<!-- --><p>For the Waku network, there are a few problems. For example, when it comes to
network spam and incentivizing service nodes. We want to address these while
keeping privacy-guarantees of the base layer. I&#x27;m going to go into both of
these.<!-- --></p>
<!-- --><p>The spam problem arises on the gossip layer when anyone can overwhelm the
network with messages. The service incentivization is a problem when nodes don&#x27;t
directly benefit from the provisioning of a certain service. This can happen if
they are not using the protocol directly themselves as part of normal operation,
or if they aren&#x27;t socially inclined to provide a certain service. This depends a
lot on how an individual platform decides to use the network.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/building_private_infra_network.png" alt="Waku Network"/><figcaption>Waku Network<!-- --></figcaption></figure>
<!-- --><h3><a class="anchor" id="dealing-with-network-spam-and-rln-relay"></a><a class="ha" href="#dealing-with-network-spam-and-rln-relay">Dealing with network spam and RLN Relay<!-- --></a></h3>
<!-- --><p>Since the p2p relay network is open to anyone, there is a problem with spam. If
we look at existing solutions for dealing with spam in traditional messaging
systems, a lot of entities like Google, Facebook, Twitter, Telegram, Discord use
phone number verification. While this is largely sybil-resistant, it is
centralized and not private at all.<!-- --></p>
<!-- --><p>Historically, Whisper used PoW which isn&#x27;t good for heterogenerous networks.
Peer scoring is open to sybil attacks and doesn&#x27;t directly address spam
protection in an anonymous p2p network.<!-- --></p>
<!-- --><p>The key idea here is to use RLN for private economic spam protection using
zkSNARKs.<!-- --></p>
<!-- --><p>I&#x27;m not going to go into too much detail of RLN here. If you are interested, I
gave a <!-- --><a href="https://www.youtube.com/watch?v=g41nHQ0mLoA">talk<!-- --></a> in Amsterdam at
Devconnect about this. We have some write-ups on RLN
<!-- --><a href="https://vac.dev/rln-relay">here<!-- --></a> by Sanaz who has been pushing a lot of this
from our side. There&#x27;s also another talk at Devcon by Tyler going into RLN in
more detail. Finally, here&#x27;s the <!-- --><a href="https://rfc.vac.dev/spec/32/">RLN spec<!-- --></a>.<!-- --></p>
<!-- --><p>I&#x27;ll briefly go over what it is, the interface and circuit and then talk about
how it is used in Waku.<!-- --></p>
<!-- --><h3><a class="anchor" id="rln---overview-and-flow"></a><a class="ha" href="#rln---overview-and-flow">RLN - Overview and Flow<!-- --></a></h3>
<!-- --><p>RLN stands for Rate Limiting Nullifier. It is an anonyomous rate limiting
mechanism based on zkSNARKs. By rate limiting we mean you can only send N
messages in a given period. By anonymity we mean that you can&#x27;t link message to
a publisher. We can think of it as a voting booth, where you are only allowed to
vote once every election.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/building_private_infra_vote.png" alt="Voting Booth"/><figcaption>Voting Booth<!-- --></figcaption></figure>
<!-- --><p>It can be used for spam protection in p2p messaging systems, and also rate
limiting in general, such as for a decentralized captcha.<!-- --></p>
<!-- --><p>There are three parts to it. You register somewhere, then you can signal and
finally there&#x27;s a verification/slashing phase. You put some capital at risk,
either economic or social, and if you double signal you get slashed.<!-- --></p>
<!-- --><h3><a class="anchor" id="rln---circuit"></a><a class="ha" href="#rln---circuit">RLN - Circuit<!-- --></a></h3>
<!-- --><p>Here&#x27;s what the private and public inputs to the circuit look like. The identity
secret is generated locally, and we create an identity commitment that is
inserted into a Merkle tree. We then use Merkle proofs to prove membership.
Registered member can only signal once for a given epoch or external nullifier,
for example every ten seconds in Unix time. RLN identifer is for a specific RLN
app.<!-- --></p>
<!-- --><p>We also see what the circuit output looks like. This is calculated locally. <!-- --><code>y</code>
is a share of the secret equation, and the (internal) nullifier acts as a unique
fingerprint for a given app/user/epoch combination. How do we calculate <!-- --><code>y</code> and
the internal nullifier?<!-- --></p>
<!-- --><pre><code>// Private input
signal input identity_secret;
signal input path_elements[n_levels][1];
signal input identity_path_index[n_levels];

// Public input
signal input x; // signal_hash
signal input epoch; // external_nullifier
signal input rln_identifier;

// Circuit output
signal output y;
signal output root;
signal output nullifier;
</code></pre>
<!-- --><h3><a class="anchor" id="rln---shamirs-secret-sharing"></a><a class="ha" href="#rln---shamirs-secret-sharing">RLN - Shamir&#x27;s secret sharing<!-- --></a></h3>
<!-- --><p>This is done using <!-- --><a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing">Shamir&#x27;s secret
sharing<!-- --></a>. Shamirâ€™s
secret sharing is based on idea of splitting a secret into shares. This is how
we enable slashing of funds.<!-- --></p>
<!-- --><p>In this case, we have two shares. If a given identity <!-- --><code>a0</code> signals twice in
epoch/external nullifier, <!-- --><code>a1</code> is the same. For a given RLN app,
<!-- --><code>internal_nullifier</code> then stays the same. <!-- --><code>x</code> is signal hash which is different,
and <!-- --><code>y</code> is public, so we can reconstruct <!-- --><code>identity_secret</code>. With the identity
secret revealed, this gives access to e.g. financial stake.<!-- --></p>
<!-- --><pre><code>a_0 = identity_secret // secret S
a_1 = poseidonHash([a0, external_nullifier])

y = a_0 + x * a_1

internal_nullifier = poseidonHash([a_1, rln_identifier])
</code></pre>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/building_private_infra_shamir.png" alt="Shamir&#x27;s secret sharing"/><figcaption>Shamir&#x27;s secret sharing<!-- --></figcaption></figure>
<!-- --><h3><a class="anchor" id="rln-relay"></a><a class="ha" href="#rln-relay">RLN Relay<!-- --></a></h3>
<!-- --><p>This is how RLN is used with Relay/GossipSub protocol. A node registers and
locks up funds, and after that it can send messages. It publishes a message
containing the Zero Knowledge proof and some other details.<!-- --></p>
<!-- --><p>Each relayer node listens to the membership contract for new members, and it
also keeps track of relevant metadata and merkle tree. Metadata is needed to be
able to detect double signaling and perform slashing.<!-- --></p>
<!-- --><p>Before forwarding a message, it does some verification checks to ensure there
are no duplicate messages, ZKP is valid and no double signaling has occured.  It
is worth noting that this can be combined with peer scoring, for example for
duplicate messages or invalid ZK proofs.<!-- --></p>
<!-- --><p>In line of Waku&#x27;s goals of modularity, RLN Relay is applied on a specific subset
of pubsub and content topics. You can think of it as an extra secure channel.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/building_private_infra_rlnrelay.png" alt="RLN Relay"/><figcaption>RLN Relay<!-- --></figcaption></figure>
<!-- --><h3><a class="anchor" id="rln-relay-cross-client-testnet"></a><a class="ha" href="#rln-relay-cross-client-testnet">RLN Relay cross-client testnet<!-- --></a></h3>
<!-- --><p>Where are we with RLN Relay deployment? We&#x27;ve recently launched our second
testnet. This is using RLN Relay with a smart contract on Goerli. It integrates
with our example p2p chat application, and it does so through three different
clients, nwaku, go-waku and js-waku for browsers. This is our first p2p
cross-client testnet for RLN Relay.<!-- --></p>
<!-- --><p>Here&#x27;s a <!-- --><a href="https://www.youtube.com/watch?v=-vVrJWW0fls">video<!-- --></a> that shows a user
registering in a browser, signaling through JS-Waku. It then gets relayed to a
nwaku node, that verifies the proof. The second
<!-- --><a href="https://www.youtube.com/watch?v=Xz5q2ZhkFYs">video<!-- --></a> shows what happens in the
spam case. when more than one message is sent in a given epoch, it detects it as
spam and discards it. Slashing hasn&#x27;t been implemented fully yet in the client
and is a work in progress.<!-- --></p>
<!-- --><p>If you are curious and want to participate, you can join the effort on our <!-- --><a href="https://discord.gg/PQFdubGt6d">Vac
Discord<!-- --></a>. We also have
<!-- --><a href="https://github.com/status-im/nwaku/blob/master/docs/tutorial/rln-chat-cross-client.md">tutorials<!-- --></a>
setup for all clients so you can play around with it.<!-- --></p>
<!-- --><p>As part of this, and to make it work in multiple different environments, we&#x27;ve
also been developing a new library called Zerokit. I&#x27;ll talk about this a bit
later.<!-- --></p>
<!-- --><h3><a class="anchor" id="private-settlement--service-credentials"></a><a class="ha" href="#private-settlement--service-credentials">Private settlement / Service credentials<!-- --></a></h3>
<!-- --><p>Going back to the service network idea, let&#x27;s talk about service credentials.
The idea behind service credentials and private settlement is to enable two
actors to pay for and provide services without compromising their privacy. We do
not want the payment to create a direct public link between the service provider
and requester.<!-- --></p>
<!-- --><p>Recall the Waku service network illustration with adaptive nodes that choose
which protocols they want to run. Many of these protocols aren&#x27;t very heavy and
just work by default. For example the relay protocol is enabled by default.
Other protocols are much heavier to provide, such as storing historical
messages.<!-- --></p>
<!-- --><p>It is desirable to have additional incentives for this, especially for platforms
that aren&#x27;t community-based where some level of altruism can be assumed (e.g.
Status Communities, or WalletConnect cloud infrastructure).<!-- --></p>
<!-- --><p>You have a node Alice that is often offline and wants to consume historical
messages on some specific content topics. You have another node Bob that runs a
server at home where they store historical messages for the last several weeks.
Bob is happy to provide this service for free because he&#x27;s excited about running
privacy-preserving infrastructure and he&#x27;s using it himself, but his node is
getting overwhelmed by freeloaders and he feels like he should be paid something
for continuing to provide this service.<!-- --></p>
<!-- --><p>Alice deposits some funds in a smart contract which registers it in a tree,
similar to certain other private settlement mechanisms. A fee is taken or
burned. In exchange, she gets a set of tokens or service credentials. When she
wants to do a query with some criteria, she sends this to Bob. Bob responds with
size of response, cost, and receiver address. Alice then sends a proof of
delegation of a service token as a payment. Bob verifies the proof and resolves
the query.<!-- --></p>
<!-- --><p>The end result is that Alice has consumed some service from Bob, and Bob has
received payment for this. There&#x27;s no direct transaction link between Alice and
Bob, and gas fees can be minimized by extending the period before settling on
chain.<!-- --></p>
<!-- --><p>This can be complemented with altruistic service provisioning, for example by
splitting the peer pool into two slots, or only providing a few cheap queries
for free.<!-- --></p>
<!-- --><p>The service provisioning is general, and can be generalized for any kind of
request/response service provisoning that we want to keep private.<!-- --></p>
<!-- --><p>This isn&#x27;t a perfect solution, but it is an incremental improvement on top of
the status quo. It can be augmented with more advanced techniques such as better
non-repudiable node reputation, proof of correct service provisioning, etc.<!-- --></p>
<!-- --><p>We are currently in the raw spec / proof of concept stage of this. We expect to
launch a testnet of this later this year or early next year.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/building_private_infra_servicecred.png" alt="Service credentials flow"/><figcaption>Service credentials flow<!-- --></figcaption></figure>
<!-- --><h3><a class="anchor" id="zerokit"></a><a class="ha" href="#zerokit">Zerokit<!-- --></a></h3>
<!-- --><p><a href="https://github.com/vacp2p/zerokit">Zerokit<!-- --></a> is a set of Zero Knowledge modules,
written in Rust and designed to be used in many different environments. The
initial goal is to get the best of both worlds with Circom/Solidity/JS and
Rust/ZK ecosystem. This enables people to leverage Circom-based constructs from
non-JS environments.<!-- --></p>
<!-- --><p>For the RLN module, it is using Circom circuits via ark-circom and Rust for
scaffolding. It exposes a C FFI API that can be used through other system
programming environments, like Nim and Go. It also exposes an experimental WASM
API that can be used through web browsers.<!-- --></p>
<!-- --><p>Waku is p2p infrastructure running in many different environments, such as
Nim/JS/Go/Rust, so this a requirement for us.<!-- --></p>
<!-- --><p>Circom and JS strengths are access to Dapp developers, tooling, generating
verification code, circuits etc.  Rust strengths is that it is systems-based and
easy to interface with other language runtime such as Nim, Go, Rust, C. It also
gives access to other Rust ZK ecosystems such as arkworks. This opens door for
using other constructs, such as Halo2. This becomes especially relevant for
constructs where you don&#x27;t want to do a trusted setup or where circuits are more
complex/custom and performance requirements are higher.<!-- --></p>
<!-- --><p>In general with Zerokit, we want to make it easy to build and use ZKP in a
multitude of environments, such as mobile phones and web browsers. Currently it
is too complex to write privacy-protecting infrastructure with ZKPs considering
all the languages and tools you have to learn, from JS, Solidity and Circom to
Rust, WASM and FFI. And that isn&#x27;t even touching on things like secure key
storage or mobile dev. Luckily more and more projects are working on this,
including writing DSLs etc. It&#x27;d also be exciting if we can make a useful
toolstack for JS-less ZK dev to reduce cognitive overhead, similar to what we
have with something like Foundry.<!-- --></p>
<!-- --><h3><a class="anchor" id="other-research"></a><a class="ha" href="#other-research">Other research<!-- --></a></h3>
<!-- --><p>I also want to mention a few other things we are doing. One thing is
<!-- --><a href="https://rfc.vac.dev/">protocol specifications<!-- --></a>. We think this is very important
for p2p infra, and we see a lot of other projects that claim to do it p2p
infrastructure but they aren&#x27;t clear about guarantees or how stable something
is. That makes it hard to have multiple implementations, to collaborate across
different projects, and to analyze things objectively.<!-- --></p>
<!-- --><p>Related to that is publishing <!-- --><a href="https://vac.dev/publications">papers<!-- --></a>. We&#x27;ve put
out three so far, related to Waku and RLN-Relay. This makes it easier to
interface with academia. There&#x27;s a lot of good researchers out there and we want
to build a better bridge between academia and industry.<!-- --></p>
<!-- --><p>Another thing is <!-- --><a href="https://vac.dev/wakuv2-relay-anon">network<!-- --></a>
<!-- --><a href="https://github.com/vacp2p/research/issues/107">privacy<!-- --></a>. Waku is modular with
respect to privacy guarantees, and there are a lot of knobs to turn here
depending on specific deployments. For example, if you are running the full
relay protocol you currently have much stronger receiver anonymity than if you
are running filter protocol from a bandwidth or connectivity-restricted node.<!-- --></p>
<!-- --><p>We aim to make this pluggable depending on user needs. E.g. mixnets such as Nym
come with some trade-offs but are a useful tool in the arsenal. A good mental
model to keep in mind is the anonymity trilemma, where you can only pick 2/3 out
of low latency, low bandwidth usage and strong anonymity.<!-- --></p>
<!-- --><p>We are currently exploring <!-- --><a href="https://github.com/vacp2p/research/issues/119">Dandelion-like
additions<!-- --></a> to the relay/gossip
protocol, which would provide for stronger sender anonymity, especially in a
multi-node/botnet attacker model. As part of this we are looking into different
parameters choices and general possibilities for lower latency usage. This could
make it more amenable for latency sensitive environments, such as validator
privacy, for specific threat models. The general theme here is we want to be
rigorous with the guarantees we provide, under what conditions and for what
threat models.<!-- --></p>
<!-- --><p>Another thing mentioned earlier is <!-- --><a href="https://vac.dev/wakuv2-noise">Noise payload
encryption<!-- --></a>, and specifically things like allowing
for pairing different devices with e.g. QR codes. This makes it easier for
developers to provide secure messaging in many realistic scenarios in a
multi-device world.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/building_private_infra_misc.png" alt="Other research"/><figcaption>Other research<!-- --></figcaption></figure>
<!-- --><h3><a class="anchor" id="summary"></a><a class="ha" href="#summary">Summary<!-- --></a></h3>
<!-- --><p>We&#x27;ve gone over what privacy-protecting infrastructure is, why we want it and
how we can build it. We&#x27;ve seen how ZK is a fundamental building block for this.
We&#x27;ve looked at Waku, the communication layer for Web3, and how it uses Zero
Knowledge proofs to stay private and function better. We&#x27;ve also looked at
Zerokit and how we can make it easier to do ZKP in different environments.<!-- --></p>
<!-- --><p>Finally we also looked at some other research we&#x27;ve been doing. All of the
things mentioned in this article, and more, is available as
<!-- --><a href="https://vac.dev/research">write-ups<!-- --></a>, <!-- --><a href="https://rfc.vac.dev/">specs<!-- --></a>, or
discussions on our <!-- --><a href="forum.vac.dev/">forum<!-- --></a> or <!-- --><a href="github.com/vacp2p/">Github<!-- --></a>.<!-- --></p>
<!-- --><p>If you find any of this exciting to work on, feel free to reach out on our
Discord.  We are also <!-- --><a href="https://jobs.status.im/">hiring<!-- --></a>, and we have started
expanding into other privacy infrastructure tech like private and provable
computation with ZK-WASM.<!-- --></p></article><aside class="Styles_container__3DqFl Style_toc__v7JJe Styles_common_toc__nMHyQ hidden-scroll"><nav class="Styles_tocComponent__fhPld hidden-scroll"><ul><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#intro">Intro</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#about">About</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#why-build-privacy-protecting-infrastructure">Why build privacy-protecting infrastructure?</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#web3-infrastructure">Web3 infrastructure</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#zk-for-privacy-protecting-infrastructure">ZK for privacy-protecting infrastructure</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#waku">Waku</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#waku-adaptive-nodes">Waku - adaptive nodes</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#waku-protocol-interactions">Waku - protocol interactions</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#waku-network">Waku - Network</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#dealing-with-network-spam-and-rln-relay">Dealing with network spam and RLN Relay</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#rln-overview-and-flow">RLN - Overview and Flow</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#rln-circuit">RLN - Circuit</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#rln-shamir-s-secret-sharing">RLN - Shamir&#x27;s secret sharing</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#rln-relay">RLN Relay</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#rln-relay-cross-client-testnet">RLN Relay cross-client testnet</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#private-settlement-service-credentials">Private settlement / Service credentials</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#zerokit">Zerokit</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#other-research">Other research</a></li><li class="h-3"><a class="" href="/building-privacy-protecting-infrastructure#summary">Summary</a></li></ul></nav></aside></main><footer class="Styles_container___YkOC undefined Styles_common_footer__1rPoh"><div class="footer-content-container Styles_content__0jn9p"><div><p><span class="copy-left">Â©</span><span>2023<!-- --></span><span> Vac Research</span><span> - </span><span>Vac - Communication, Privacy, Etc</span></p></div><div class="Styles_bottomPart__CsMh_"><div class="Styles_socialMedia__AmAKz "><span><a href="https://twitter.com/vacp2p" class="button"><svg xmlns="http://www.w3.org/2000/svg" width="30" viewBox="0 0 543.684 543.684" xml:space="preserve"><path d="M527.657 106.697a231.362 231.362 0 0 1-8.041 2.191c-16.384 4.137-17.89-1.322-6.028-13.366a109.306 109.306 0 0 0 14.082-17.607c9.137-14.217 1.212-20.417-14.333-13.776a224.853 224.853 0 0 1-16.897 6.432c-16.017 5.379-38.746-2.735-53.018-11.787-18.018-11.426-38.495-17.136-61.438-17.136-32.137 0-59.529 11.334-82.192 33.984-22.656 22.662-33.99 50.062-33.99 82.191 0 4.394.251 8.855.747 13.378.814 7.362-11.585 12.699-28.317 10.336-36.194-5.11-70.582-16.077-103.171-32.889-32.32-16.671-60.845-37.65-85.57-62.938-11.819-12.086-27.804-11.045-32.217 5.27-2.644 9.78-3.959 19.951-3.959 30.515 0 19.908 4.675 38.372 14.027 55.392 4.651 8.47 10.098 16.138 16.353 22.999 10.521 11.549 8.911 18.25-5.734 14.144-14.639-4.106-25.367-10.202-25.367-9.804v.722c0 28.048 8.807 52.693 26.432 73.911 10.857 13.072 23.47 23.17 37.834 30.282 15.147 7.503 22.203 11.688 13.733 12.784-5.11.661-10.251.991-15.422.991-3.5 0-7.172-.159-11.003-.483-6.059-.514-7.148 12.111 2.038 26.298 7.301 11.273 16.646 21.193 28.03 29.762 11.579 8.721 24.058 14.981 37.417 18.794 16.255 4.633 19.517 13.073 5.024 21.763-35.863 21.519-75.551 32.277-119.058 32.277-4.902 0-9.578-.11-14.045-.324-7.754-.373-2.552 6.456 12.417 14.296 46.775 24.499 97.43 36.738 151.972 36.738 41.237 0 79.964-6.529 116.176-19.596 36.199-13.066 67.136-30.576 92.791-52.516 25.655-21.94 47.779-47.173 66.365-75.711 18.581-28.537 32.424-58.33 41.543-89.376 9.106-31.053 13.666-62.167 13.666-93.342 0-2.809-.024-5.331-.067-7.552-.086-4.174 10.955-15.472 23.28-27.032a242.397 242.397 0 0 0 15.937-16.444c11.179-12.688 6.228-18.502-9.997-13.771z"></path></svg></a></span><span><a href="https://discord.gg/PQFdubGt6d" class="button"><svg width="30" viewBox="0 0 71 55" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#discord_svg__a)"><path d="M60.105 4.898A58.55 58.55 0 0 0 45.653.415a.22.22 0 0 0-.233.11 40.784 40.784 0 0 0-1.8 3.697c-5.456-.817-10.886-.817-16.23 0-.485-1.164-1.201-2.587-1.828-3.697a.228.228 0 0 0-.233-.11 58.386 58.386 0 0 0-14.451 4.483.207.207 0 0 0-.095.082C1.578 18.73-.944 32.144.293 45.39a.244.244 0 0 0 .093.167c6.073 4.46 11.955 7.167 17.729 8.962a.23.23 0 0 0 .249-.082 42.08 42.08 0 0 0 3.627-5.9.225.225 0 0 0-.123-.312 38.772 38.772 0 0 1-5.539-2.64.228.228 0 0 1-.022-.378c.372-.279.744-.569 1.1-.862a.22.22 0 0 1 .23-.03c11.619 5.304 24.198 5.304 35.68 0a.219.219 0 0 1 .233.027c.356.293.728.586 1.103.865a.228.228 0 0 1-.02.378 36.384 36.384 0 0 1-5.54 2.637.227.227 0 0 0-.121.315 47.249 47.249 0 0 0 3.624 5.897.225.225 0 0 0 .249.084c5.801-1.794 11.684-4.502 17.757-8.961a.228.228 0 0 0 .092-.164c1.48-15.315-2.48-28.618-10.497-40.412a.18.18 0 0 0-.093-.084Zm-36.38 32.427c-3.497 0-6.38-3.211-6.38-7.156 0-3.944 2.827-7.156 6.38-7.156 3.583 0 6.438 3.24 6.382 7.156 0 3.945-2.827 7.156-6.381 7.156Zm23.593 0c-3.498 0-6.38-3.211-6.38-7.156 0-3.944 2.826-7.156 6.38-7.156 3.582 0 6.437 3.24 6.38 7.156 0 3.945-2.798 7.156-6.38 7.156Z" fill="#23272A"></path></g><defs><clipPath id="discord_svg__a"><path fill="#fff" d="M0 0h71v55H0z"></path></clipPath></defs></svg></a></span><span><a href="https://github.com/vacp2p" class="button"><svg width="30" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M512 0C229.12 0 0 229.12 0 512c0 226.56 146.56 417.92 350.08 485.76 25.6 4.48 35.2-10.88 35.2-24.32 0-12.16-.64-52.48-.64-95.36-128.64 23.68-161.92-31.36-172.16-60.16-5.76-14.72-30.72-60.16-52.48-72.32-17.92-9.6-43.52-33.28-.64-33.92 40.32-.64 69.12 37.12 78.72 52.48 46.08 77.44 119.68 55.68 149.12 42.24 4.48-33.28 17.92-55.68 32.64-68.48-113.92-12.8-232.96-56.96-232.96-252.8 0-55.68 19.84-101.76 52.48-137.6-5.12-12.8-23.04-65.28 5.12-135.68 0 0 42.88-13.44 140.8 52.48 40.96-11.52 84.48-17.28 128-17.28 43.52 0 87.04 5.76 128 17.28 97.92-66.56 140.8-52.48 140.8-52.48 28.16 70.4 10.24 122.88 5.12 135.68 32.64 35.84 52.48 81.28 52.48 137.6 0 196.48-119.68 240-233.6 252.8 18.56 16 34.56 46.72 34.56 94.72 0 68.48-.64 123.52-.64 140.8 0 13.44 9.6 29.44 35.2 24.32C877.44 929.92 1024 737.92 1024 512 1024 229.12 794.88 0 512 0Z" fill="#1B1F23"></path></svg></a></span></div><nav class="Styles_legal__0ciDG"><a title="Privacy Policy" href="/privacy-policy">Privacy Policy</a></nav></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"markdown":{"content":"\n*This write-up is based on a talk given at DevCon 6 in Bogota, a video can be found [here](https://www.youtube.com/watch?v=CW1DYJifdhs)*\n\n### Intro\n\nIn this write-up, we are going to talk about building privacy-protecting\ninfrastructure.  What is it, why do we need it and how can we build it?\n\nWe'll look at Waku, the communication layer for Web3. We'll look at how we are\nusing Zero Knowledge (ZK) technology to incentivize and protect the Waku\nnetwork. We'll also look at Zerokit, a library we are writing to make ZKP easier\nto use in different environments.\n\nAt the end of this write-up, I hope you'll come away with an understanding of\nthe importance of privacy-protecting infrastructure and how we can build it.\n\n### About\n\nFirst, briefly about Vac. We build public good protocols for the decentralized\nweb, with a focus on privacy and communication. We do applied research based on\nwhich we build protocols, libraries and publications. We are also the custodians\nof protocols that reflect a set of principles.\n\n![Principles](/img/building_private_infra_principles.png)\n\nIt has its origins in the [Status app](https://status.im/) and trying to improve\nthe underlying protocols and infrastructure. We build [Waku](https://waku.org/),\namong other things.\n\n### Why build privacy-protecting infrastructure?\n\nPrivacy is the power to selectively reveal yourself. It is a requirement for\nfreedom and self-determination.\n\nJust like you need decentralization in order to get censorship-resistance, you\nneed privacy to enable freedom of expression.\n\nTo build applications that are decentralized and privacy-protecting, you need\nthe base layer, the infrastructure itself, to have those properties.\n\nWe see this a lot. It is easier to make trade-offs at the application layer than\ndoing them at the base layer. You can build custodial solutions on top of a\ndecentralized and non-custodial network where participants control their own\nkeys, but you can't do the opposite.\n\nIf you think about it, buildings can be seen as a form of privacy-protecting\ninfrastructure. It is completely normal and obvious in many ways, but when it\ncomes to the digital realm our mental models and way of speaking about it hasn't\ncaught up yet for most people.\n\nI'm not going too much more into the need for privacy or what happens when you\ndon't have it, but suffice to say it is an important property for any open\nsociety.\n\nWhen we have conversations, true peer-to-peer offline conversations, we can talk\nprivately. If we use cash to buy things we can do commerce privately.\n\nOn the Internet, great as it is, there are a lot of forces that makes this\nnatural state of things not the default. Big Tech has turned users into a\ncommodity, a product, and monetized user's attention for advertising. To\noptimize for your attention they need to surveil your habits and activities, and\nhence breach your privacy. As opposed to more old-fashioned models, where\nsomeone is buying a useful service from a company and the incentives are more\naligned.\n\nWe need to build credibly neutral infrastructure that protects your privacy at\nthe base layer, in order to truly enable applications that are\ncensorship-resistant and encourage meaningful freedom of expression.\n\n### Web3 infrastructure\n\nInfrastructure is what lies underneath. Many ways of looking at this but I'll\nkeep it simple as per the original Web3 vision. You had Ethereum for\ncompute/consensus, Swarm for storage, and Whisper for messaging. Waku has taken\nover the mantle from Whisper and is a lot more\n[usable](https://vac.dev/fixing-whisper-with-waku) today than Whisper ever was,\nfor many reasons.\n\n![Web3 Infrastructure](/img/web3_holy_trinity.png)\n\nOn the privacy-front, we see how Ethereum is struggling. It is a big UX problem,\nespecially when you try to add privacy back \"on top\". It takes a lot of effort\nand it is easier to censor. We see this with recent action around Tornado Cash.\nCompare this with something like Zcash or Monero, where privacy is there by\ndefault.\n\nThere are also problems when it comes to the p2p networking side of things, for\nexample with Ethereum validator privacy and hostile actors and jurisdictions. If\nsomeone can easily find out where a certain validator is physically located,\nthat's a problem in many parts of the world. Being able to have stronger\nprivacy-protection guarantees would be very useful for high-value targets.\n\nThis doesn't begin to touch on the so called \"dapps\" that make a lot of\nsacrifices in how they function, from the way domains work, to how websites are\nhosted and the reliance on centralized services for communication. We see this\ntime and time again, where centralized, single points of failure systems work\nfor a while, but then eventually fail.\n\nIn many cases an individual user might not care enough though, and for platforms\nthe lure to take shortcuts is strong. That is why it is important to be\nprincipled, but also pragmatic in terms of the trade-offs that you allow on top.\nWe'll touch more on this in the design goals around modularity that Waku has.\n\n### ZK for privacy-protecting infrastructure\n\nZKPs are a wonderful new tool. Just like smart contracts enables programmable\nmoney, ZKPs allow us to express fundamentally new things. In line with the great\ntradition of trust-minimization, we can prove statement while revealing the\nabsolute minimum information necessary. This fits the definition of privacy, the\npower to selectively reveal yourself, perfectly. I'm sure I don't need to tell\nanyone reading this but this is truly revolutionary. The technology is advancing\nextremely fast and often it is our imagination that is the limit.\n\n![Zero knowledge](/img/building_private_infra_zk.png)\n\n### Waku\n\nWhat is Waku? It is a set of modular protocols for p2p communication. It has a\nfocus on privacy, security and being able to run anywhere. It is the spiritual\nsuccess to Whisper.\n\nBy modular we mean that you can pick and choose protocols and how you use them\ndepending on constraints and trade-offs. For example, bandwidth usage vs\nprivacy.\n\nIt is designed to work in resource restricted environments, such as mobile\nphones and in web browsers. It is important that infrastructure meets users\nwhere they are and supports their real-world use cases. Just like you don't need\nyour own army and a castle to have your own private bathroom, you shouldn't need\nto have a powerful always-on node to get reasonable privacy and\ncensorship-resistance. We might call this self-sovereignty.\n\n### Waku - adaptive nodes\n\nOne way of looking at Waku is as an open service network. There are nodes with\nvarying degrees of capabilities and requirements. For example when it comes to\nbandwidth usage, storage, uptime, privacy requirements, latency requirements,\nand connectivity restrictions.\n\nWe have a concept of adaptive nodes that can run a variety of protocols. A node\noperator can choose which protocols they want to run. Naturally, there'll be\nsome nodes that do more consumption and other nodes that do more provisioning.\nThis gives rise to the idea of a service network, where services are provided\nfor and consumed.\n\n![Adaptive Nodes](/img/building_private_infra_adaptive.png)\n\n### Waku - protocol interactions \n\nThere are many protocols that interact. Waku Relay protocol is based on libp2p\nGossipSub for p2p messaging. We have filter for bandwidth-restricted nodes to\nonly receive subset of messages. Lightpush for nodes with short connection\nwindows to push messages into network. Store for nodes that want to retrieve\nhistorical messages.\n\nOn the payload layer, we provide support for Noise handshakes/key-exchanges.\nThis means that as a developers, you can get end-to-end encryption and expected\nguarantees out of the box. We have support for setting up a secure channel from\nscratch, and all of this paves the way for providing Signal's Double Ratchet at\nthe protocol level much easier. We also have experimental support for\nmulti-device usage. Similar features have existed in for example the Status app\nfor a while, but with this we make it easier for any platform using Waku to use\nit.\n\nThere are other protocols too, related to peer discovery, topic usage, etc. See\n[specs](https://rfc.vac.dev/) for more details.\n\n![Protocol Interactions](/img/building_private_infra_interactions.png)\n\n### Waku - Network\n\nFor the Waku network, there are a few problems. For example, when it comes to\nnetwork spam and incentivizing service nodes. We want to address these while\nkeeping privacy-guarantees of the base layer. I'm going to go into both of\nthese.\n\nThe spam problem arises on the gossip layer when anyone can overwhelm the\nnetwork with messages. The service incentivization is a problem when nodes don't\ndirectly benefit from the provisioning of a certain service. This can happen if\nthey are not using the protocol directly themselves as part of normal operation,\nor if they aren't socially inclined to provide a certain service. This depends a\nlot on how an individual platform decides to use the network.\n\n![Waku Network](/img/building_private_infra_network.png)\n\n### Dealing with network spam and RLN Relay\n\nSince the p2p relay network is open to anyone, there is a problem with spam. If\nwe look at existing solutions for dealing with spam in traditional messaging\nsystems, a lot of entities like Google, Facebook, Twitter, Telegram, Discord use\nphone number verification. While this is largely sybil-resistant, it is\ncentralized and not private at all.\n\nHistorically, Whisper used PoW which isn't good for heterogenerous networks.\nPeer scoring is open to sybil attacks and doesn't directly address spam\nprotection in an anonymous p2p network.\n\nThe key idea here is to use RLN for private economic spam protection using\nzkSNARKs.\n\nI'm not going to go into too much detail of RLN here. If you are interested, I\ngave a [talk](https://www.youtube.com/watch?v=g41nHQ0mLoA) in Amsterdam at\nDevconnect about this. We have some write-ups on RLN\n[here](https://vac.dev/rln-relay) by Sanaz who has been pushing a lot of this\nfrom our side. There's also another talk at Devcon by Tyler going into RLN in\nmore detail. Finally, here's the [RLN spec](https://rfc.vac.dev/spec/32/).\n\nI'll briefly go over what it is, the interface and circuit and then talk about\nhow it is used in Waku.\n\n### RLN - Overview and Flow\n\nRLN stands for Rate Limiting Nullifier. It is an anonyomous rate limiting\nmechanism based on zkSNARKs. By rate limiting we mean you can only send N\nmessages in a given period. By anonymity we mean that you can't link message to\na publisher. We can think of it as a voting booth, where you are only allowed to\nvote once every election.\n\n![Voting Booth](/img/building_private_infra_vote.png)\n\nIt can be used for spam protection in p2p messaging systems, and also rate\nlimiting in general, such as for a decentralized captcha.\n\nThere are three parts to it. You register somewhere, then you can signal and\nfinally there's a verification/slashing phase. You put some capital at risk,\neither economic or social, and if you double signal you get slashed.\n\n### RLN - Circuit\n\nHere's what the private and public inputs to the circuit look like. The identity\nsecret is generated locally, and we create an identity commitment that is\ninserted into a Merkle tree. We then use Merkle proofs to prove membership.\nRegistered member can only signal once for a given epoch or external nullifier,\nfor example every ten seconds in Unix time. RLN identifer is for a specific RLN\napp.\n\nWe also see what the circuit output looks like. This is calculated locally. `y`\nis a share of the secret equation, and the (internal) nullifier acts as a unique\nfingerprint for a given app/user/epoch combination. How do we calculate `y` and\nthe internal nullifier?\n\n```\n// Private input\nsignal input identity_secret;\nsignal input path_elements[n_levels][1];\nsignal input identity_path_index[n_levels];\n\n// Public input\nsignal input x; // signal_hash\nsignal input epoch; // external_nullifier\nsignal input rln_identifier;\n\n// Circuit output\nsignal output y;\nsignal output root;\nsignal output nullifier;\n```\n\n### RLN - Shamir's secret sharing\n\nThis is done using [Shamir's secret\nsharing](https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing). Shamirâ€™s\nsecret sharing is based on idea of splitting a secret into shares. This is how\nwe enable slashing of funds.\n\nIn this case, we have two shares. If a given identity `a0` signals twice in\nepoch/external nullifier, `a1` is the same. For a given RLN app,\n`internal_nullifier` then stays the same. `x` is signal hash which is different,\nand `y` is public, so we can reconstruct `identity_secret`. With the identity\nsecret revealed, this gives access to e.g. financial stake.\n\n```\na_0 = identity_secret // secret S\na_1 = poseidonHash([a0, external_nullifier])\n\ny = a_0 + x * a_1\n\ninternal_nullifier = poseidonHash([a_1, rln_identifier])\n```\n\n![Shamir's secret sharing](/img/building_private_infra_shamir.png)\n\n### RLN Relay\n\nThis is how RLN is used with Relay/GossipSub protocol. A node registers and\nlocks up funds, and after that it can send messages. It publishes a message\ncontaining the Zero Knowledge proof and some other details.\n\nEach relayer node listens to the membership contract for new members, and it\nalso keeps track of relevant metadata and merkle tree. Metadata is needed to be\nable to detect double signaling and perform slashing.\n\nBefore forwarding a message, it does some verification checks to ensure there\nare no duplicate messages, ZKP is valid and no double signaling has occured.  It\nis worth noting that this can be combined with peer scoring, for example for\nduplicate messages or invalid ZK proofs.\n\nIn line of Waku's goals of modularity, RLN Relay is applied on a specific subset\nof pubsub and content topics. You can think of it as an extra secure channel.\n\n![RLN Relay](/img/building_private_infra_rlnrelay.png)\n\n### RLN Relay cross-client testnet\n\nWhere are we with RLN Relay deployment? We've recently launched our second\ntestnet. This is using RLN Relay with a smart contract on Goerli. It integrates\nwith our example p2p chat application, and it does so through three different\nclients, nwaku, go-waku and js-waku for browsers. This is our first p2p\ncross-client testnet for RLN Relay.\n\nHere's a [video](https://www.youtube.com/watch?v=-vVrJWW0fls) that shows a user\nregistering in a browser, signaling through JS-Waku. It then gets relayed to a\nnwaku node, that verifies the proof. The second\n[video](https://www.youtube.com/watch?v=Xz5q2ZhkFYs) shows what happens in the\nspam case. when more than one message is sent in a given epoch, it detects it as\nspam and discards it. Slashing hasn't been implemented fully yet in the client\nand is a work in progress.\n\nIf you are curious and want to participate, you can join the effort on our [Vac\nDiscord](https://discord.gg/PQFdubGt6d). We also have\n[tutorials](https://github.com/status-im/nwaku/blob/master/docs/tutorial/rln-chat-cross-client.md)\nsetup for all clients so you can play around with it.\n\nAs part of this, and to make it work in multiple different environments, we've\nalso been developing a new library called Zerokit. I'll talk about this a bit\nlater.\n\n### Private settlement / Service credentials\n\nGoing back to the service network idea, let's talk about service credentials.\nThe idea behind service credentials and private settlement is to enable two\nactors to pay for and provide services without compromising their privacy. We do\nnot want the payment to create a direct public link between the service provider\nand requester.\n\nRecall the Waku service network illustration with adaptive nodes that choose\nwhich protocols they want to run. Many of these protocols aren't very heavy and\njust work by default. For example the relay protocol is enabled by default.\nOther protocols are much heavier to provide, such as storing historical\nmessages.\n\nIt is desirable to have additional incentives for this, especially for platforms\nthat aren't community-based where some level of altruism can be assumed (e.g.\nStatus Communities, or WalletConnect cloud infrastructure).\n\nYou have a node Alice that is often offline and wants to consume historical\nmessages on some specific content topics. You have another node Bob that runs a\nserver at home where they store historical messages for the last several weeks.\nBob is happy to provide this service for free because he's excited about running\nprivacy-preserving infrastructure and he's using it himself, but his node is\ngetting overwhelmed by freeloaders and he feels like he should be paid something\nfor continuing to provide this service.\n\nAlice deposits some funds in a smart contract which registers it in a tree,\nsimilar to certain other private settlement mechanisms. A fee is taken or\nburned. In exchange, she gets a set of tokens or service credentials. When she\nwants to do a query with some criteria, she sends this to Bob. Bob responds with\nsize of response, cost, and receiver address. Alice then sends a proof of\ndelegation of a service token as a payment. Bob verifies the proof and resolves\nthe query.\n\nThe end result is that Alice has consumed some service from Bob, and Bob has\nreceived payment for this. There's no direct transaction link between Alice and\nBob, and gas fees can be minimized by extending the period before settling on\nchain.\n\nThis can be complemented with altruistic service provisioning, for example by\nsplitting the peer pool into two slots, or only providing a few cheap queries\nfor free.\n\nThe service provisioning is general, and can be generalized for any kind of\nrequest/response service provisoning that we want to keep private.\n\nThis isn't a perfect solution, but it is an incremental improvement on top of\nthe status quo. It can be augmented with more advanced techniques such as better\nnon-repudiable node reputation, proof of correct service provisioning, etc.\n\nWe are currently in the raw spec / proof of concept stage of this. We expect to\nlaunch a testnet of this later this year or early next year.\n\n![Service credentials flow](/img/building_private_infra_servicecred.png)\n\n### Zerokit\n\n[Zerokit](https://github.com/vacp2p/zerokit) is a set of Zero Knowledge modules,\nwritten in Rust and designed to be used in many different environments. The\ninitial goal is to get the best of both worlds with Circom/Solidity/JS and\nRust/ZK ecosystem. This enables people to leverage Circom-based constructs from\nnon-JS environments.\n\nFor the RLN module, it is using Circom circuits via ark-circom and Rust for\nscaffolding. It exposes a C FFI API that can be used through other system\nprogramming environments, like Nim and Go. It also exposes an experimental WASM\nAPI that can be used through web browsers.\n\nWaku is p2p infrastructure running in many different environments, such as\nNim/JS/Go/Rust, so this a requirement for us.\n\nCircom and JS strengths are access to Dapp developers, tooling, generating\nverification code, circuits etc.  Rust strengths is that it is systems-based and\neasy to interface with other language runtime such as Nim, Go, Rust, C. It also\ngives access to other Rust ZK ecosystems such as arkworks. This opens door for\nusing other constructs, such as Halo2. This becomes especially relevant for\nconstructs where you don't want to do a trusted setup or where circuits are more\ncomplex/custom and performance requirements are higher.\n\nIn general with Zerokit, we want to make it easy to build and use ZKP in a\nmultitude of environments, such as mobile phones and web browsers. Currently it\nis too complex to write privacy-protecting infrastructure with ZKPs considering\nall the languages and tools you have to learn, from JS, Solidity and Circom to\nRust, WASM and FFI. And that isn't even touching on things like secure key\nstorage or mobile dev. Luckily more and more projects are working on this,\nincluding writing DSLs etc. It'd also be exciting if we can make a useful\ntoolstack for JS-less ZK dev to reduce cognitive overhead, similar to what we\nhave with something like Foundry.\n\n### Other research\n\nI also want to mention a few other things we are doing. One thing is\n[protocol specifications](https://rfc.vac.dev/). We think this is very important\nfor p2p infra, and we see a lot of other projects that claim to do it p2p\ninfrastructure but they aren't clear about guarantees or how stable something\nis. That makes it hard to have multiple implementations, to collaborate across\ndifferent projects, and to analyze things objectively.\n\nRelated to that is publishing [papers](https://vac.dev/publications). We've put\nout three so far, related to Waku and RLN-Relay. This makes it easier to\ninterface with academia. There's a lot of good researchers out there and we want\nto build a better bridge between academia and industry.\n\nAnother thing is [network](https://vac.dev/wakuv2-relay-anon)\n[privacy](https://github.com/vacp2p/research/issues/107). Waku is modular with\nrespect to privacy guarantees, and there are a lot of knobs to turn here\ndepending on specific deployments. For example, if you are running the full\nrelay protocol you currently have much stronger receiver anonymity than if you\nare running filter protocol from a bandwidth or connectivity-restricted node.\n\nWe aim to make this pluggable depending on user needs. E.g. mixnets such as Nym\ncome with some trade-offs but are a useful tool in the arsenal. A good mental\nmodel to keep in mind is the anonymity trilemma, where you can only pick 2/3 out\nof low latency, low bandwidth usage and strong anonymity.\n\nWe are currently exploring [Dandelion-like\nadditions](https://github.com/vacp2p/research/issues/119) to the relay/gossip\nprotocol, which would provide for stronger sender anonymity, especially in a\nmulti-node/botnet attacker model. As part of this we are looking into different\nparameters choices and general possibilities for lower latency usage. This could\nmake it more amenable for latency sensitive environments, such as validator\nprivacy, for specific threat models. The general theme here is we want to be\nrigorous with the guarantees we provide, under what conditions and for what\nthreat models.\n\nAnother thing mentioned earlier is [Noise payload\nencryption](https://vac.dev/wakuv2-noise), and specifically things like allowing\nfor pairing different devices with e.g. QR codes. This makes it easier for\ndevelopers to provide secure messaging in many realistic scenarios in a\nmulti-device world.\n\n![Other research](/img/building_private_infra_misc.png)\n\n### Summary\n\nWe've gone over what privacy-protecting infrastructure is, why we want it and\nhow we can build it. We've seen how ZK is a fundamental building block for this.\nWe've looked at Waku, the communication layer for Web3, and how it uses Zero\nKnowledge proofs to stay private and function better. We've also looked at\nZerokit and how we can make it easier to do ZKP in different environments.\n\nFinally we also looked at some other research we've been doing. All of the\nthings mentioned in this article, and more, is available as\n[write-ups](https://vac.dev/research), [specs](https://rfc.vac.dev/), or\ndiscussions on our [forum](forum.vac.dev/) or [Github](github.com/vacp2p/).\n\nIf you find any of this exciting to work on, feel free to reach out on our\nDiscord.  We are also [hiring](https://jobs.status.im/), and we have started\nexpanding into other privacy infrastructure tech like private and provable\ncomputation with ZK-WASM.\n","metadata":{"layout":"post","name":"Building Privacy-Protecting Infrastructure","title":"Building Privacy-Protecting Infrastructure","date":"2022-11-04T12:00:00.000Z","author":"oskarth","published":true,"permalink":"/building-privacy-protecting-infrastructure","categories":"research","summary":"What is privacy-protecting infrastructure? Why do we need it and how we can build it? We'll look at Waku, the communication layer for Web3. We'll see how it uses ZKPs to incentivize and protect the Waku network. We'll also look at Zerokit, a library that makes it easier to use ZKPs in different environments. After reading this, I hope you'll better understand the importance of privacy-protecting infrastructure and how we can build it.","image":"/img/building_private_infra_intro.png","discuss":"https://forum.vac.dev/t/discussion-building-privacy-protecting-infrastructure/161"},"toc":[{"content":"Intro","slug":"intro","lvl":3,"i":0,"seen":0},{"content":"About","slug":"about","lvl":3,"i":1,"seen":0},{"content":"Why build privacy-protecting infrastructure?","slug":"why-build-privacy-protecting-infrastructure","lvl":3,"i":2,"seen":0},{"content":"Web3 infrastructure","slug":"web3-infrastructure","lvl":3,"i":3,"seen":0},{"content":"ZK for privacy-protecting infrastructure","slug":"zk-for-privacy-protecting-infrastructure","lvl":3,"i":4,"seen":0},{"content":"Waku","slug":"waku","lvl":3,"i":5,"seen":0},{"content":"Waku - adaptive nodes","slug":"waku-adaptive-nodes","lvl":3,"i":6,"seen":0},{"content":"Waku - protocol interactions","slug":"waku-protocol-interactions","lvl":3,"i":7,"seen":0},{"content":"Waku - Network","slug":"waku-network","lvl":3,"i":8,"seen":0},{"content":"Dealing with network spam and RLN Relay","slug":"dealing-with-network-spam-and-rln-relay","lvl":3,"i":9,"seen":0},{"content":"RLN - Overview and Flow","slug":"rln-overview-and-flow","lvl":3,"i":10,"seen":0},{"content":"RLN - Circuit","slug":"rln-circuit","lvl":3,"i":11,"seen":0},{"content":"RLN - Shamir's secret sharing","slug":"rln-shamir-s-secret-sharing","lvl":3,"i":12,"seen":0},{"content":"RLN Relay","slug":"rln-relay","lvl":3,"i":13,"seen":0},{"content":"RLN Relay cross-client testnet","slug":"rln-relay-cross-client-testnet","lvl":3,"i":14,"seen":0},{"content":"Private settlement / Service credentials","slug":"private-settlement-service-credentials","lvl":3,"i":15,"seen":0},{"content":"Zerokit","slug":"zerokit","lvl":3,"i":16,"seen":0},{"content":"Other research","slug":"other-research","lvl":3,"i":17,"seen":0},{"content":"Summary","slug":"summary","lvl":3,"i":18,"seen":0}]},"navProps":{"metadata":{"published":true,"title":"Building Privacy-Protecting Infrastructure","layout":"post","name":"Building Privacy-Protecting Infrastructure","date":"2022-11-04T12:00:00.000Z","author":"oskarth","permalink":"/building-privacy-protecting-infrastructure","categories":"research","summary":"What is privacy-protecting infrastructure? Why do we need it and how we can build it? We'll look at Waku, the communication layer for Web3. We'll see how it uses ZKPs to incentivize and protect the Waku network. We'll also look at Zerokit, a library that makes it easier to use ZKPs in different environments. After reading this, I hope you'll better understand the importance of privacy-protecting infrastructure and how we can build it.","image":"img/building_private_infra_intro.png","discuss":"https://forum.vac.dev/t/discussion-building-privacy-protecting-infrastructure/161"},"navOrder":1667563200,"localPath":"research/2022-11-04-building-privacy-protecting-infrastructure.md","path":["building-privacy-protecting-infrastructure"],"children":[],"isDir":false},"routeParams":{"path":["building-privacy-protecting-infrastructure"]}},"__N_SSG":true},"page":"/[[...path]]","query":{"path":["building-privacy-protecting-infrastructure"]},"buildId":"-5vfLOflCSkQPJRugO7ZO","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>