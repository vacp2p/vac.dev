"use strict";(self.webpackChunkvac_dev=self.webpackChunkvac_dev||[]).push([[1327],{72932:(a,e,t)=>{t.r(e),t.d(e,{assets:()=>p,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>m,toc:()=>l});var n=t(87462),s=(t(67294),t(3905));const i={layout:"post",name:"Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay",title:"Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay",date:new Date("2022-07-22T10:00:00.000Z"),authors:"kaiserd",published:!0,slug:"wakuv2-relay-anon",categories:"research",image:"/img/anonymity_trilemma.svg",discuss:"https://forum.vac.dev/t/discussion-waku-privacy-and-anonymity-analysis/149",_includes:["math"],toc_min_heading_level:2,toc_max_heading_level:5},r=void 0,m={permalink:"/rlog/wakuv2-relay-anon",source:"@site/rlog/2022-07-22-relay-anonymity.mdx",title:"Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay",description:"Introducing a basic threat model and privacy/anonymity analysis for the Waku v2 relay protocol.",date:"2022-07-22T10:00:00.000Z",formattedDate:"July 22, 2022",tags:[],readingTime:16.785,hasTruncateMarker:!0,authors:[{name:"Daniel",github:"kaiserd",key:"kaiserd"}],frontMatter:{layout:"post",name:"Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay",title:"Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay",date:"2022-07-22T10:00:00.000Z",authors:"kaiserd",published:!0,slug:"wakuv2-relay-anon",categories:"research",image:"/img/anonymity_trilemma.svg",discuss:"https://forum.vac.dev/t/discussion-waku-privacy-and-anonymity-analysis/149",_includes:["math"],toc_min_heading_level:2,toc_max_heading_level:5},prevItem:{title:"Building Privacy-Protecting Infrastructure",permalink:"/rlog/building-privacy-protecting-infrastructure"},nextItem:{title:"Noise handshakes as key-exchange mechanism for Waku",permalink:"/rlog/wakuv2-noise"}},p={authorsImageUrls:[void 0]},l=[{value:"Informal Definitions: Security, Privacy, and Anonymity",id:"informal-definitions-security-privacy-and-anonymity",level:2},{value:"Security",id:"security",level:3},{value:"Privacy",id:"privacy",level:3},{value:"Anonymity",id:"anonymity",level:3},{value:"Receiver Anonymity",id:"receiver-anonymity",level:4},{value:"Sender Anonymity",id:"sender-anonymity",level:4},{value:"Anonymity Trilemma",id:"anonymity-trilemma",level:3},{value:"Censorship Resistance",id:"censorship-resistance",level:3},{value:"Attacker Types",id:"attacker-types",level:2},{value:"Internal",id:"internal",level:3},{value:"Single Node",id:"single-node",level:4},{value:"Multi Node",id:"multi-node",level:4},{value:"Linearly Scaling Nodes",id:"linearly-scaling-nodes",level:4},{value:"External",id:"external",level:3},{value:"Local",id:"local",level:4},{value:"AS",id:"as",level:4},{value:"Global On-Net",id:"global-on-net",level:4},{value:"Attack-based Threat Analysis",id:"attack-based-threat-analysis",level:2},{value:"Scope",id:"scope",level:3},{value:"Prerequisite: Get a Specific Position in the Network",id:"prerequisite-get-a-specific-position-in-the-network",level:3},{value:"Replay Attack",id:"replay-attack",level:3},{value:"Neighbourhood Surveillance",id:"neighbourhood-surveillance",level:3},{value:"Controlled Neighbourhood",id:"controlled-neighbourhood",level:3},{value:"Observing Messages",id:"observing-messages",level:3},{value:"Correlation",id:"correlation",level:3},{value:"DoS",id:"dos",level:3},{value:"Summary and Future Work",id:"summary-and-future-work",level:2},{value:"References",id:"references",level:2}],o={toc:l};function c(a){let{components:e,...i}=a;return(0,s.kt)("wrapper",(0,n.Z)({},o,i,{components:e,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"Introducing a basic threat model and privacy/anonymity analysis for the Waku v2 relay protocol."),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/standards/core/10/waku2"},"Waku v2")," enables secure, privacy preserving communication using a set of modular P2P protocols.\nWaku v2 also aims at protecting the user's anonymity.\nThis post is the first in a series about Waku v2 security, privacy, and anonymity.\nThe goal is to eventually have a full privacy and anonymity analysis for each of the Waku v2 protocols, as well as covering the interactions of various Waku v2 protocols.\nThis provides transparency with respect to Waku's current privacy and anonymity guarantees, and also identifies weak points that we have to address."),(0,s.kt)("p",null,"In this post, we first give an informal description of security, privacy and anonymity in the context of Waku v2.\nFor each definition, we summarize Waku's current guarantees regarding the respective property.\nWe also provide attacker models, an attack-based threat model, and a first anonymity analysis of ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/standards/core/11/relay"},"Waku v2 relay")," within the respective models."),(0,s.kt)("p",null,"Waku comprises many protocols that can be combined in a modular way.\nFor our privacy and anonymity analysis, we start with the relay protocol because it is at the core of Waku v2 enabling Waku's publish subscribe approach to P2P messaging.\nIn its current form, Waku relay is a minor extension of ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/README.md"},"libp2p GossipSub"),"."),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"Figure 1: The Waku v2 relay mesh is based on the [GossipSub mesh](https://docs.libp2p.io/concepts/publish-subscribe#types-of-peering)",src:t(84711).Z,width:"800",height:"305"})),(0,s.kt)("h2",{id:"informal-definitions-security-privacy-and-anonymity"},"Informal Definitions: Security, Privacy, and Anonymity"),(0,s.kt)("p",null,"The concepts of security, privacy, and anonymity are linked and have quite a bit of overlap."),(0,s.kt)("h3",{id:"security"},"Security"),(0,s.kt)("p",null,"Of the three, ",(0,s.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Information_security"},"Security")," has the clearest agreed upon definition,\nat least regarding its key concepts: ",(0,s.kt)("em",{parentName:"p"},"confidentiality"),", ",(0,s.kt)("em",{parentName:"p"},"integrity"),", and ",(0,s.kt)("em",{parentName:"p"},"availability"),"."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"confidentiality: data is not disclosed to unauthorized entities."),(0,s.kt)("li",{parentName:"ul"},"integrity: data is not modified by unauthorized entities."),(0,s.kt)("li",{parentName:"ul"},"availability: data is available, i.e. accessible by authorized entities.")),(0,s.kt)("p",null,"While these are the key concepts, the definition of information security has been extended over time including further concepts,\ne.g. ",(0,s.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Authentication"},"authentication")," and ",(0,s.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Non-repudiation"},"non-repudiation"),".\nWe might cover these in future posts."),(0,s.kt)("h3",{id:"privacy"},"Privacy"),(0,s.kt)("p",null,"Privacy allows users to choose which data and information"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"they want to share"),(0,s.kt)("li",{parentName:"ul"},"and with whom they want to share it.")),(0,s.kt)("p",null,"This includes data and information that is associated with and/or generated by users.\nProtected data also comprises metadata that might be generated without users being aware of it.\nThis means, no further information about the sender or the message is leaked.\nMetadata that is protected as part of the privacy-preserving property does not cover protecting the identities of sender and receiver.\nIdentities are protected by the ",(0,s.kt)("a",{parentName:"p",href:"#anonymity"},"anonymity property"),"."),(0,s.kt)("p",null,"Often privacy is realized by the confidentiality property of security.\nThis neither makes privacy and security the same, nor the one a sub category of the other.\nWhile security is abstract itself (its properties can be realized in various ways), privacy lives on a more abstract level using security properties.\nPrivacy typically does not use integrity and availability.\nAn adversary who has no access to the private data, because the message has been encrypted, could still alter the message."),(0,s.kt)("p",null,"Waku offers confidentiality via secure channels set up with the help of the ",(0,s.kt)("a",{parentName:"p",href:"https://noiseprotocol.org/"},"Noise Protocol Framework"),".\nUsing these secure channels, message content is only disclosed to the intended receivers.\nThey also provide good metadata protection properties.\nHowever, we do not have a metadata protection analysis as of yet,\nwhich is part of our privacy/anonymity roadmap."),(0,s.kt)("h3",{id:"anonymity"},"Anonymity"),(0,s.kt)("p",null,"Privacy and anonymity are closely linked.\nBoth the identity of a user and data that allows inferring a user's identity should be part of the privacy policy.\nFor the purpose of analysis, we want to have a clearer separation between these concepts."),(0,s.kt)("p",null,"We define anonymity as ",(0,s.kt)("em",{parentName:"p"},"unlinkablity of users' identities and their shared data and/or actions"),"."),(0,s.kt)("p",null,"We subdivide anonymity into ",(0,s.kt)("em",{parentName:"p"},"receiver anonymity")," and ",(0,s.kt)("em",{parentName:"p"},"sender anonymity"),"."),(0,s.kt)("h4",{id:"receiver-anonymity"},"Receiver Anonymity"),(0,s.kt)("p",null,"We define receiver anonymity as ",(0,s.kt)("em",{parentName:"p"},"unlinkability of users' identities and the data they receive and/or related actions"),".\nThe data transmitted via Waku relay must be a ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/standards/core/14/message"},"Waku message"),", which contains a content topic field.\nBecause each message is associated with a content topic, and each receiver is interested in messages with specific content topics,\nreceiver anonymity in the context of Waku corresponds to ",(0,s.kt)("em",{parentName:"p"},"subscriber-topic unlinkability"),'.\nAn example for the "action" part of our receiver anonymity definition is subscribing to a specific topic.'),(0,s.kt)("p",null,"The Waku message's content topic is not related to the libp2p pubsub topic.\nFor now, Waku uses a single libp2p pubsub topic, which means messages are propagated via a single mesh of peers.\nWith this, the receiver discloses its participation in Waku on the gossipsub layer.\nWe will leave the analysis of libp2p gossipsub to a future article within this series, and only provide a few hints and pointers here."),(0,s.kt)("p",null,"Waku offers k-anonymity regarding content topic interest in the global adversary model.\n",(0,s.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/K-anonymity"},"K-anonymity")," in the context of Waku means an attacker can link receivers to content topics with a maximum certainty of ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mn",{parentName:"mrow"},"1"),(0,s.kt)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,s.kt)("mi",{parentName:"mrow"},"k")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"1/k")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,s.kt)("span",{parentName:"span",className:"mord"},"1/"),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03148em"}},"k"))))),".\nThe larger ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"k")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"k")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.6944em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03148em"}},"k"))))),", the less certainty the attacker gains.\nReceivers basically hide in a pool of ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"k")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"k")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.6944em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03148em"}},"k")))))," content topics, any subset of which could be topics they subscribed to.\nThe attacker does not know which of those the receiver actually subscribed to,\nand the receiver enjoys ",(0,s.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Plausible_deniability#Use_in_cryptography"},"plausible deniability")," regarding content topic subscription.\nAssuming there are ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"n")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"n")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal"},"n")))))," Waku content topics, a receiver has ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"n")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"n")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal"},"n"))))),"-anonymity with respect to association to a specific content topic."),(0,s.kt)("p",null,"Technically, Waku allows distributing messages over several libp2p pubsub topics.\nThis yields ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"k")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"k")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.6944em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03148em"}},"k"))))),"-anonymity, assuming ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"k")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"k")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.6944em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03148em"}},"k")))))," content topics share the same pubsub topic.\nHowever, if done wrongly, such sharding of pubsub topics can breach anonymity.\nA formal specification of anonymity-preserving topic sharding building on the concepts of ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/status/deprecated/10/waku-usage#partitioned-topic"},"partitioned topics")," is part of our roadmap."),(0,s.kt)("p",null,"Also, Waku is not directly concerned with 1:1 communication, so for this post, 1:1 communication is out of scope.\nChannels for 1:1 communication can be implemented on top of Waku relay.\nIn the future, a 1:1 communication protocol might be added to Waku.\nSimilar to topic sharding, it would maintain receiver anonymity leveraging ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/status/deprecated/10/waku-usage/#partitioned-topic"},"partitioned topics"),"."),(0,s.kt)("h4",{id:"sender-anonymity"},"Sender Anonymity"),(0,s.kt)("p",null,"We define sender anonymity as ",(0,s.kt)("em",{parentName:"p"},"unlinkability of users' identities and the data they send and/or related actions"),".\nBecause the data in the context of Waku is Waku messages, sender anonymity corresponds to ",(0,s.kt)("em",{parentName:"p"},"sender-message unlinkability"),"."),(0,s.kt)("p",null,"In summary, Waku offers weak sender anonymity because of ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/standards/core/11/relay"},"Waku's strict no sign policy"),",\nwhich has its origins in the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/p2p-interface.md#why-are-we-using-the-strictnosign-signature-policy"},"Ethereum consensus specs"),".\n",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/standards/core/17/rln-relay"},"17/WAKU-RLN-RELAY")," and ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/deprecated/18/swap"},"18/WAKU2-SWAP")," mitigate replay and injection attacks."),(0,s.kt)("p",null,"Waku currently does not offer sender anonymity in stronger attacker models, as well as cannot protect against targeted attacks in weaker attacker models like the single or multi node attacker.\nWe will cover this in more detail in later sections."),(0,s.kt)("h3",{id:"anonymity-trilemma"},"Anonymity Trilemma"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://freedom.cs.purdue.edu/projects/trilemma.html"},"The Anonymity trilemma")," states that only two out of ",(0,s.kt)("em",{parentName:"p"},"strong anonymity"),", ",(0,s.kt)("em",{parentName:"p"},"low bandwidth"),", and ",(0,s.kt)("em",{parentName:"p"},"low latency")," can be guaranteed in the global on-net attacker model.\nWaku's goal, being a modular set of protocols, is to offer any combination of two out of these three properties, as well as blends.\nAn example for blending is an adjustable number of pubsub topics and peers in the respective pubsub topic mesh; this allows tuning the trade-off between anonymity and bandwidth."),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"Figure 2: Anonymity Trilemma: pick two. ",src:t(64287).Z,width:"81",height:"94"})),(0,s.kt)("p",null,"A fourth factor that influences ",(0,s.kt)("a",{parentName:"p",href:"https://freedom.cs.purdue.edu/projects/trilemma.html"},"the anonymity trilemma")," is ",(0,s.kt)("em",{parentName:"p"},"frequency and patterns")," of messages.\nThe more messages there are, and the more randomly distributed they are, the better the anonymity protection offered by a given anonymous communication protocol.\nSo, incentivising users to use the protocol, for instance by lowering entry barriers, helps protecting the anonymity of all users.\nThe frequency/patterns factor is also related to the above described k-anonymity."),(0,s.kt)("h3",{id:"censorship-resistance"},"Censorship Resistance"),(0,s.kt)("p",null,"Another security related property that Waku aims to offer is censorship resistance.\nCensorship resistance guarantees that users can participate even if an attacker tries to deny them access.\nSo, censorship resistance ties into the availability aspect of security.\nIn the context of Waku that means users should be able to send messages as well as receive all messages they are interested in,\neven if an attacker tries to prevent them from disseminating messages or tries to deny them access to messages."),(0,s.kt)("p",null,"Currently, Waku only guarantees censorship resistance in the weak single node attacker model.\nWhile currently employed secure channels mitigate targeted censorship, e.g. blocking specific content topics,\ngeneral censorship resistance in strong attacker models is part of our roadmap.\nAmong other options, we will investigate ",(0,s.kt)("a",{parentName:"p",href:"https://www.pluggabletransports.info/about/"},"Pluggable Transports")," in future articles."),(0,s.kt)("h2",{id:"attacker-types"},"Attacker Types"),(0,s.kt)("p",null,"The following lists various attacker types with varying degrees of power.\nThe more power an attacker has, the more difficult it is to gain the respective attacker position."),(0,s.kt)("p",null,"Each attacker type comes in a passive and an active variant.\nWhile a passive attacker can stay hidden and is not suspicious,\nthe respective active attacker has more (or at least the same) deanonymization power."),(0,s.kt)("p",null,"We also distinguish between internal and external attackers."),(0,s.kt)("h3",{id:"internal"},"Internal"),(0,s.kt)("p",null,"With respect to Waku relay, an internal attacker participates in the same pubsub topic as its victims.\nWithout additional measures on higher layer protocols, access to an internal position is easy to get."),(0,s.kt)("h4",{id:"single-node"},"Single Node"),(0,s.kt)("p",null,"This attacker controls a single node.\nBecause this position corresponds to normal usage of Waku relay, it is trivial to obtain."),(0,s.kt)("h4",{id:"multi-node"},"Multi Node"),(0,s.kt)("p",null,"This attacker controls several nodes. We assume a smaller static number of controlled nodes.\nThe multi node position can be achieved relatively easily by setting up multiple nodes.\nBotnets might be leveraged to increase the number of available hosts.\nMulti node attackers could use ",(0,s.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Sybil_attack"},"Sybil attacks")," to increase the number of controlled nodes.\nA countermeasure is for nodes to only accept libp2p gossipsub graft requests from peers with different IP addresses, or even different subnets."),(0,s.kt)("h4",{id:"linearly-scaling-nodes"},"Linearly Scaling Nodes"),(0,s.kt)("p",null,"This attacker controls a number of nodes that scales linearly with the number of nodes in the network.\nThis attacker is especially interesting to investigate in the context of DHT security,\nwhich Waku uses for ambient peer discovery."),(0,s.kt)("h3",{id:"external"},"External"),(0,s.kt)("p",null,"An external attacker can only see encrypted traffic (protected by a secure channel set up with ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/waku-org/specs/blob/master/standards/application/noise.md"},"WAKU2-NOISE"),").\nBecause an internal position can be easily obtained,\nin practice external attackers would mount combined attacks that leverage both internal an external attacks.\nWe cover this more below when describing attacks."),(0,s.kt)("h4",{id:"local"},"Local"),(0,s.kt)("p",null,"A local attacker has access to communication links in a local network segment.\nThis could be a rogue access point (with routing capability)."),(0,s.kt)("h4",{id:"as"},"AS"),(0,s.kt)("p",null,"An AS attacker controls a single AS (autonomous system).\nA passive AS attacker can listen to traffic on arbitrary links within the AS.\nAn active AS attacker can drop, inject, and alter traffic on arbitrary links within the AS."),(0,s.kt)("p",null,"In practice, a malicious ISP would be considered as an AS attacker.\nA malicious ISP could also easily setup a set of nodes at specific points in the network,\ngaining internal attack power similar to a strong multi node attacker."),(0,s.kt)("h4",{id:"global-on-net"},"Global On-Net"),(0,s.kt)("p",null,"A global on-net attacker has complete overview over the whole network.\nA passive global attacker can listen to traffic on all links,\nwhile the active global attacker basically carries the traffic: it can freely drop, inject, and alter traffic at all positions in the network.\nThis basically corresponds to the ",(0,s.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Dolev%E2%80%93Yao_model"},"Dolev-Yao model"),"."),(0,s.kt)("p",null,"An entity with this power would, in practice, also have the power of the internal linearly scaling nodes attacker."),(0,s.kt)("h2",{id:"attack-based-threat-analysis"},"Attack-based Threat Analysis"),(0,s.kt)("p",null,"The following lists various attacks including the weakest attacker model in which the attack can be successfully performed.\nThe respective attack can be performed in all stronger attacker models as well."),(0,s.kt)("p",null,"An attack is considered more powerful if it can be successfully performed in a weaker attacker model."),(0,s.kt)("p",null,"If not stated otherwise, we look at these attacks with respect to their capability to deanonymize the message sender."),(0,s.kt)("h3",{id:"scope"},"Scope"),(0,s.kt)("p",null,"In this post, we introduce a simple tightly scoped threat model for Waku v2 Relay, which will be extended in the course of this article series."),(0,s.kt)("p",null,"In this first post, we will look at the relay protocol in isolation.\nEven though many threats arise from layers Waku relay is based on, and layers that in turn live on top of relay,\nwe want to first look at relay in isolation because it is at the core of Waku v2.\nAddressing and trying to solve all security issues of a complex system at once is an overwhelming task, which is why we focus on the soundness of relay first."),(0,s.kt)("p",null,"This also goes well with the modular design philosophy of Waku v2, as layers of varying levels of security guarantees can be built on top of relay, all of which can relay on the guarantees that Waku provides.\nInstead of looking at a multiplicative explosion of possible interactions, we look at the core in this article, and cover the most relevant combinations in future posts."),(0,s.kt)("p",null,"Further restricting the scope, we will look at the data field of a relay message as a black box.\nIn a second article on Waku v2 relay, we will look into the data field, which according to the ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/standards/core/11/relay#message-fields"},"specification of Waku v2 relay")," must be a ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/standards/core/14/message"},"Waku v2 message"),".\nWe only consider messages with version field ",(0,s.kt)("inlineCode",{parentName:"p"},"2"),", which indicates that the payload has to be encoded using ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/waku-org/specs/blob/master/standards/application/noise.md"},"WAKU2-NOISE"),"."),(0,s.kt)("h3",{id:"prerequisite-get-a-specific-position-in-the-network"},"Prerequisite: Get a Specific Position in the Network"),(0,s.kt)("p",null,"Some attacks require the attacker node(s) to be in a specific position in the network.\nIn most cases, this corresponds to trying to get into the mesh peer list for the desired pubsub topic of the victim node."),(0,s.kt)("p",null,"In libp2p gossipsub, and by extension Waku v2 relay, nodes can simply send a graft message for the desired topic to the victim node.\nIf the victim node still has open slots, the attacker gets the desired position.\nThis only requires the attacker to know the gossipsub multiaddress of the victim node."),(0,s.kt)("p",null,"A linearly scaling nodes attacker can leverage DHT based discovery systems to boost the probability of malicious nodes being returned, which in turn significantly increases the probability of attacker nodes ending up in the peer lists of victim nodes.\n",(0,s.kt)("a",{parentName:"p",href:"https://vac.dev/wakuv2-apd"},"Waku v2 discv5")," will employ countermeasures that mitigate the amplifying effect this attacker type can achieve."),(0,s.kt)("h3",{id:"replay-attack"},"Replay Attack"),(0,s.kt)("p",null,"In the scope we defined above, Waku v2 is resilient against replay attacks.\nGossipSub nodes, and by extension Waku relay nodes, feature a ",(0,s.kt)("inlineCode",{parentName:"p"},"seen")," cache, and only relay messages they have not seen before.\nFurther, replay attacks will be punished by ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/standards/core/17/rln-relay"},"RLN")," and ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/deprecated/18/swap"},"SWAP"),"."),(0,s.kt)("h3",{id:"neighbourhood-surveillance"},"Neighbourhood Surveillance"),(0,s.kt)("p",null,"This attack can be performed by a single node attacker that is connected to all peers of the victim node ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," with respect to a specific topic mesh.\nThe attacker also has to be connected to ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"))))),".\nIn this position, the attacker will receive messages ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("msub",{parentName:"mrow"},(0,s.kt)("mi",{parentName:"msub"},"m"),(0,s.kt)("mi",{parentName:"msub"},"v"))),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"m_v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.5806em",verticalAlign:"-0.15em"}}),(0,s.kt)("span",{parentName:"span",className:"mord"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,s.kt)("span",{parentName:"span",className:"msupsub"},(0,s.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,s.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,s.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,s.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.03588em"}},"v")))),(0,s.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,s.kt)("span",{parentName:"span"}))))))))))," sent by ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," both on the direct path from ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"))))),", and on indirect paths relayed by peers of ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"))))),".\nIt will also receive messages ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("msub",{parentName:"mrow"},(0,s.kt)("mi",{parentName:"msub"},"m"),(0,s.kt)("mi",{parentName:"msub"},"x"))),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"m_x")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.5806em",verticalAlign:"-0.15em"}}),(0,s.kt)("span",{parentName:"span",className:"mord"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,s.kt)("span",{parentName:"span",className:"msupsub"},(0,s.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,s.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,s.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,s.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"x")))),(0,s.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,s.kt)("span",{parentName:"span"}))))))))))," that are not sent by ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"))))),". These messages ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("msub",{parentName:"mrow"},(0,s.kt)("mi",{parentName:"msub"},"m"),(0,s.kt)("mi",{parentName:"msub"},"x"))),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"m_x")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.5806em",verticalAlign:"-0.15em"}}),(0,s.kt)("span",{parentName:"span",className:"mord"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,s.kt)("span",{parentName:"span",className:"msupsub"},(0,s.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,s.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,s.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,s.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"x")))),(0,s.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,s.kt)("span",{parentName:"span"}))))))))))," are relayed by both ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," and the peers of ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"))))),".\nMessages that are received (significantly) faster from ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," than from any other of ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"))))),"'s peers are very likely messages that ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," sent,\nbecause for these messages the attacker is one hop closer to the source."),(0,s.kt)("p",null,"The attacker can (periodically) measure latency between itself and ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"))))),", and between itself and the peers of ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," to get more accurate estimates for the expected timings.\nAn AS attacker (and if the topology allows, even a local attacker) could also learn the latency between ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," and its well-behaving peers.\nAn active AS attacker could also increase the latency between ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," and its peers to make the timing differences more prominent.\nThis, however, might lead to ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," switching to other peers."),(0,s.kt)("p",null,"This attack cannot (reliably) distinguish messages ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("msub",{parentName:"mrow"},(0,s.kt)("mi",{parentName:"msub"},"m"),(0,s.kt)("mi",{parentName:"msub"},"v"))),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"m_v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.5806em",verticalAlign:"-0.15em"}}),(0,s.kt)("span",{parentName:"span",className:"mord"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,s.kt)("span",{parentName:"span",className:"msupsub"},(0,s.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,s.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,s.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,s.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.03588em"}},"v")))),(0,s.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,s.kt)("span",{parentName:"span"}))))))))))," sent by ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," from messages ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("msub",{parentName:"mrow"},(0,s.kt)("mi",{parentName:"msub"},"m"),(0,s.kt)("mi",{parentName:"msub"},"y"))),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"m_y")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.7167em",verticalAlign:"-0.2861em"}}),(0,s.kt)("span",{parentName:"span",className:"mord"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,s.kt)("span",{parentName:"span",className:"msupsub"},(0,s.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,s.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,s.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,s.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.03588em"}},"y")))),(0,s.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.2861em"}},(0,s.kt)("span",{parentName:"span"}))))))))))," relayed by peers of ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," the attacker is not connected to.\nStill, there are hop-count variations that might be leveraged.\nMessages ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("msub",{parentName:"mrow"},(0,s.kt)("mi",{parentName:"msub"},"m"),(0,s.kt)("mi",{parentName:"msub"},"v"))),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"m_v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.5806em",verticalAlign:"-0.15em"}}),(0,s.kt)("span",{parentName:"span",className:"mord"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,s.kt)("span",{parentName:"span",className:"msupsub"},(0,s.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,s.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,s.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,s.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.03588em"}},"v")))),(0,s.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,s.kt)("span",{parentName:"span"}))))))))))," always have a hop-count of 1 on the path from ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," to the attacker, while all other paths are longer.\nMessages ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("msub",{parentName:"mrow"},(0,s.kt)("mi",{parentName:"msub"},"m"),(0,s.kt)("mi",{parentName:"msub"},"y"))),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"m_y")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.7167em",verticalAlign:"-0.2861em"}}),(0,s.kt)("span",{parentName:"span",className:"mord"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,s.kt)("span",{parentName:"span",className:"msupsub"},(0,s.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1514em"}},(0,s.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,s.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,s.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,s.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.03588em"}},"y")))),(0,s.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,s.kt)("span",{parentName:"span",className:"vlist-r"},(0,s.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.2861em"}},(0,s.kt)("span",{parentName:"span"}))))))))))," might have the same hop-count on the path from ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," as well as on other paths."),(0,s.kt)("h3",{id:"controlled-neighbourhood"},"Controlled Neighbourhood"),(0,s.kt)("p",null,"If a multi node attacker manages to control all peers of the victim node, it can trivially tell which messages originated from ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"))))),"."),(0,s.kt)("h3",{id:"observing-messages"},"Observing Messages"),(0,s.kt)("p",null,"If Waku relay was not protected with Noise, the AS attacker could simply check for messages leaving ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," which have not been relayed to ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"))))),".\nThese are the messages sent by ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"))))),".\nWaku relay protects against this attack by employing secure channels setup using Noise."),(0,s.kt)("h3",{id:"correlation"},"Correlation"),(0,s.kt)("p",null,"Monitoring all traffic (in an AS or globally), allows the attacker to identify traffic correlated with messages originating from ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"))))),".\nThis (alone) does not allow an external attacker to learn which message ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mi",{parentName:"mrow"},"v")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"v")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,s.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v")))))," sent, but it allows identifying the respective traffic propagating through the network.\nThe more traffic in the network, the lower the success rate of this attack."),(0,s.kt)("p",null,"Combined with just a few nodes controlled by the attacker, the actual message associated with the correlated traffic can eventually be identified."),(0,s.kt)("h3",{id:"dos"},"DoS"),(0,s.kt)("p",null,"An active single node attacker could run a disruption attack by"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"(1) dropping messages that should be relayed"),(0,s.kt)("li",{parentName:"ul"},"(2) flooding neighbours with bogus messages")),(0,s.kt)("p",null,"While (1) has a negative effect on availability, the impact is not significant.\nA linearly scaling botnet attacker, however, could significantly disrupt the network with such an attack.\n(2) is thwarted by ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/standards/core/17/rln-relay"},"RLN"),".\nAlso ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/deprecated/18/swap"},"SWAP")," helps mitigating DoS attacks."),(0,s.kt)("p",null,"A local attacker can DoS Waku by dropping all Waku traffic within its controlled network segment.\nAn AS attacker can DoS Waku within its authority, while a global attacker can DoS the whole network.\nA countermeasure are censorship resistance techniques like ",(0,s.kt)("a",{parentName:"p",href:"https://www.pluggabletransports.info/about/"},"Pluggable Transports"),"."),(0,s.kt)("h2",{id:"summary-and-future-work"},"Summary and Future Work"),(0,s.kt)("p",null,"Currently, Waku v2 relay offers k-anonymity with respect to receiver anonymity.\nThis also includes k-anonymity towards legitimate members of the same topic."),(0,s.kt)("p",null,"Waku v2 relay offers sender anonymity in the single node attacker model with its ",(0,s.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/waku/standards/core/11/relay/#signature-policy"},"strict no sign policy"),".\nCurrently, Waku v2 does not guarantee sender anonymity in the multi node and stronger attacker models.\nHowever, we are working on modular anonymity-preserving protocols and building blocks as part of our privacy/anonymity roadmap.\nThe goal is to allow tunable anonymity with respect to trade offs between ",(0,s.kt)("em",{parentName:"p"},"strong anonymity"),", ",(0,s.kt)("em",{parentName:"p"},"low bandwidth"),", and ",(0,s.kt)("em",{parentName:"p"},"low latency"),".\nAll of these cannot be fully guaranteed as the ",(0,s.kt)("a",{parentName:"p",href:"https://freedom.cs.purdue.edu/projects/trilemma.html"},"the anonymity trilemma")," states.\nSome applications have specific requirements, e.g. low latency, which require a compromise on anonymity.\nAnonymity-preserving mechanisms we plan to investigate and eventually specify as pluggable anonymity protocols for Waku comprise"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://arxiv.org/abs/1805.11060"},"Dandelion++")," for lightweight anonymity;"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Onion_routing"},"onion routing")," as a building block adding a low latency anonymization layer;"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Mix_network"},"a mix network")," for providing strong anonymity (on top of onion routing) even in the strongest attacker model at the cost of higher latency.")),(0,s.kt)("p",null,"These pluggable anonymity-preserving protocols will form a sub-set of the Waku v2 protocol set.\nAs an intermediate step, we might directly employ Tor for onion-routing, and ",(0,s.kt)("a",{parentName:"p",href:"https://nymtech.net/"},"Nym")," as a mix-net layer."),(0,s.kt)("p",null,"In future research log posts, we will cover further Waku v2 protocols and identify anonymity problems that will be added to our roadmap.\nThese protocols comprise"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/core/13/store"},"13/WAKU2-STORE"),", which can violate receiver anonymity as it allows filtering by content topic.\nA countermeasure is using the content topic exclusively for local filters."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/core/12/filter"},"12/WAKU2-FILTER"),", which discloses nodes' interest in topics;"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/core/19/lightpush"},"19/WAKU2-LIGHTPUSH"),", which also discloses nodes' interest in topics and links the lightpush client as the sender of a message to the lightpush service node;"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/application/21/fault-tolerant-store"},"21/WAKU2-FTSTORE"),", which discloses nodes' interest in specific time ranges allowing to infer information like online times.")),(0,s.kt)("p",null,"While these protocols are not necessary for the operation of Waku v2, and can be seen as pluggable features,\nwe aim to provide alternatives without the cost of lowering the anonymity level."),(0,s.kt)("h2",{id:"references"},"References"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/core/10/waku2"},"10/WAKU2")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/core/11/relay"},"11/WAKU2-RELAY")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/README.md"},"libp2p GossipSub")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Information_security"},"Security")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Authentication"},"Authentication")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Non-repudiation"},"Non-repudiation")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://noiseprotocol.org/"},"Noise Protocol Framework")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Plausible_deniability#Use_in_cryptography"},"plausible deniability")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/core/14/message"},"Waku v2 message")),(0,s.kt)("li",{parentName:"ul"},"[partitioned topics]","(",(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/status/deprecated/10/waku-usage"},"https://rfc.vac.dev/status/deprecated/10/waku-usage"),"\n#partitioned-topic)"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Sybil_attack"},"Sybil attack")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Dolev%E2%80%93Yao_model"},"Dolev-Yao model")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/waku-org/specs/blob/master/standards/application/noise.md"},"WAKU2-NOISE")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://vac.dev/wakuv2-apd"},"33/WAKU2-DISCV5")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/p2p-interface.md#why-are-we-using-the-strictnosign-signature-policy"},"strict no sign policy")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/core/11/relay#signature-policy"},"Waku v2 strict no sign policy")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/core/17/rln-relay"},"17/WAKU-RLN-RELAY")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://freedom.cs.purdue.edu/projects/trilemma.html"},"anonymity trilemma")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/deprecated/18/swap"},"18/WAKU2-SWAP")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://www.pluggabletransports.info/about/"},"Pluggable Transports")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://nymtech.net/"},"Nym")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://arxiv.org/abs/1805.11060"},"Dandelion++")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/core/13/store"},"13/WAKU2-STORE")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/core/12/filter"},"12/WAKU2-FILTER")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/core/19/lightpush"},"19/WAKU2-LIGHTPUSH")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://rfc.vac.dev/waku/standards/application/21/fault-tolerant-store"},"21/WAKU2-FTSTORE"))))}c.isMDXComponent=!0},3905:(a,e,t)=>{t.d(e,{Zo:()=>o,kt:()=>k});var n=t(67294);function s(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function i(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),t.push.apply(t,n)}return t}function r(a){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?i(Object(t),!0).forEach((function(e){s(a,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(t,e))}))}return a}function m(a,e){if(null==a)return{};var t,n,s=function(a,e){if(null==a)return{};var t,n,s={},i=Object.keys(a);for(n=0;n<i.length;n++)t=i[n],e.indexOf(t)>=0||(s[t]=a[t]);return s}(a,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);for(n=0;n<i.length;n++)t=i[n],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(a,t)&&(s[t]=a[t])}return s}var p=n.createContext({}),l=function(a){var e=n.useContext(p),t=e;return a&&(t="function"==typeof a?a(e):r(r({},e),a)),t},o=function(a){var e=l(a.components);return n.createElement(p.Provider,{value:e},a.children)},c={inlineCode:"code",wrapper:function(a){var e=a.children;return n.createElement(n.Fragment,{},e)}},h=n.forwardRef((function(a,e){var t=a.components,s=a.mdxType,i=a.originalType,p=a.parentName,o=m(a,["components","mdxType","originalType","parentName"]),h=l(t),k=s,N=h["".concat(p,".").concat(k)]||h[k]||c[k]||i;return t?n.createElement(N,r(r({ref:e},o),{},{components:t})):n.createElement(N,r({ref:e},o))}));function k(a,e){var t=arguments,s=e&&e.mdxType;if("string"==typeof a||s){var i=t.length,r=new Array(i);r[0]=h;var m={};for(var p in e)hasOwnProperty.call(e,p)&&(m[p]=e[p]);m.originalType=a,m.mdxType="string"==typeof a?a:s,r[1]=m;for(var l=2;l<i;l++)r[l]=t[l];return n.createElement.apply(null,r)}return n.createElement.apply(null,t)}h.displayName="MDXCreateElement"},64287:(a,e,t)=>{t.d(e,{Z:()=>n});const n="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB3aWR0aD0iMjEuMzEyMTEzbW0iCiAgIGhlaWdodD0iMjQuODY2NzIybW0iCiAgIHZpZXdCb3g9IjAgMCAyMS4zMTIxMTMgMjQuODY2NzIyIgogICB2ZXJzaW9uPSIxLjEiCiAgIGlkPSJzdmc1IgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMyIiAvPgogIDxnCiAgICAgaWQ9ImxheWVyMSIKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMy42NTM0ODM0LC02LjE1OTM5ODQpIj4KICAgIDxlbGxpcHNlCiAgICAgICBzdHlsZT0iZmlsbDojYzgwMDAwO2ZpbGwtb3BhY2l0eTowLjI7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlLXdpZHRoOjAuMjY0NTgzIgogICAgICAgaWQ9InBhdGgzOS0zIgogICAgICAgY3g9Ii04LjA5NDkxMTYiCiAgICAgICBjeT0iMTUuMzc4NTM4IgogICAgICAgcng9IjkuMzkyNzA3OCIKICAgICAgIHJ5PSIzLjk2ODc1IgogICAgICAgdHJhbnNmb3JtPSJyb3RhdGUoLTYwLjczMzYxMykiIC8+CiAgICA8ZWxsaXBzZQogICAgICAgc3R5bGU9ImZpbGw6IzAwMDA2NDtmaWxsLW9wYWNpdHk6MC4yO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZS13aWR0aDowLjI2NDU4MyIKICAgICAgIGlkPSJwYXRoMzktNiIKICAgICAgIGN4PSIxNC4xMTAyNDMiCiAgICAgICBjeT0iMjIuNDY4NjI4IgogICAgICAgcng9IjkuMzkyNzA3OCIKICAgICAgIHJ5PSIzLjk2ODc1IiAvPgogICAgPGVsbGlwc2UKICAgICAgIHN0eWxlPSJmaWxsOiMyODAwMjg7ZmlsbC1vcGFjaXR5OjAuMztmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2Utd2lkdGg6MC4xOTU5MDEiCiAgICAgICBpZD0icGF0aDM5LTciCiAgICAgICBjeD0iMTQuMTIzMzI5IgogICAgICAgY3k9IjI5LjA3NDIzNiIKICAgICAgIHJ4PSIxMC40Njk4NDYiCiAgICAgICByeT0iMS45NTE4ODUxIiAvPgogICAgPGVsbGlwc2UKICAgICAgIHN0eWxlPSJmaWxsOiMwMDY0MDA7ZmlsbC1vcGFjaXR5OjAuMjtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2Utd2lkdGg6MC4yNjQ1ODMiCiAgICAgICBpZD0iZWxsaXBzZTc4NyIKICAgICAgIGN4PSItMjIuMTEyMzEyIgogICAgICAgY3k9Ii05LjYzNDU1MDEiCiAgICAgICByeD0iOS4zOTI3MDc4IgogICAgICAgcnk9IjMuOTY4NzUiCiAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCgtMC40ODg4NzA3NiwtMC44NzIzNTYyMiwtMC44NzIzNTYyMiwwLjQ4ODg3MDc2LDAsMCkiIC8+CiAgICA8dGV4dAogICAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zaXplOjEuNTQxNTVweDtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wMzg1Mzg2IgogICAgICAgeD0iLTEwLjYzMjMwNSIKICAgICAgIHk9IjE2LjM2NjU3OSIKICAgICAgIGlkPSJ0ZXh0NDI1OSIKICAgICAgIHRyYW5zZm9ybT0icm90YXRlKC01NS4wMjk4MDcpIj48dHNwYW4KICAgICAgICAgaWQ9InRzcGFuNDI1NyIKICAgICAgICAgc3R5bGU9InN0cm9rZS13aWR0aDowLjAzODUzODYiCiAgICAgICAgIHg9Ii0xMC42MzIzMDUiCiAgICAgICAgIHk9IjE2LjM2NjU3OSI+bG93IGxhdGVuY3k8L3RzcGFuPjwvdGV4dD4KICAgIDx0ZXh0CiAgICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgICAgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXNpemU6MS42MDUxN3B4O2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjA0MDEyOTQiCiAgICAgICB4PSIxNy4xMzU3NCIKICAgICAgIHk9Ii04Ljc1MjMyNiIKICAgICAgIGlkPSJ0ZXh0MTAzMjMiCiAgICAgICB0cmFuc2Zvcm09InJvdGF0ZSg1OC4wMjkxOSkiPjx0c3BhbgogICAgICAgICBpZD0idHNwYW4xMDMyMSIKICAgICAgICAgc3R5bGU9InN0cm9rZS13aWR0aDowLjA0MDEyOTQiCiAgICAgICAgIHg9IjE3LjEzNTc0IgogICAgICAgICB5PSItOC43NTIzMjYiPmxvdyBiYW5kd2lkdGg8L3RzcGFuPjwvdGV4dD4KICAgIDx0ZXh0CiAgICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgICAgc3R5bGU9ImZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXNpemU6MS41NTM0NnB4O2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjAzODgzNjciCiAgICAgICB4PSI3LjQ3NTA3ODYiCiAgICAgICB5PSIyMi45MzU0IgogICAgICAgaWQ9InRleHQxMjk0MyI+PHRzcGFuCiAgICAgICAgIGlkPSJ0c3BhbjEyOTQxIgogICAgICAgICBzdHlsZT0ic3Ryb2tlLXdpZHRoOjAuMDM4ODM2NyIKICAgICAgICAgeD0iNy40NzUwNzg2IgogICAgICAgICB5PSIyMi45MzU0Ij5zdHJvbmcgYW5vbnltaXR5PC90c3Bhbj48L3RleHQ+CiAgICA8dGV4dAogICAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICAgIHN0eWxlPSJmb250LXN0eWxlOm5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zaXplOjEuNDk2MjFweDtmb250LWZhbWlseTpzYW5zLXNlcmlmO2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC4wMzc0MDUzIgogICAgICAgeD0iNi4xNjc4NDEiCiAgICAgICB5PSIyOS42ODc5MjUiCiAgICAgICBpZD0idGV4dDE0MzgzIj48dHNwYW4KICAgICAgICAgaWQ9InRzcGFuMTQzODEiCiAgICAgICAgIHN0eWxlPSJzdHJva2Utd2lkdGg6MC4wMzc0MDUzIgogICAgICAgICB4PSI2LjE2Nzg0MSIKICAgICAgICAgeT0iMjkuNjg3OTI1Ij5mcmVxdWVuY3kgLyBwYXR0ZXJuPC90c3Bhbj48L3RleHQ+CiAgPC9nPgo8L3N2Zz4K"},84711:(a,e,t)=>{t.d(e,{Z:()=>n});const n=t.p+"assets/images/libp2p_gossipsub_types_of_peering-d0772153a5d11dea7b24c0bdc307a93d.png"}}]);