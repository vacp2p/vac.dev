"use strict";(self.webpackChunkvac_dev=self.webpackChunkvac_dev||[]).push([[8056],{16486:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>u});var n=a(87462),r=(a(67294),a(3905));const o={layout:"post",name:"Presenting JS-Waku: Waku v2 in the Browser",title:"Presenting JS-Waku: Waku v2 in the Browser",date:new Date("2021-06-04T12:00:00.000Z"),authors:"franck",published:!0,slug:"presenting-js-waku",categories:"platform",image:"/img/js-waku-gist.png",discuss:"https://forum.vac.dev/t/discussion-presenting-js-waku-waku-v2-in-the-browser/81"},s=void 0,i={permalink:"/rlog/presenting-js-waku",source:"@site/rlog/2021-06-04-presenting-js-waku.mdx",title:"Presenting JS-Waku: Waku v2 in the Browser",description:"JS-Waku is bringing Waku v2 to the browser. Learn what we achieved so far and what is next in our pipeline!",date:"2021-06-04T12:00:00.000Z",formattedDate:"June 4, 2021",tags:[],readingTime:6.84,hasTruncateMarker:!0,authors:[{name:"Franck",twitter:"fryorcraken",github:"fryorcraken",key:"franck"}],frontMatter:{layout:"post",name:"Presenting JS-Waku: Waku v2 in the Browser",title:"Presenting JS-Waku: Waku v2 in the Browser",date:"2021-06-04T12:00:00.000Z",authors:"franck",published:!0,slug:"presenting-js-waku",categories:"platform",image:"/img/js-waku-gist.png",discuss:"https://forum.vac.dev/t/discussion-presenting-js-waku-waku-v2-in-the-browser/81"},prevItem:{title:"[Talk at COSCUP] Vac, Waku v2 and Ethereum Messaging",permalink:"/rlog/waku-v2-ethereum-coscup"},nextItem:{title:"Privacy-preserving p2p economic spam protection in Waku v2",permalink:"/rlog/rln-relay"}},p={authorsImageUrls:[void 0]},u=[{value:"Waku v2",id:"waku-v2",level:2},{value:"Waku v2 in the browser",id:"waku-v2-in-the-browser",level:2},{value:"Achievements so far",id:"achievements-so-far",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}],l={toc:u};function c(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"JS-Waku is bringing Waku v2 to the browser. Learn what we achieved so far and what is next in our pipeline!"),(0,r.kt)("p",null,"For the past 3 months, we have been working on bringing Waku v2 to the browser.\nOur aim is to empower dApps with Waku v2, and it led to the creation of a new library.\nWe believe now is good time to introduce it!"),(0,r.kt)("h2",{id:"waku-v2"},"Waku v2"),(0,r.kt)("p",null,"First, let's review what Waku v2 is and what problem it is trying to solve."),(0,r.kt)("p",null,"Waku v2 comes from a need to have a more scalable, better optimised solution for the Status app to achieve decentralised\ncommunications on resource restricted devices (i.e., mobile phones)."),(0,r.kt)("p",null,"The Status chat feature was initially built over Whisper.\nHowever, Whisper has a number of caveats which makes it inefficient for mobile phones.\nFor example, with Whisper, all devices are receiving all messages which is not ideal for limited data plans."),(0,r.kt)("p",null,"To remediate this, a Waku mode (then Waku v1), based on devp2p, was introduced.\nTo further enable web and restricted resource environments, Waku v2 was created based on libp2p.\nThe migration of the Status chat feature to Waku v2 is currently in progress."),(0,r.kt)("p",null,"We see the need of such solution in the broader Ethereum ecosystem, beyond Status.\nThis is why we are building Waku v2 as a decentralised communication platform for all to use and build on.\nIf you want to read more about Waku v2 and what it aims to achieve,\ncheckout ",(0,r.kt)("a",{parentName:"p",href:"/waku-v2-plan"},"What's the Plan for Waku v2?"),"."),(0,r.kt)("p",null,"Since last year, we have been busy defining and implementing Waku v2 protocols in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/nim-waku"},"nim-waku"),",\nfrom which you can build ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/nim-waku#wakunode"},"wakunode2"),".\nWakunode2 is an adaptive and modular Waku v2 node,\nit allows users to run their own node and use the Waku v2 protocols they need.\nThe nim-waku project doubles as a library, that can be used to add Waku v2 support to native applications."),(0,r.kt)("h2",{id:"waku-v2-in-the-browser"},"Waku v2 in the browser"),(0,r.kt)("p",null,"We believe that dApps and wallets can benefit from the Waku network in several ways.\nFor some dApps, it makes sense to enable peer-to-peer communications.\nFor others, machine-to-machine communications would be a great asset.\nFor example, in the case of a DAO,\nWaku could be used for gas-less voting.\nEnabling the DAO to notify their users of a new vote,\nand users to vote without interacting with the blockchain and spending gas."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/murmur"},"Murmur")," was the first attempt to bring Whisper to the browser,\nacting as a bridge between devp2p and libp2p.\nOnce Waku v2 was started and there was a native implementation on top of libp2p,\na ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/waku-web-chat"},"chat POC")," was created to demonstrate the potential of Waku v2\nin web environment.\nIt showed how using js-libp2p with few modifications enabled access to the Waku v2 network.\nThere was still some unresolved challenges.\nFor example, nim-waku only support TCP connections which are not supported by browser applications.\nHence, to connect to other node, the POC was connecting to a NodeJS proxy application using websockets,\nwhich in turn could connect to wakunode2 via TCP."),(0,r.kt)("p",null,"However, to enable dApp and Wallet developers to easily integrate Waku in their product,\nwe need to give them a library that is easy to use and works out of the box:\nintroducing ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/js-waku"},"JS-Waku"),"."),(0,r.kt)("p",null,"JS-Waku is a JavaScript library that allows your dApp, wallet or other web app to interact with the Waku v2 network.\nIt is available right now on ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/js-waku"},"npm"),":"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"npm install js-waku"),"."),(0,r.kt)("p",null,"As it is written in TypeScript, types are included in the npm package to allow easy integration with TypeScript, ClojureScript and other typed languages that compile to JavaScript."),(0,r.kt)("p",null,"Key Waku v2 protocols are already available:\n",(0,r.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/14/"},"message"),", ",(0,r.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/13/"},"store"),", ",(0,r.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/11/"},"relay")," and ",(0,r.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/19/"},"light push"),",\nenabling your dApp to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Send and receive near-instant messages on the Waku network (relay),"),(0,r.kt)("li",{parentName:"ul"},"Query nodes for messages that may have been missed, e.g. due to poor cellular network (store),"),(0,r.kt)("li",{parentName:"ul"},"Send messages with confirmations (light push).")),(0,r.kt)("p",null,"JS-Waku needs to operate in the same context from which Waku v2 was born:\na restricted environment were connectivity or uptime are not guaranteed;\nJS-Waku brings Waku v2 to the browser."),(0,r.kt)("h2",{id:"achievements-so-far"},"Achievements so far"),(0,r.kt)("p",null,"We focused the past month on developing a ",(0,r.kt)("a",{parentName:"p",href:"https://status-im.github.io/js-waku/"},"ReactJS Chat App"),".\nThe aim was to create enough building blocks in JS-Waku to enable this showcase web app that\nwe now ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/nim-waku/issues/399"},"use for dogfooding")," purposes."),(0,r.kt)("p",null,"Most of the effort was on getting familiar with the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/libp2p/js-libp2p"},"js-libp2p")," library\nthat we heavily rely on.\nJS-Waku is the second implementation of Waku v2 protocol,\nso a lot of effort on interoperability was needed.\nFor example, to ensure compatibility with the nim-waku reference implementation,\nwe run our ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/js-waku/blob/90c90dea11dfd1277f530cf5d683fb92992fe141/src/lib/waku_relay/index.spec.ts#L137"},"tests against wakunode2")," as part of the CI."),(0,r.kt)("p",null,"This interoperability effort helped solidify the current Waku v2 specifications:\nBy clarifying the usage of topics\n(",(0,r.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/rfc/issues/327"},"#327"),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/rfc/pull/383"},"#383"),"),\nfix discrepancies between specs and nim-waku\n(",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/nim-waku/issues/418"},"#418"),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/nim-waku/issues/419"},"#419"),")\nand fix small nim-waku & nim-libp2p bugs\n(",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/nim-waku/issues/411"},"#411"),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/nim-waku/issues/439"},"#439"),")."),(0,r.kt)("p",null,"To fully access the waku network, JS-Waku needs to enable web apps to connect to nim-waku nodes.\nA standard way to do so is using secure websockets as it is not possible to connect directly to a TCP port from the browser.\nUnfortunately websocket support is not yet available in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/nim-libp2p/issues/407"},"nim-libp2p")," so\nwe ended up deploying ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/novnc/websockify"},"websockify")," alongside wakunode2 instances."),(0,r.kt)("p",null,"As we built the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/js-waku/tree/main/examples/web-chat"},"web chat app"),",\nwe were able to fine tune the API to provide a simple and succinct interface.\nYou can start a node, connect to other nodes and send a message in less than ten lines of code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { Waku } from 'js-waku'\n\nconst waku = await Waku.create({})\n\nconst nodes = await getStatusFleetNodes()\nawait Promise.all(nodes.map((addr) => waku.dial(addr)))\n\nconst msg = WakuMessage.fromUtf8String(\n  'Here is a message!',\n  '/my-cool-app/1/my-use-case/proto',\n)\nawait waku.relay.send(msg)\n")),(0,r.kt)("p",null,"We have also put a bounty at ",(0,r.kt)("a",{parentName:"p",href:"https://0xhack.dev/"},"0xHack")," for using JS-Waku\nand running a ",(0,r.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=l77j0VX75QE"},"workshop"),".\nWe were thrilled to have a couple of hackers create new software using our libraries.\nOne of the projects aimed to create a decentralised, end-to-end encrypted messenger app,\nsimilar to what the ",(0,r.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/20/"},"ETH-DM")," protocol aims to achieve.\nAnother project was a decentralised Twitter platform.\nSuch projects allow us to prioritize the work on JS-Waku and understand how DevEx can be improved."),(0,r.kt)("p",null,"As more developers use JS-Waku, we will evolve the API to allow for more custom and fine-tune usage of the network\nwhile preserving this out of the box experience."),(0,r.kt)("h2",{id:"whats-next"},"What's next?"),(0,r.kt)("p",null,"Next, we are directing our attention towards ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/js-waku/issues/68"},"Developer Experience"),".\nWe already have ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/js-waku"},"documentation")," available but we want to provide more:\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/js-waku/issues/56"},"Tutorials"),", various examples\nand showing how ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/js-waku/issues/72"},"JS-Waku can be used with Web3"),"."),(0,r.kt)("p",null,"By prioritizing DevEx we aim to enable JS-Waku integration in dApps and wallets.\nWe think JS-Waku builds a strong case for machine-to-machine (M2M) communications.\nThe first use cases we are looking into are dApp notifications:\nEnabling dApp to notify their user directly in their wallets!\nLeveraging Waku as a decentralised infrastructure and standard so that users do not have to open their dApp to be notified\nof events such as DAO voting."),(0,r.kt)("p",null,"We already have some POC in the pipeline to enable voting and polling on the Waku network,\nallowing users to save gas by ",(0,r.kt)("strong",{parentName:"p"},"not")," broadcasting each individual vote on the blockchain."),(0,r.kt)("p",null,"To facilitate said applications, we are looking at improving integration with Web3 providers by providing examples\nof signing, validating, encrypting and decrypting messages using Web3.\nWaku is privacy conscious, so we will also provide signature and encryption examples decoupled from users' Ethereum identity."),(0,r.kt)("p",null,"As you can read, we have grand plans for JS-Waku and Waku v2.\nThere is a lot to do, and we would love some help so feel free to\ncheck out the new role in our team:\n",(0,r.kt)("a",{parentName:"p",href:"https://status.im/our_team/jobs.html?gh_jid=3157894"},"js-waku: Wallet & Dapp Integration Developer"),".\nWe also have a number of ",(0,r.kt)("a",{parentName:"p",href:"https://status.im/our_team/jobs.html"},"positions")," open to work on Waku protocol and nim-waku."),(0,r.kt)("p",null,"If you are as excited as us by JS-Waku, why not build a dApp with it?\nYou can find documentation on the ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/js-waku"},"npmjs page"),"."),(0,r.kt)("p",null,"Whether you are a developer, you can come chat with us using ",(0,r.kt)("a",{parentName:"p",href:"https://status-im.github.io/js-waku/"},"WakuJS Web Chat"),"\nor ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/status-im/nim-waku/blob/master/docs/tutorial/chat2.md"},"chat2"),".\nYou can get support in #dappconnect-support on ",(0,r.kt)("a",{parentName:"p",href:"https://discord.gg/j5pGbn7MHZ"},"Vac Discord")," or ",(0,r.kt)("a",{parentName:"p",href:"https://t.me/dappconnectsupport"},"Telegram"),".\nIf you have any ideas on how Waku could enable a specific dapp or use case, do share, we are always keen to hear it."))}c.isMDXComponent=!0},3905:(e,t,a)=>{a.d(t,{Zo:()=>l,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),u=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},l=function(e){var t=u(e.components);return n.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),h=u(a),m=r,d=h["".concat(p,".").concat(m)]||h[m]||c[m]||o;return a?n.createElement(d,s(s({ref:t},l),{},{components:a})):n.createElement(d,s({ref:t},l))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,s=new Array(o);s[0]=h;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var u=2;u<o;u++)s[u]=a[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"}}]);