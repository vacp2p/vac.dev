<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay</title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="description" content="Introducing a basic threat model and privacy/anonymity analysis for the Waku v2 relay protocol."/><link rel="shortcut icon" href="/assets/logo/vac/favicon.ico"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="vacp2p"/><meta name="twitter:site" content="@vacp2p"/><meta name="twitter:title" content="Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay"/><meta name="twitter:description" content="Introducing a basic threat model and privacy/anonymity analysis for the Waku v2 relay protocol."/><meta name="twitter:image" content="https://staging.vac.dev/compiled-assets/img/anonymity_trilemma.svg"/><meta property="og:url" content="https://staging.vac.dev//wakuv2-relay-anon"/><meta property="og:image" content="https://staging.vac.dev/compiled-assets/img/anonymity_trilemma.svg"/><meta property="og:site_name" content="Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay"/><meta property="og:title" content="Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay"/><meta property="og:description" content="Introducing a basic threat model and privacy/anonymity analysis for the Waku v2 relay protocol."/><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/e068b41030ceede6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e068b41030ceede6.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cdd95df0746869ac.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cdd95df0746869ac.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script defer="" src="/_next/static/chunks/440.30d6564577c1ada0.js"></script><script src="/_next/static/chunks/webpack-a14325fd952bf0eb.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-ada0258e433ba222.js" defer=""></script><script src="/_next/static/chunks/pages/_app-91f05ffa21c9a6ec.js" defer=""></script><script src="/_next/static/chunks/eb1842f2-90eb16656390ba2a.js" defer=""></script><script src="/_next/static/chunks/399-b4b9981c243e7c94.js" defer=""></script><script src="/_next/static/chunks/108-374a17adb21bb412.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...path%5D%5D-9c3054039bf889f4.js" defer=""></script><script src="/_next/static/-5vfLOflCSkQPJRugO7ZO/_buildManifest.js" defer=""></script><script src="/_next/static/-5vfLOflCSkQPJRugO7ZO/_ssgManifest.js" defer=""></script><script src="/_next/static/-5vfLOflCSkQPJRugO7ZO/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><svg width="0" height="0" xmlns="http://www.w3.org/2000/svg" style="display:none"><defs><filter id="colored"><feColorMatrix type="matrix" values="1.00 0 0 0 0 0 1.00 0 0 0 0 0 1.00 0 0 0 0 0 1 0"></feColorMatrix></filter></defs></svg><style nonce="logos">
      #nprogress {
        pointer-events: none;
      }
      #nprogress .bar {
        background: #000000;
        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
      }
      #nprogress .peg {
        display: block;
        position: absolute;
        right: 0px;
        width: 100px;
        height: 100%;
        box-shadow: 0 0 10px #000000, 0 0 5px #000000;
        opacity: 1;
        -webkit-transform: rotate(3deg) translate(0px, -4px);
        -ms-transform: rotate(3deg) translate(0px, -4px);
        transform: rotate(3deg) translate(0px, -4px);
      }
      #nprogress .spinner {
        display: block;
        position: fixed;
        z-index: 1031;
        top: 15px;
        right: 15px;
      }
      #nprogress .spinner-icon {
        width: 18px;
        height: 18px;
        box-sizing: border-box;
        border: solid 2px transparent;
        border-top-color: #000000;
        border-left-color: #000000;
        border-radius: 50%;
        -webkit-animation: nprogresss-spinner 400ms linear infinite;
        animation: nprogress-spinner 400ms linear infinite;
      }
      .nprogress-custom-parent {
        overflow: hidden;
        position: relative;
      }
      .nprogress-custom-parent #nprogress .spinner,
      .nprogress-custom-parent #nprogress .bar {
        position: absolute;
      }
      @-webkit-keyframes nprogress-spinner {
        0% {
          -webkit-transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
        }
      }
      @keyframes nprogress-spinner {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style><div class="Style_container__qv2Yk Styles_common_container__u_XHj template-container"><header class="Styles_container__5FUI_ Style_header__IYvBP undefined"><div class="Styles_innerWrapper__ZInvp"><div class="logo-holder button vac" style="display:inline-block"><svg width="45" height="43" viewBox="0 0 35 43" fill="none" xmlns="http://www.w3.org/2000/svg" class="vac-logo"><g clip-path="url(#clip0_917_3082)"><path d="M24.9034 14.8217C24.6824 11.2666 23.5308 7.8298 21.5623 4.84994C22.543 4.19721 23.7374 3.93844 24.9034 4.12603C25.492 4.23064 26.0472 4.4722 26.5233 4.83086C26.9994 5.18951 27.3828 5.65504 27.6421 6.18916C28.0141 7.1512 28.1335 8.19117 27.989 9.21147C27.9754 9.6728 27.8955 10.1299 27.7516 10.5688C27.6613 10.8504 27.5322 11.1183 27.3682 11.3651C27.166 11.69 26.9466 12.0041 26.7109 12.3062C26.1084 13.1206 25.5607 14.0073 24.9034 14.8217Z" fill="#999999"></path><path d="M16.7058 7.58268C15.8382 5.99003 14.5344 4.67263 12.9447 3.78217L10.9546 2.69631C10.9546 2.69631 13.2551 -0.778436 16.1945 0.162641C19.134 1.10372 18.1846 7.4017 17.5821 9.80869" fill="#4D4D4D"></path><path d="M20.3209 41.6243C17.4179 40.4118 16.2129 38.3668 14.6975 36.919C13.1821 35.4711 12.8717 29.3903 13.1638 24.6126C13.456 19.8348 17.4909 11.528 17.5822 9.80869C17.6735 8.08941 15.4643 5.17569 13.5655 3.78217C11.6491 2.2631 9.29769 1.38272 6.84668 1.2666L8.36207 2.51534C9.74965 3.67359 9.42101 3.98125 9.22018 6.26155C9.01935 8.54185 8.72722 15.6904 8.70896 21.8436C8.70896 30.3495 6.73713 32.7022 13.0178 38.8373C14.1564 40.1358 15.6863 41.0368 17.3814 41.4072C21.6902 43.036 24.228 43.2712 20.3209 41.6243Z" fill="#1A1A1A"></path><path d="M17.9839 7.07618C17.5904 9.58823 16.8212 12.0281 15.7016 14.3152C14.6765 16.6746 13.7925 19.0918 13.0543 21.5543C12.076 25.3846 11.8405 29.3642 12.3605 33.2816C12.4325 34.6426 12.8065 35.9712 13.4559 37.1726C14.1362 38.1272 14.9759 38.9596 15.939 39.6338C17.8321 41.3312 20.1651 42.4718 22.6761 42.9276C20.068 40.8547 18.189 38.0165 17.3083 34.8199C16.3002 31.5246 16.6412 27.9684 18.2577 24.9205C18.7142 24.0699 19.2436 23.2555 19.7731 22.4411L24.4653 15.3287C24.7022 15.0187 24.8815 14.6694 24.9948 14.2971C25.0769 13.891 25.0769 13.4727 24.9948 13.0665C24.3347 9.48034 22.792 6.11109 20.5034 3.25758C19.9266 2.35717 19.1529 1.59688 18.2395 1.033C17.3262 0.46911 16.2966 0.116066 15.2269 0C15.7121 0.03052 16.1783 0.198543 16.5699 0.484084C16.9616 0.769625 17.2622 1.16066 17.4361 1.61069C17.8159 2.51034 18.0085 3.47679 18.0021 4.45202C18.0507 5.32627 18.0446 6.20267 17.9839 7.07618Z" fill="#808080"></path><path d="M34.927 21.7174C34.8742 21.5895 34.8068 21.4681 34.7261 21.3554C34.5725 21.0145 34.3893 20.6875 34.1784 20.3781C34.0141 20.1429 33.8315 19.9257 33.6489 19.7085C33.2107 19.1294 33.0829 18.3874 32.5352 17.8988C32.2726 17.6504 32.0907 17.33 32.0126 16.9787C31.9346 16.6273 31.964 16.2609 32.097 15.9261C32.2066 15.6366 32.4074 15.4013 32.5352 15.1298C32.6706 14.7258 32.7195 14.2982 32.6786 13.8744C32.6378 13.4505 32.5081 13.0398 32.2979 12.6685C31.7956 11.6016 31.1838 10.5888 30.4721 9.64624C29.5227 8.32511 28.5185 7.05828 27.4596 5.82764C27.6672 6.89431 27.6423 7.99266 27.3865 9.04902C27.2386 9.62495 27.0432 10.1879 26.8023 10.7321C26.4264 11.4007 26.0118 12.0473 25.5608 12.6685C23.2238 16.2881 20.832 19.9076 18.349 23.4004C17.0435 25.5573 16.3321 28.0161 16.2859 30.5309C16.0848 32.9993 16.618 35.472 17.8195 37.6433C18.5687 38.8742 19.4502 40.021 20.4486 41.0637C21.0694 41.7334 21.7814 42.8735 22.6395 43.0726C22.7491 42.041 22.9499 40.6475 23.096 39.6159C23.3338 37.934 23.8782 36.3089 24.7027 34.8201C25.1895 33.7601 26.0543 32.9158 27.1309 32.4493C27.9135 32.2862 28.7218 32.2862 29.5044 32.4493C29.9422 32.4221 30.3812 32.4221 30.819 32.4493C31.2686 32.4735 31.7149 32.3597 32.097 32.1235C32.3186 31.968 32.5024 31.7655 32.6351 31.5307C32.7677 31.2959 32.8459 31.0347 32.8638 30.7662C32.9186 30.2791 32.9186 29.7874 32.8638 29.3003C32.8245 28.9868 32.8685 28.6686 32.9916 28.3773C33.2473 27.8525 34.0141 27.6172 34.0689 27.02C34.0476 26.7523 33.9665 26.4927 33.8315 26.2599C33.7604 26.1456 33.7228 26.014 33.7228 25.8798C33.7228 25.7456 33.7604 25.614 33.8315 25.4998C33.8315 25.4998 34.0506 25.355 34.1236 25.2464C34.2051 25.1396 34.2492 25.0093 34.2492 24.8754C34.2492 24.7415 34.2051 24.6112 34.1236 24.5044C33.9428 24.2955 33.8006 24.0566 33.7037 23.7986C33.695 23.6656 33.715 23.5323 33.7622 23.4075C33.8094 23.2827 33.8828 23.1692 33.9776 23.0747C34.1732 22.888 34.3945 22.7295 34.6348 22.6041C34.7511 22.5516 34.8541 22.4739 34.9362 22.3769C35.0183 22.2798 35.0776 22.1658 35.1095 22.0431C35.0688 21.9246 35.0069 21.8143 34.927 21.7174Z" fill="#CCCCCC"></path><path d="M34.3062 20.5771C34.478 20.8248 34.619 21.0922 34.7261 21.3734C34.8037 21.4816 34.8709 21.5967 34.9269 21.7173L34.3062 20.5771Z" fill="#CCCCCC"></path><path d="M10.133 33.4262C9.0523 28.5693 8.7138 23.5789 9.12886 18.6223C9.12886 16.1429 11.265 2.44302 7.79605 1.41145C4.85656 0.524668 2.53783 3.94512 2.53783 3.94512C0.667683 7.68216 -0.206002 11.8316 1.36513e-05 15.9982C2.30048 38.8193 17.6735 41.4615 18.2577 41.7149C18.2577 41.7149 11.4476 39.2898 10.133 33.4262Z" fill="#09212A"></path></g><defs><clipPath id="clip0_917_3082"><rect width="35" height="43"></rect></clipPath></defs></svg></div><div class="Styles_searchBox__5X2m1"><div class="Styles_container__ddCFx "><div class="logos-search-box Styles_searchBox__xWHyX"><div><input type="text" placeholder="Search Vac Research" value=""/></div></div></div></div></div></header><div class="page-info"><h1 style="display:none">Vac Research</h1><div class="page-info-sub"><i>Mar 16 2023</i><br/><span>staging.vac.dev</span></div></div><main class="undefined Styles_common_main__4v7gP Styles_common_main__4v7gP"><aside class="Styles_container__3yUcn Style_sidebar__mLS5A Styles_common_sidebar__QAVov hidden-scroll Styles_hideDesktopToggleButton__L_Rik"><div class="sidebar-toggle-button button Styles_mobile___qAwf"><svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 4h14c.55 0 1-.45 1-1s-.45-1-1-1H1c-.55 0-1 .45-1 1s.45 1 1 1Zm14 8H1c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1Zm0-5H1c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1Z" fill="#F2F2F2"></path></svg></div><div class="logo-holder button vac" style="display:inline-block"><svg width="45" height="43" viewBox="0 0 35 43" fill="none" xmlns="http://www.w3.org/2000/svg" class="vac-logo"><g clip-path="url(#clip0_917_3082)"><path d="M24.9034 14.8217C24.6824 11.2666 23.5308 7.8298 21.5623 4.84994C22.543 4.19721 23.7374 3.93844 24.9034 4.12603C25.492 4.23064 26.0472 4.4722 26.5233 4.83086C26.9994 5.18951 27.3828 5.65504 27.6421 6.18916C28.0141 7.1512 28.1335 8.19117 27.989 9.21147C27.9754 9.6728 27.8955 10.1299 27.7516 10.5688C27.6613 10.8504 27.5322 11.1183 27.3682 11.3651C27.166 11.69 26.9466 12.0041 26.7109 12.3062C26.1084 13.1206 25.5607 14.0073 24.9034 14.8217Z" fill="#999999"></path><path d="M16.7058 7.58268C15.8382 5.99003 14.5344 4.67263 12.9447 3.78217L10.9546 2.69631C10.9546 2.69631 13.2551 -0.778436 16.1945 0.162641C19.134 1.10372 18.1846 7.4017 17.5821 9.80869" fill="#4D4D4D"></path><path d="M20.3209 41.6243C17.4179 40.4118 16.2129 38.3668 14.6975 36.919C13.1821 35.4711 12.8717 29.3903 13.1638 24.6126C13.456 19.8348 17.4909 11.528 17.5822 9.80869C17.6735 8.08941 15.4643 5.17569 13.5655 3.78217C11.6491 2.2631 9.29769 1.38272 6.84668 1.2666L8.36207 2.51534C9.74965 3.67359 9.42101 3.98125 9.22018 6.26155C9.01935 8.54185 8.72722 15.6904 8.70896 21.8436C8.70896 30.3495 6.73713 32.7022 13.0178 38.8373C14.1564 40.1358 15.6863 41.0368 17.3814 41.4072C21.6902 43.036 24.228 43.2712 20.3209 41.6243Z" fill="#1A1A1A"></path><path d="M17.9839 7.07618C17.5904 9.58823 16.8212 12.0281 15.7016 14.3152C14.6765 16.6746 13.7925 19.0918 13.0543 21.5543C12.076 25.3846 11.8405 29.3642 12.3605 33.2816C12.4325 34.6426 12.8065 35.9712 13.4559 37.1726C14.1362 38.1272 14.9759 38.9596 15.939 39.6338C17.8321 41.3312 20.1651 42.4718 22.6761 42.9276C20.068 40.8547 18.189 38.0165 17.3083 34.8199C16.3002 31.5246 16.6412 27.9684 18.2577 24.9205C18.7142 24.0699 19.2436 23.2555 19.7731 22.4411L24.4653 15.3287C24.7022 15.0187 24.8815 14.6694 24.9948 14.2971C25.0769 13.891 25.0769 13.4727 24.9948 13.0665C24.3347 9.48034 22.792 6.11109 20.5034 3.25758C19.9266 2.35717 19.1529 1.59688 18.2395 1.033C17.3262 0.46911 16.2966 0.116066 15.2269 0C15.7121 0.03052 16.1783 0.198543 16.5699 0.484084C16.9616 0.769625 17.2622 1.16066 17.4361 1.61069C17.8159 2.51034 18.0085 3.47679 18.0021 4.45202C18.0507 5.32627 18.0446 6.20267 17.9839 7.07618Z" fill="#808080"></path><path d="M34.927 21.7174C34.8742 21.5895 34.8068 21.4681 34.7261 21.3554C34.5725 21.0145 34.3893 20.6875 34.1784 20.3781C34.0141 20.1429 33.8315 19.9257 33.6489 19.7085C33.2107 19.1294 33.0829 18.3874 32.5352 17.8988C32.2726 17.6504 32.0907 17.33 32.0126 16.9787C31.9346 16.6273 31.964 16.2609 32.097 15.9261C32.2066 15.6366 32.4074 15.4013 32.5352 15.1298C32.6706 14.7258 32.7195 14.2982 32.6786 13.8744C32.6378 13.4505 32.5081 13.0398 32.2979 12.6685C31.7956 11.6016 31.1838 10.5888 30.4721 9.64624C29.5227 8.32511 28.5185 7.05828 27.4596 5.82764C27.6672 6.89431 27.6423 7.99266 27.3865 9.04902C27.2386 9.62495 27.0432 10.1879 26.8023 10.7321C26.4264 11.4007 26.0118 12.0473 25.5608 12.6685C23.2238 16.2881 20.832 19.9076 18.349 23.4004C17.0435 25.5573 16.3321 28.0161 16.2859 30.5309C16.0848 32.9993 16.618 35.472 17.8195 37.6433C18.5687 38.8742 19.4502 40.021 20.4486 41.0637C21.0694 41.7334 21.7814 42.8735 22.6395 43.0726C22.7491 42.041 22.9499 40.6475 23.096 39.6159C23.3338 37.934 23.8782 36.3089 24.7027 34.8201C25.1895 33.7601 26.0543 32.9158 27.1309 32.4493C27.9135 32.2862 28.7218 32.2862 29.5044 32.4493C29.9422 32.4221 30.3812 32.4221 30.819 32.4493C31.2686 32.4735 31.7149 32.3597 32.097 32.1235C32.3186 31.968 32.5024 31.7655 32.6351 31.5307C32.7677 31.2959 32.8459 31.0347 32.8638 30.7662C32.9186 30.2791 32.9186 29.7874 32.8638 29.3003C32.8245 28.9868 32.8685 28.6686 32.9916 28.3773C33.2473 27.8525 34.0141 27.6172 34.0689 27.02C34.0476 26.7523 33.9665 26.4927 33.8315 26.2599C33.7604 26.1456 33.7228 26.014 33.7228 25.8798C33.7228 25.7456 33.7604 25.614 33.8315 25.4998C33.8315 25.4998 34.0506 25.355 34.1236 25.2464C34.2051 25.1396 34.2492 25.0093 34.2492 24.8754C34.2492 24.7415 34.2051 24.6112 34.1236 24.5044C33.9428 24.2955 33.8006 24.0566 33.7037 23.7986C33.695 23.6656 33.715 23.5323 33.7622 23.4075C33.8094 23.2827 33.8828 23.1692 33.9776 23.0747C34.1732 22.888 34.3945 22.7295 34.6348 22.6041C34.7511 22.5516 34.8541 22.4739 34.9362 22.3769C35.0183 22.2798 35.0776 22.1658 35.1095 22.0431C35.0688 21.9246 35.0069 21.8143 34.927 21.7174Z" fill="#CCCCCC"></path><path d="M34.3062 20.5771C34.478 20.8248 34.619 21.0922 34.7261 21.3734C34.8037 21.4816 34.8709 21.5967 34.9269 21.7173L34.3062 20.5771Z" fill="#CCCCCC"></path><path d="M10.133 33.4262C9.0523 28.5693 8.7138 23.5789 9.12886 18.6223C9.12886 16.1429 11.265 2.44302 7.79605 1.41145C4.85656 0.524668 2.53783 3.94512 2.53783 3.94512C0.667683 7.68216 -0.206002 11.8316 1.36513e-05 15.9982C2.30048 38.8193 17.6735 41.4615 18.2577 41.7149C18.2577 41.7149 11.4476 39.2898 10.133 33.4262Z" fill="#09212A"></path></g><defs><clipPath id="clip0_917_3082"><rect width="35" height="43"></rect></clipPath></defs></svg></div><div class="Styles_desktop__VH2y3 defaultSidebar Styles_container__4YC7p"><nav class="sidebarNav hidden-scroll"><ul class="sidebar-menu mainMenu Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-0"><span></span><ul class="sidebar-menu  Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Main" href="/">Main</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="principles" href="/principles">Principles</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Research areas" href="/research-areas">Research areas</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Projects" href="/projects">Projects</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Open Research Problems" href="/open-problems">Open Research Problems</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="publications" href="/publications">Publications</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="contribute" href="/contribute">Contribute</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="media" href="/media">Media</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li></ul><br/></li></ul><br/><ul class="sidebar-menu subMenu Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-0"><a class="" title="research" href="/research">Research</a><ul class="sidebar-menu  Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Waku for All Decentralized Applications and Infrastructures" href="/waku-for-all">Waku for All Decentralized Applications and Infrastructures</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Building Privacy-Protecting Infrastructure" href="/building-privacy-protecting-infrastructure">Building Privacy-Protecting Infrastructure</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="active" title="Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay" href="/wakuv2-relay-anon">Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Noise handshakes as key-exchange mechanism for Waku" href="/wakuv2-noise">Noise handshakes as key-exchange mechanism for Waku</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Waku v2 Ambient Peer Discovery" href="/wakuv2-apd">Waku v2 Ambient Peer Discovery</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Introducing nwaku" href="/introducing-nwaku">Introducing nwaku</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Opinion: Pseudo-ethics in the Surveillance Tech Industry" href="/ethics-surveillance-tech">Opinion: Pseudo-ethics in the Surveillance Tech Industry</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li><span class="button">...</span></li></ul><br/></li></ul><div class="external_links"><div><div class="menuitem-title"><span class="cap">Resources</span></div><ul><li><a href="https://rfc.vac.dev/" target="_blank">&gt; Specs/RFCs</a></li><li><a href="https://forum.vac.dev/" target="_blank">&gt; Forum</a></li><li><a href="https://waku.org" target="_blank">&gt; Waku.org</a></li></ul></div></div></nav></div></aside><article class="Styles_container__pG0bG Style_content__NTXHZ Styles_common_content__Myi5Z"><div class="Style_container__qc2tD"><h2 class="Style_container__eSI4Q serif">Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay</h2><div class="serif"><i>Jul 22 2022</i><i> - </i>by<!-- --><a title="kaiserd" href="/authors/kaiserd"><span><i> <!-- -->kaiserd<!-- --></i></span></a></div></div><p><a href="https://rfc.vac.dev/spec/10/">Waku v2<!-- --></a> enables secure, privacy preserving communication using a set of modular P2P protocols.
Waku v2 also aims at protecting the user&#x27;s anonymity.
This post is the first in a series about Waku v2 security, privacy, and anonymity.
The goal is to eventually have a full privacy and anonymity analysis for each of the Waku v2 protocols, as well as covering the interactions of various Waku v2 protocols.
This provides transparency with respect to Waku&#x27;s current privacy and anonymity guarantees, and also identifies weak points that we have to address.<!-- --></p>
<!-- --><p>In this post, we first give an informal description of security, privacy and anonymity in the context of Waku v2.
For each definition, we summarize Waku&#x27;s current guarantees regarding the respective property.
We also provide attacker models, an attack-based threat model, and a first anonymity analysis of <!-- --><a href="https://rfc.vac.dev/spec/11/">Waku v2 relay<!-- --></a> within the respective models.<!-- --></p>
<!-- --><p>Waku comprises many protocols that can be combined in a modular way.
For our privacy and anonymity analysis, we start with the relay protocol because it is at the core of Waku v2 enabling Waku&#x27;s publish subscribe approach to P2P messaging.
In its current form, Waku relay is a minor extension of <!-- --><a href="https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/README.md">libp2p GossipSub<!-- --></a>.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/libp2p_gossipsub_types_of_peering.png" alt="Figure 1: The Waku v2 relay mesh is based on the GossipSub mesh"/><figcaption>Figure 1: The Waku v2 relay mesh is based on the GossipSub mesh<!-- --></figcaption></figure>
<!-- --><h2><a class="anchor" id="informal-definitions-security-privacy-and-anonymity"></a><a class="ha" href="#informal-definitions-security-privacy-and-anonymity">Informal Definitions: Security, Privacy, and Anonymity<!-- --></a></h2>
<!-- --><p>The concepts of security, privacy, and anonymity are linked and have quite a bit of overlap.<!-- --></p>
<!-- --><h3><a class="anchor" id="security"></a><a class="ha" href="#security">Security<!-- --></a></h3>
<!-- --><p>Of the three, <!-- --><a href="https://en.wikipedia.org/wiki/Information_security">Security<!-- --></a> has the clearest agreed upon definition,
at least regarding its key concepts: <!-- --><em>confidentiality<!-- --></em>, <!-- --><em>integrity<!-- --></em>, and <!-- --><em>availability<!-- --></em>.<!-- --></p>
<!-- --><ul>
<!-- --><li>confidentiality:  data is not disclosed to unauthorized entities.<!-- --></li>
<!-- --><li>integrity: data is not modified by unauthorized entities.<!-- --></li>
<!-- --><li>availability: data is available, i.e. accessible by authorized entities.<!-- --></li>
<!-- --></ul>
<!-- --><p>While these are the key concepts, the definition of information security has been extended over time including further concepts,
e.g. <!-- --><a href="https://en.wikipedia.org/wiki/Authentication">authentication<!-- --></a> and <!-- --><a href="https://en.wikipedia.org/wiki/Non-repudiation">non-repudiation<!-- --></a>.
We might cover these in future posts.<!-- --></p>
<!-- --><h3><a class="anchor" id="privacy"></a><a class="ha" href="#privacy">Privacy<!-- --></a></h3>
<!-- --><p>Privacy allows users to choose which data and information<!-- --></p>
<!-- --><ul>
<!-- --><li>they want to share<!-- --></li>
<!-- --><li>and with whom they want to share it.<!-- --></li>
<!-- --></ul>
<!-- --><p>This includes data and information that is associated with and/or generated by users.
Protected data also comprises metadata that might be generated without users being aware of it.
This means, no further information about the sender or the message is leaked.
Metadata that is protected as part of the privacy-preserving property does not cover protecting the identities of sender and receiver.
Identities are protected by the <!-- --><a href="/wakuv2-relay-anon#anonymity">anonymity property<!-- --></a>.<!-- --></p>
<!-- --><p>Often privacy is realized by the confidentiality property of security.
This neither makes privacy and security the same, nor the one a sub category of the other.
While security is abstract itself (its properties can be realized in various ways), privacy lives on a more abstract level using security properties.
Privacy typically does not use integrity and availability.
An adversary who has no access to the private data, because the message has been encrypted, could still alter the message.<!-- --></p>
<!-- --><p>Waku offers confidentiality via secure channels set up with the help of the <!-- --><a href="https://noiseprotocol.org/">Noise Protocol Framework<!-- --></a>.
Using these secure channels, message content is only disclosed to the intended receivers.
They also provide good metadata protection properties.
However, we do not have a metadata protection analysis as of yet,
which is part of our privacy/anonymity roadmap.<!-- --></p>
<!-- --><h3><a class="anchor" id="anonymity"></a><a class="ha" href="#anonymity">Anonymity<!-- --></a></h3>
<!-- --><p>Privacy and anonymity are closely linked.
Both the identity of a user and data that allows inferring a user&#x27;s identity should be part of the privacy policy.
For the purpose of analysis, we want to have a clearer separation between these concepts.<!-- --></p>
<!-- --><p>We define anonymity as <!-- --><em>unlinkablity of users&#x27; identities and their shared data and/or actions<!-- --></em>.<!-- --></p>
<!-- --><p>We subdivide anonymity into <!-- --><em>receiver anonymity<!-- --></em> and <!-- --><em>sender anonymity<!-- --></em>.<!-- --></p>
<!-- --><h4><a class="anchor" id="receiver-anonymity"></a><a class="ha" href="#receiver-anonymity">Receiver Anonymity<!-- --></a></h4>
<!-- --><p>We define receiver anonymity as <!-- --><em>unlinkability of users&#x27; identities and the data they receive and/or related actions<!-- --></em>.
The data transmitted via Waku relay must be a <!-- --><a href="https://rfc.vac.dev/spec/14/">Waku message<!-- --></a>, which contains a content topic field.
Because each message is associated with a content topic, and each receiver is interested in messages with specific content topics,
receiver anonymity in the context of Waku corresponds to <!-- --><em>subscriber-topic unlinkability<!-- --></em>.
An example for the &quot;action&quot; part of our receiver anonymity definition is subscribing to a specific topic.<!-- --></p>
<!-- --><p>The Waku message&#x27;s content topic is not related to the libp2p pubsub topic.
For now, Waku uses a single libp2p pubsub topic, which means messages are propagated via a single mesh of peers.
With this, the receiver discloses its participation in Waku on the gossipsub layer.
We will leave the analysis of libp2p gossipsub to a future article within this series, and only provide a few hints and pointers here.<!-- --></p>
<!-- --><p>Waku offers k-anonymity regarding content topic interest in the global adversary model.
<!-- --><a href="https://en.wikipedia.org/wiki/K-anonymity">K-anonymity<!-- --></a> in the context of Waku means an attacker can link receivers to content topics with a maximum certainty of <!-- --><span><span style="display:inline">$1/k$</span></span>.
The larger <!-- --><span><span style="display:inline">$k$</span></span>, the less certainty the attacker gains.
Receivers basically hide in a pool of <!-- --><span><span style="display:inline">$k$</span></span> content topics, any subset of which could be topics they subscribed to.
The attacker does not know which of those the receiver actually subscribed to,
and the receiver enjoys <!-- --><a href="https://en.wikipedia.org/wiki/Plausible_deniability#Use_in_cryptography">plausible deniability<!-- --></a> regarding content topic subscription.
Assuming there are <!-- --><span><span style="display:inline">$n$</span></span> Waku content topics, a receiver has <!-- --><span><span style="display:inline">$n$</span></span>-anonymity with respect to association to a specific content topic.<!-- --></p>
<!-- --><p>Technically, Waku allows distributing messages over several libp2p pubsub topics.
This yields <!-- --><span><span style="display:inline">$k$</span></span>-anonymity, assuming <!-- --><span><span style="display:inline">$k$</span></span> content topics share the same pubsub topic.
However, if done wrongly, such sharding of pubsub topics can breach anonymity.
A formal specification of anonymity-preserving topic sharding building on the concepts of <!-- --><a href="https://specs.status.im/spec/10#partitioned-topic">partitioned topics<!-- --></a> is part of our roadmap.<!-- --></p>
<!-- --><p>Also, Waku is not directly concerned with 1:1 communication, so for this post, 1:1 communication is out of scope.
Channels for 1:1 communication can be implemented on top of Waku relay.
In the future, a 1:1 communication protocol might be added to Waku.
Similar to topic sharding, it would maintain receiver anonymity leveraging <!-- --><a href="https://specs.status.im/spec/10#partitioned-topic">partitioned topics<!-- --></a>.<!-- --></p>
<!-- --><h4><a class="anchor" id="sender-anonymity"></a><a class="ha" href="#sender-anonymity">Sender Anonymity<!-- --></a></h4>
<!-- --><p>We define sender anonymity as <!-- --><em>unlinkability of users&#x27; identities and the data they send and/or related actions<!-- --></em>.
Because the data in the context of Waku is Waku messages, sender anonymity corresponds to <!-- --><em>sender-message unlinkability<!-- --></em>.<!-- --></p>
<!-- --><p>In summary, Waku offers weak sender anonymity because of <!-- --><a href="https://rfc.vac.dev/spec/11/#signature-policy">Waku&#x27;s strict no sign policy<!-- --></a>,
which has its origins in the <!-- --><a href="https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/p2p-interface.md#why-are-we-using-the-strictnosign-signature-policy">Ethereum consensus specs<!-- --></a>.
<!-- --><a href="https://rfc.vac.dev/spec/17/">17/WAKU-RLN-RELAY<!-- --></a> and <!-- --><a href="https://rfc.vac.dev/spec/18/">18/WAKU2-SWAP<!-- --></a> mitigate replay and injection attacks.<!-- --></p>
<!-- --><p>Waku currently does not offer sender anonymity in stronger attacker models, as well as cannot protect against targeted attacks in weaker attacker models like the single or multi node attacker.
We will cover this in more detail in later sections.<!-- --></p>
<!-- --><h3><a class="anchor" id="anonymity-trilemma"></a><a class="ha" href="#anonymity-trilemma">Anonymity Trilemma<!-- --></a></h3>
<!-- --><p><a href="https://freedom.cs.purdue.edu/projects/trilemma.html">The Anonymity trilemma<!-- --></a> states that only two out of <!-- --><em>strong anonymity<!-- --></em>, <!-- --><em>low bandwidth<!-- --></em>, and <!-- --><em>low latency<!-- --></em> can be guaranteed in the global on-net attacker model.
Waku&#x27;s goal, being a modular set of protocols, is to offer any combination of two out of these three properties, as well as blends.
An example for blending is an adjustable number of pubsub topics and peers in the respective pubsub topic mesh; this allows tuning the trade-off between anonymity and bandwidth.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/anonymity_trilemma.svg" alt="Figure 2: Anonymity Trilemma: pick two. "/><figcaption>Figure 2: Anonymity Trilemma: pick two. <!-- --></figcaption></figure>
<!-- --><p>A fourth factor that influences <!-- --><a href="https://freedom.cs.purdue.edu/projects/trilemma.html">the anonymity trilemma<!-- --></a> is <!-- --><em>frequency and patterns<!-- --></em> of messages.
The more messages there are, and the more randomly distributed they are, the better the anonymity protection offered by a given anonymous communication protocol.
So, incentivising users to use the protocol, for instance by lowering entry barriers, helps protecting the anonymity of all users.
The frequency/patterns factor is also related to the above described k-anonymity.<!-- --></p>
<!-- --><h3><a class="anchor" id="censorship-resistance"></a><a class="ha" href="#censorship-resistance">Censorship Resistance<!-- --></a></h3>
<!-- --><p>Another security related property that Waku aims to offer is censorship resistance.
Censorship resistance guarantees that users can participate even if an attacker tries to deny them access.
So, censorship resistance ties into the availability aspect of security.
In the context of Waku that means users should be able to send messages as well as receive all messages they are interested in,
even if an attacker tries to prevent them from disseminating messages or tries to deny them access to messages.<!-- --></p>
<!-- --><p>Currently, Waku only guarantees censorship resistance in the weak single node attacker model.
While currently employed secure channels mitigate targeted censorship, e.g. blocking specific content topics,
general censorship resistance in strong attacker models is part of our roadmap.
Among other options, we will investigate <!-- --><a href="https://www.pluggabletransports.info/about/">Pluggable Transports<!-- --></a> in future articles.<!-- --></p>
<!-- --><h2><a class="anchor" id="attacker-types"></a><a class="ha" href="#attacker-types">Attacker Types<!-- --></a></h2>
<!-- --><p>The following lists various attacker types with varying degrees of power.
The more power an attacker has, the more difficult it is to gain the respective attacker position.<!-- --></p>
<!-- --><p>Each attacker type comes in a passive and an active variant.
While a passive attacker can stay hidden and is not suspicious,
the respective active attacker has more (or at least the same) deanonymization power.<!-- --></p>
<!-- --><p>We also distinguish between internal and external attackers.<!-- --></p>
<!-- --><h3><a class="anchor" id="internal"></a><a class="ha" href="#internal">Internal<!-- --></a></h3>
<!-- --><p>With respect to Waku relay, an internal attacker participates in the same pubsub topic as its victims.
Without additional measures on higher layer protocols, access to an internal position is easy to get.<!-- --></p>
<!-- --><h4><a class="anchor" id="single-node"></a><a class="ha" href="#single-node">Single Node<!-- --></a></h4>
<!-- --><p>This attacker controls a single node.
Because this position corresponds to normal usage of Waku relay, it is trivial to obtain.<!-- --></p>
<!-- --><h4><a class="anchor" id="multi-node"></a><a class="ha" href="#multi-node">Multi Node<!-- --></a></h4>
<!-- --><p>This attacker controls several nodes. We assume a smaller static number of controlled nodes.
The multi node position can be achieved relatively easily by setting up multiple nodes.
Botnets might be leveraged to increase the number of available hosts.
Multi node attackers could use <!-- --><a href="https://en.wikipedia.org/wiki/Sybil_attack">Sybil attacks<!-- --></a> to increase the number of controlled nodes.
A countermeasure is for nodes to only accept libp2p gossipsub graft requests from peers with different IP addresses, or even different subnets.<!-- --></p>
<!-- --><h4><a class="anchor" id="linearly-scaling-nodes"></a><a class="ha" href="#linearly-scaling-nodes">Linearly Scaling Nodes<!-- --></a></h4>
<!-- --><p>This attacker controls a number of nodes that scales linearly with the number of nodes in the network.
This attacker is especially interesting to investigate in the context of DHT security,
which Waku uses for ambient peer discovery.<!-- --></p>
<!-- --><h3><a class="anchor" id="external"></a><a class="ha" href="#external">External<!-- --></a></h3>
<!-- --><p>An external attacker can only see encrypted traffic (protected by a secure channel set up with <!-- --><a href="https://rfc.vac.dev/spec/35/">Noise<!-- --></a>).
Because an internal position can be easily obtained,
in practice external attackers would mount combined attacks that leverage both internal an external attacks.
We cover this more below when describing attacks.<!-- --></p>
<!-- --><h4><a class="anchor" id="local"></a><a class="ha" href="#local">Local<!-- --></a></h4>
<!-- --><p>A local attacker has access to communication links in a local network segment.
This could be a rogue access point (with routing capability).<!-- --></p>
<!-- --><h4><a class="anchor" id="as"></a><a class="ha" href="#as">AS<!-- --></a></h4>
<!-- --><p>An AS attacker controls a single AS (autonomous system).
A passive AS attacker can listen to traffic on arbitrary links within the AS.
An active AS attacker can drop, inject, and alter traffic on arbitrary links within the AS.<!-- --></p>
<!-- --><p>In practice, a malicious ISP would be considered as an AS attacker.
A malicious ISP could also easily setup a set of nodes at specific points in the network,
gaining internal attack power similar to a strong multi node attacker.<!-- --></p>
<!-- --><h4><a class="anchor" id="global-on-net"></a><a class="ha" href="#global-on-net">Global On-Net<!-- --></a></h4>
<!-- --><p>A global on-net attacker has complete overview over the whole network.
A passive global attacker can listen to traffic on all links,
while the active global attacker basically carries the traffic: it can freely drop, inject, and alter traffic at all positions in the network.
This basically corresponds to the <!-- --><a href="https://en.wikipedia.org/wiki/Dolev%E2%80%93Yao_model">Dolev-Yao model<!-- --></a>.<!-- --></p>
<!-- --><p>An entity with this power would, in practice, also have the power of the internal linearly scaling nodes attacker.<!-- --></p>
<!-- --><h2><a class="anchor" id="attack-based-threat-analysis"></a><a class="ha" href="#attack-based-threat-analysis">Attack-based Threat Analysis<!-- --></a></h2>
<!-- --><p>The following lists various attacks including the weakest attacker model in which the attack can be successfully performed.
The respective attack can be performed in all stronger attacker models as well.<!-- --></p>
<!-- --><p>An attack is considered more powerful if it can be successfully performed in a weaker attacker model.<!-- --></p>
<!-- --><p>If not stated otherwise, we look at these attacks with respect to their capability to deanonymize the message sender.<!-- --></p>
<!-- --><h3><a class="anchor" id="scope"></a><a class="ha" href="#scope">Scope<!-- --></a></h3>
<!-- --><p>In this post, we introduce a simple tightly scoped threat model for Waku v2 Relay, which will be extended in the course of this article series.<!-- --></p>
<!-- --><p>In this first post, we will look at the relay protocol in isolation.
Even though many threats arise from layers Waku relay is based on, and layers that in turn live on top of relay,
we want to first look at relay in isolation because it is at the core of Waku v2.
Addressing and trying to solve all security issues of a complex system at once is an overwhelming task, which is why we focus on the soundness of relay first.<!-- --></p>
<!-- --><p>This also goes well with the modular design philosophy of Waku v2, as layers of varying levels of security guarantees can be built on top of relay, all of which can relay on the guarantees that Waku provides.
Instead of looking at a multiplicative explosion of possible interactions, we look at the core in this article, and cover the most relevant combinations in future posts.<!-- --></p>
<!-- --><p>Further restricting the scope, we will look at the data field of a relay message as a black box.
In a second article on Waku v2 relay, we will look into the data field, which according to the <!-- --><a href="https://rfc.vac.dev/spec/11/#message-fields">specification of Waku v2 relay<!-- --></a> must be a <!-- --><a href="https://rfc.vac.dev/spec/14/">Waku v2 message<!-- --></a>.
We only consider messages with version field <!-- --><code>2</code>, which indicates that the payload has to be encoded using <!-- --><a href="https://rfc.vac.dev/spec/35/">35/WAKU2-NOISE<!-- --></a>.<!-- --></p>
<!-- --><h3><a class="anchor" id="prerequisite-get-a-specific-position-in-the-network"></a><a class="ha" href="#prerequisite-get-a-specific-position-in-the-network">Prerequisite: Get a Specific Position in the Network<!-- --></a></h3>
<!-- --><p>Some attacks require the attacker node(s) to be in a specific position in the network.
In most cases, this corresponds to trying to get into the mesh peer list for the desired pubsub topic of the victim node.<!-- --></p>
<!-- --><p>In libp2p gossipsub, and by extension Waku v2 relay, nodes can simply send a graft message for the desired topic to the victim node.
If the victim node still has open slots, the attacker gets the desired position.
This only requires the attacker to know the gossipsub multiaddress of the victim node.<!-- --></p>
<!-- --><p>A linearly scaling nodes attacker can leverage DHT based discovery systems to boost the probability of malicious nodes being returned, which in turn significantly increases the probability of attacker nodes ending up in the peer lists of victim nodes.
<!-- --><a href="https://vac.dev/wakuv2-apd">Waku v2 discv5<!-- --></a> will employ countermeasures that mitigate the amplifying effect this attacker type can achieve.<!-- --></p>
<!-- --><h3><a class="anchor" id="replay-attack"></a><a class="ha" href="#replay-attack">Replay Attack<!-- --></a></h3>
<!-- --><p>In the scope we defined above, Waku v2 is resilient against replay attacks.
GossipSub nodes, and by extension Waku relay nodes, feature a <!-- --><code>seen</code> cache, and only relay messages they have not seen before.
Further, replay attacks will be punished by <!-- --><a href="https://rfc.vac.dev/spec/17/">RLN<!-- --></a> and <!-- --><a href="https://rfc.vac.dev/spec/18/">SWAP<!-- --></a>.<!-- --></p>
<!-- --><h3><a class="anchor" id="neighbourhood-surveillance"></a><a class="ha" href="#neighbourhood-surveillance">Neighbourhood Surveillance<!-- --></a></h3>
<!-- --><p>This attack can be performed by a single node attacker that is connected to all peers of the victim node <!-- --><span><span style="display:inline">$v$</span></span> with respect to a specific topic mesh.
The attacker also has to be connected to <!-- --><span><span style="display:inline">$v$</span></span>.
In this position, the attacker will receive messages <!-- --><span><span style="display:inline">$m_v$</span></span> sent by <!-- --><span><span style="display:inline">$v$</span></span> both on the direct path from <!-- --><span><span style="display:inline">$v$</span></span>, and on indirect paths relayed by peers of <!-- --><span><span style="display:inline">$v$</span></span>.
It will also receive messages <!-- --><span><span style="display:inline">$m_x$</span></span> that are not sent by <!-- --><span><span style="display:inline">$v$</span></span>. These messages <!-- --><span><span style="display:inline">$m_x$</span></span> are relayed by both <!-- --><span><span style="display:inline">$v$</span></span> and the peers of <!-- --><span><span style="display:inline">$v$</span></span>.
Messages that are received (significantly) faster from <!-- --><span><span style="display:inline">$v$</span></span> than from any other of <!-- --><span><span style="display:inline">$v$</span></span>&#x27;s peers are very likely messages that <!-- --><span><span style="display:inline">$v$</span></span> sent,
because for these messages the attacker is one hop closer to the source.<!-- --></p>
<!-- --><p>The attacker can (periodically) measure latency between itself and <!-- --><span><span style="display:inline">$v$</span></span>, and between itself and the peers of <!-- --><span><span style="display:inline">$v$</span></span> to get more accurate estimates for the expected timings.
An AS attacker (and if the topology allows, even a local attacker) could also learn the latency between <!-- --><span><span style="display:inline">$v$</span></span> and its well-behaving peers.
An active AS attacker could also increase the latency between <!-- --><span><span style="display:inline">$v$</span></span> and its peers to make the timing differences more prominent.
This, however, might lead to <!-- --><span><span style="display:inline">$v$</span></span> switching to other peers.<!-- --></p>
<!-- --><p>This attack cannot (reliably) distinguish messages <!-- --><span><span style="display:inline">$m_v$</span></span> sent by <!-- --><span><span style="display:inline">$v$</span></span> from messages <!-- --><span><span style="display:inline">$m_y$</span></span> relayed by peers of <!-- --><span><span style="display:inline">$v$</span></span> the attacker is not connected to.
Still, there are hop-count variations that might be leveraged.
Messages <!-- --><span><span style="display:inline">$m_v$</span></span> always have a hop-count of 1 on the path from <!-- --><span><span style="display:inline">$v$</span></span> to the attacker, while all other paths are longer.
Messages <!-- --><span><span style="display:inline">$m_y$</span></span> might have the same hop-count on the path from <!-- --><span><span style="display:inline">$v$</span></span> as well as on other paths.<!-- --></p>
<!-- --><h3><a class="anchor" id="controlled-neighbourhood"></a><a class="ha" href="#controlled-neighbourhood">Controlled Neighbourhood<!-- --></a></h3>
<!-- --><p>If a multi node attacker manages to control all peers of the victim node, it can trivially tell which messages originated from <!-- --><span><span style="display:inline">$v$</span></span>.<!-- --></p>
<!-- --><h3><a class="anchor" id="observing-messages"></a><a class="ha" href="#observing-messages">Observing Messages<!-- --></a></h3>
<!-- --><p>If Waku relay was not protected with Noise, the AS attacker could simply check for messages leaving <!-- --><span><span style="display:inline">$v$</span></span> which have not been relayed to <!-- --><span><span style="display:inline">$v$</span></span>.
These are the messages sent by <!-- --><span><span style="display:inline">$v$</span></span>.
Waku relay protects against this attack by employing secure channels setup using Noise.<!-- --></p>
<!-- --><h3><a class="anchor" id="correlation"></a><a class="ha" href="#correlation">Correlation<!-- --></a></h3>
<!-- --><p>Monitoring all traffic (in an AS or globally), allows the attacker to identify traffic correlated with messages originating from <!-- --><span><span style="display:inline">$v$</span></span>.
This (alone) does not allow an external attacker to learn which message <!-- --><span><span style="display:inline">$v$</span></span> sent, but it allows identifying the respective traffic propagating through the network.
The more traffic in the network, the lower the success rate of this attack.<!-- --></p>
<!-- --><p>Combined with just a few nodes controlled by the attacker, the actual message associated with the correlated traffic can eventually be identified.<!-- --></p>
<!-- --><h3><a class="anchor" id="dos"></a><a class="ha" href="#dos">DoS<!-- --></a></h3>
<!-- --><p>An active single node attacker could run a disruption attack by<!-- --></p>
<!-- --><ul>
<!-- --><li>(1) dropping messages that should be relayed<!-- --></li>
<!-- --><li>(2) flooding neighbours with bogus messages<!-- --></li>
<!-- --></ul>
<!-- --><p>While (1) has a negative effect on availability, the impact is not significant.
A linearly scaling botnet attacker, however, could significantly disrupt the network with such an attack.
(2) is thwarted by <!-- --><a href="https://rfc.vac.dev/spec/17/">RLN<!-- --></a>.
Also <!-- --><a href="https://rfc.vac.dev/spec/18/">SWAP<!-- --></a> helps mitigating DoS attacks.<!-- --></p>
<!-- --><p>A local attacker can DoS Waku by dropping all Waku traffic within its controlled network segment.
An AS attacker can DoS Waku within its authority, while a global attacker can DoS the whole network.
A countermeasure are censorship resistance techniques like <!-- --><a href="https://www.pluggabletransports.info/about/">Pluggable Transports<!-- --></a>.<!-- --></p>
<!-- --><h2><a class="anchor" id="summary-and-future-work"></a><a class="ha" href="#summary-and-future-work">Summary and Future Work<!-- --></a></h2>
<!-- --><p>Currently, Waku v2 relay offers k-anonymity with respect to receiver anonymity.
This also includes k-anonymity towards legitimate members of the same topic.<!-- --></p>
<!-- --><p>Waku v2 relay offers sender anonymity in the single node attacker model with its <!-- --><a href="https://rfc.vac.dev/spec/11/#signature-policy">strict no sign policy<!-- --></a>.
Currently, Waku v2 does not guarantee sender anonymity in the multi node and stronger attacker models.
However, we are working on modular anonymity-preserving protocols and building blocks as part of our privacy/anonymity roadmap.
The goal is to allow tunable anonymity with respect to trade offs between <!-- --><em>strong anonymity<!-- --></em>, <!-- --><em>low bandwidth<!-- --></em>, and <!-- --><em>low latency<!-- --></em>.
All of these cannot be fully guaranteed as the <!-- --><a href="https://freedom.cs.purdue.edu/projects/trilemma.html">the anonymity trilemma<!-- --></a> states.
Some applications have specific requirements, e.g. low latency, which require a compromise on anonymity.
Anonymity-preserving mechanisms we plan to investigate and eventually specify as pluggable anonymity protocols for Waku comprise<!-- --></p>
<!-- --><ul>
<!-- --><li><a href="https://arxiv.org/abs/1805.11060">Dandelion++<!-- --></a> for lightweight anonymity;<!-- --></li>
<!-- --><li><a href="https://en.wikipedia.org/wiki/Onion_routing">onion routing<!-- --></a> as a building block adding a low latency anonymization layer;<!-- --></li>
<!-- --><li><a href="https://en.wikipedia.org/wiki/Mix_network">a mix network<!-- --></a> for providing strong anonymity (on top of onion routing) even in the strongest attacker model at the cost of higher latency.<!-- --></li>
<!-- --></ul>
<!-- --><p>These pluggable anonymity-preserving protocols will form a sub-set of the Waku v2 protocol set.
As an intermediate step, we might directly employ Tor for onion-routing, and <!-- --><a href="https://nymtech.net/">Nym<!-- --></a> as a mix-net layer.<!-- --></p>
<!-- --><p>In future research log posts, we will cover further Waku v2 protocols and identify anonymity problems that will be added to our roadmap.
These protocols comprise<!-- --></p>
<!-- --><ul>
<!-- --><li><a href="https://rfc.vac.dev/spec/13/">13/WAKU2-STORE<!-- --></a>, which can violate receiver anonymity as it allows filtering by content topic.
A countermeasure is using the content topic exclusively for local filters.<!-- --></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/12/">12/WAKU2-FILTER<!-- --></a>, which discloses nodes&#x27; interest in topics;<!-- --></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/19/">19/WAKU2-LIGHTPUSH<!-- --></a>, which also discloses nodes&#x27; interest in topics and links the lightpush client as the sender of a message to the lightpush service node;<!-- --></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/21/">21/WAKU2-FTSTORE<!-- --></a>, which discloses nodes&#x27; interest in specific time ranges allowing to infer information like online times.<!-- --></li>
<!-- --></ul>
<!-- --><p>While these protocols are not necessary for the operation of Waku v2, and can be seen as pluggable features,
we aim to provide alternatives without the cost of lowering the anonymity level.<!-- --></p>
<!-- --><h2><a class="anchor" id="references"></a><a class="ha" href="#references">References<!-- --></a></h2>
<!-- --><ul>
<!-- --><li><a href="https://rfc.vac.dev/spec/10/">10/WAKU2<!-- --></a></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/11/">11/WAKU2-RELAY<!-- --></a></li>
<!-- --><li><a href="https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/README.md">libp2p GossipSub<!-- --></a></li>
<!-- --><li><a href="https://en.wikipedia.org/wiki/Information_security">Security<!-- --></a></li>
<!-- --><li><a href="https://en.wikipedia.org/wiki/Authentication">Authentication<!-- --></a></li>
<!-- --><li><a href="https://en.wikipedia.org/wiki/Non-repudiation">Non-repudiation<!-- --></a></li>
<!-- --><li><a href="https://noiseprotocol.org/">Noise Protocol Framework<!-- --></a></li>
<!-- --><li><a href="https://en.wikipedia.org/wiki/Plausible_deniability#Use_in_cryptography">plausible deniability<!-- --></a></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/14/">Waku v2 message<!-- --></a></li>
<!-- --><li><a href="https://specs.status.im/spec/10#partitioned-topic">partitioned topics<!-- --></a></li>
<!-- --><li><a href="https://en.wikipedia.org/wiki/Sybil_attack">Sybil attack<!-- --></a></li>
<!-- --><li><a href="https://en.wikipedia.org/wiki/Dolev%E2%80%93Yao_model">Dolev-Yao model<!-- --></a></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/35/">35/WAKU2-NOISE<!-- --></a></li>
<!-- --><li><a href="https://vac.dev/wakuv2-apd">33/WAKU2-DISCV5<!-- --></a></li>
<!-- --><li><a href="https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/p2p-interface.md#why-are-we-using-the-strictnosign-signature-policy">strict no sign policy<!-- --></a></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/11/#signature-policy">Waku v2 strict no sign policy<!-- --></a></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/17/">17/WAKU-RLN-RELAY<!-- --></a></li>
<!-- --><li><a href="https://freedom.cs.purdue.edu/projects/trilemma.html">anonymity trilemma<!-- --></a></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/18/">18/WAKU2-SWAP<!-- --></a></li>
<!-- --><li><a href="https://www.pluggabletransports.info/about/">Pluggable Transports<!-- --></a></li>
<!-- --><li><a href="https://nymtech.net/">Nym<!-- --></a></li>
<!-- --><li><a href="https://arxiv.org/abs/1805.11060">Dandelion++<!-- --></a></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/13/">13/WAKU2-STORE<!-- --></a></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/12/">12/WAKU2-FILTER<!-- --></a></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/19/">19/WAKU2-LIGHTPUSH<!-- --></a></li>
<!-- --><li><a href="https://rfc.vac.dev/spec/21/">21/WAKU2-FTSTORE<!-- --></a></li>
<!-- --></ul></article><aside class="Styles_container__3DqFl Style_toc__v7JJe Styles_common_toc__nMHyQ hidden-scroll"><nav class="Styles_tocComponent__fhPld hidden-scroll"><ul><li class="h-2"><a class="" href="/wakuv2-relay-anon#informal-definitions-security-privacy-and-anonymity">Informal Definitions: Security, Privacy, and Anonymity</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#security">Security</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#privacy">Privacy</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#anonymity">Anonymity</a></li><li class="h-4"><a class="" href="/wakuv2-relay-anon#receiver-anonymity">Receiver Anonymity</a></li><li class="h-4"><a class="" href="/wakuv2-relay-anon#sender-anonymity">Sender Anonymity</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#anonymity-trilemma">Anonymity Trilemma</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#censorship-resistance">Censorship Resistance</a></li><li class="h-2"><a class="" href="/wakuv2-relay-anon#attacker-types">Attacker Types</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#internal">Internal</a></li><li class="h-4"><a class="" href="/wakuv2-relay-anon#single-node">Single Node</a></li><li class="h-4"><a class="" href="/wakuv2-relay-anon#multi-node">Multi Node</a></li><li class="h-4"><a class="" href="/wakuv2-relay-anon#linearly-scaling-nodes">Linearly Scaling Nodes</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#external">External</a></li><li class="h-4"><a class="" href="/wakuv2-relay-anon#local">Local</a></li><li class="h-4"><a class="" href="/wakuv2-relay-anon#as">AS</a></li><li class="h-4"><a class="" href="/wakuv2-relay-anon#global-on-net">Global On-Net</a></li><li class="h-2"><a class="" href="/wakuv2-relay-anon#attack-based-threat-analysis">Attack-based Threat Analysis</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#scope">Scope</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#prerequisite-get-a-specific-position-in-the-network">Prerequisite: Get a Specific Position in the Network</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#replay-attack">Replay Attack</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#neighbourhood-surveillance">Neighbourhood Surveillance</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#controlled-neighbourhood">Controlled Neighbourhood</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#observing-messages">Observing Messages</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#correlation">Correlation</a></li><li class="h-3"><a class="" href="/wakuv2-relay-anon#do-s">DoS</a></li><li class="h-2"><a class="" href="/wakuv2-relay-anon#summary-and-future-work">Summary and Future Work</a></li><li class="h-2"><a class="" href="/wakuv2-relay-anon#references">References</a></li></ul></nav></aside></main><footer class="Styles_container___YkOC undefined Styles_common_footer__1rPoh"><div class="footer-content-container Styles_content__0jn9p"><div><p><span class="copy-left"></span><span>2023<!-- --></span><span> Vac Research</span><span> - </span><span>Vac - Communication, Privacy, Etc</span></p></div><div class="Styles_bottomPart__CsMh_"><div class="Styles_socialMedia__AmAKz "><span><a href="https://twitter.com/vacp2p" class="button"><svg xmlns="http://www.w3.org/2000/svg" width="30" viewBox="0 0 543.684 543.684" xml:space="preserve"><path d="M527.657 106.697a231.362 231.362 0 0 1-8.041 2.191c-16.384 4.137-17.89-1.322-6.028-13.366a109.306 109.306 0 0 0 14.082-17.607c9.137-14.217 1.212-20.417-14.333-13.776a224.853 224.853 0 0 1-16.897 6.432c-16.017 5.379-38.746-2.735-53.018-11.787-18.018-11.426-38.495-17.136-61.438-17.136-32.137 0-59.529 11.334-82.192 33.984-22.656 22.662-33.99 50.062-33.99 82.191 0 4.394.251 8.855.747 13.378.814 7.362-11.585 12.699-28.317 10.336-36.194-5.11-70.582-16.077-103.171-32.889-32.32-16.671-60.845-37.65-85.57-62.938-11.819-12.086-27.804-11.045-32.217 5.27-2.644 9.78-3.959 19.951-3.959 30.515 0 19.908 4.675 38.372 14.027 55.392 4.651 8.47 10.098 16.138 16.353 22.999 10.521 11.549 8.911 18.25-5.734 14.144-14.639-4.106-25.367-10.202-25.367-9.804v.722c0 28.048 8.807 52.693 26.432 73.911 10.857 13.072 23.47 23.17 37.834 30.282 15.147 7.503 22.203 11.688 13.733 12.784-5.11.661-10.251.991-15.422.991-3.5 0-7.172-.159-11.003-.483-6.059-.514-7.148 12.111 2.038 26.298 7.301 11.273 16.646 21.193 28.03 29.762 11.579 8.721 24.058 14.981 37.417 18.794 16.255 4.633 19.517 13.073 5.024 21.763-35.863 21.519-75.551 32.277-119.058 32.277-4.902 0-9.578-.11-14.045-.324-7.754-.373-2.552 6.456 12.417 14.296 46.775 24.499 97.43 36.738 151.972 36.738 41.237 0 79.964-6.529 116.176-19.596 36.199-13.066 67.136-30.576 92.791-52.516 25.655-21.94 47.779-47.173 66.365-75.711 18.581-28.537 32.424-58.33 41.543-89.376 9.106-31.053 13.666-62.167 13.666-93.342 0-2.809-.024-5.331-.067-7.552-.086-4.174 10.955-15.472 23.28-27.032a242.397 242.397 0 0 0 15.937-16.444c11.179-12.688 6.228-18.502-9.997-13.771z"></path></svg></a></span><span><a href="https://discord.gg/PQFdubGt6d" class="button"><svg width="30" viewBox="0 0 71 55" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#discord_svg__a)"><path d="M60.105 4.898A58.55 58.55 0 0 0 45.653.415a.22.22 0 0 0-.233.11 40.784 40.784 0 0 0-1.8 3.697c-5.456-.817-10.886-.817-16.23 0-.485-1.164-1.201-2.587-1.828-3.697a.228.228 0 0 0-.233-.11 58.386 58.386 0 0 0-14.451 4.483.207.207 0 0 0-.095.082C1.578 18.73-.944 32.144.293 45.39a.244.244 0 0 0 .093.167c6.073 4.46 11.955 7.167 17.729 8.962a.23.23 0 0 0 .249-.082 42.08 42.08 0 0 0 3.627-5.9.225.225 0 0 0-.123-.312 38.772 38.772 0 0 1-5.539-2.64.228.228 0 0 1-.022-.378c.372-.279.744-.569 1.1-.862a.22.22 0 0 1 .23-.03c11.619 5.304 24.198 5.304 35.68 0a.219.219 0 0 1 .233.027c.356.293.728.586 1.103.865a.228.228 0 0 1-.02.378 36.384 36.384 0 0 1-5.54 2.637.227.227 0 0 0-.121.315 47.249 47.249 0 0 0 3.624 5.897.225.225 0 0 0 .249.084c5.801-1.794 11.684-4.502 17.757-8.961a.228.228 0 0 0 .092-.164c1.48-15.315-2.48-28.618-10.497-40.412a.18.18 0 0 0-.093-.084Zm-36.38 32.427c-3.497 0-6.38-3.211-6.38-7.156 0-3.944 2.827-7.156 6.38-7.156 3.583 0 6.438 3.24 6.382 7.156 0 3.945-2.827 7.156-6.381 7.156Zm23.593 0c-3.498 0-6.38-3.211-6.38-7.156 0-3.944 2.826-7.156 6.38-7.156 3.582 0 6.437 3.24 6.38 7.156 0 3.945-2.798 7.156-6.38 7.156Z" fill="#23272A"></path></g><defs><clipPath id="discord_svg__a"><path fill="#fff" d="M0 0h71v55H0z"></path></clipPath></defs></svg></a></span><span><a href="https://github.com/vacp2p" class="button"><svg width="30" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M512 0C229.12 0 0 229.12 0 512c0 226.56 146.56 417.92 350.08 485.76 25.6 4.48 35.2-10.88 35.2-24.32 0-12.16-.64-52.48-.64-95.36-128.64 23.68-161.92-31.36-172.16-60.16-5.76-14.72-30.72-60.16-52.48-72.32-17.92-9.6-43.52-33.28-.64-33.92 40.32-.64 69.12 37.12 78.72 52.48 46.08 77.44 119.68 55.68 149.12 42.24 4.48-33.28 17.92-55.68 32.64-68.48-113.92-12.8-232.96-56.96-232.96-252.8 0-55.68 19.84-101.76 52.48-137.6-5.12-12.8-23.04-65.28 5.12-135.68 0 0 42.88-13.44 140.8 52.48 40.96-11.52 84.48-17.28 128-17.28 43.52 0 87.04 5.76 128 17.28 97.92-66.56 140.8-52.48 140.8-52.48 28.16 70.4 10.24 122.88 5.12 135.68 32.64 35.84 52.48 81.28 52.48 137.6 0 196.48-119.68 240-233.6 252.8 18.56 16 34.56 46.72 34.56 94.72 0 68.48-.64 123.52-.64 140.8 0 13.44 9.6 29.44 35.2 24.32C877.44 929.92 1024 737.92 1024 512 1024 229.12 794.88 0 512 0Z" fill="#1B1F23"></path></svg></a></span></div><nav class="Styles_legal__0ciDG"><a title="Privacy Policy" href="/privacy-policy">Privacy Policy</a></nav></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"markdown":{"content":"\n[Waku v2](https://rfc.vac.dev/spec/10/) enables secure, privacy preserving communication using a set of modular P2P protocols.\nWaku v2 also aims at protecting the user's anonymity.\nThis post is the first in a series about Waku v2 security, privacy, and anonymity.\nThe goal is to eventually have a full privacy and anonymity analysis for each of the Waku v2 protocols, as well as covering the interactions of various Waku v2 protocols.\nThis provides transparency with respect to Waku's current privacy and anonymity guarantees, and also identifies weak points that we have to address.\n\nIn this post, we first give an informal description of security, privacy and anonymity in the context of Waku v2.\nFor each definition, we summarize Waku's current guarantees regarding the respective property.\nWe also provide attacker models, an attack-based threat model, and a first anonymity analysis of [Waku v2 relay](https://rfc.vac.dev/spec/11/) within the respective models.\n\nWaku comprises many protocols that can be combined in a modular way.\nFor our privacy and anonymity analysis, we start with the relay protocol because it is at the core of Waku v2 enabling Waku's publish subscribe approach to P2P messaging.\nIn its current form, Waku relay is a minor extension of [libp2p GossipSub](https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/README.md).\n\n![Figure 1: The Waku v2 relay mesh is based on the [GossipSub mesh](https://docs.libp2p.io/concepts/publish-subscribe#types-of-peering)](/img/libp2p_gossipsub_types_of_peering.png)\n\n## Informal Definitions: Security, Privacy, and Anonymity\n\nThe concepts of security, privacy, and anonymity are linked and have quite a bit of overlap.\n\n### Security\n\nOf the three, [Security](https://en.wikipedia.org/wiki/Information_security) has the clearest agreed upon definition,\nat least regarding its key concepts: *confidentiality*, *integrity*, and *availability*.\n\n* confidentiality:  data is not disclosed to unauthorized entities.\n* integrity: data is not modified by unauthorized entities.\n* availability: data is available, i.e. accessible by authorized entities.\n\nWhile these are the key concepts, the definition of information security has been extended over time including further concepts,\ne.g. [authentication](https://en.wikipedia.org/wiki/Authentication) and [non-repudiation](https://en.wikipedia.org/wiki/Non-repudiation).\nWe might cover these in future posts.\n\n### Privacy\n\nPrivacy allows users to choose which data and information\n\n* they want to share\n* and with whom they want to share it.\n\nThis includes data and information that is associated with and/or generated by users.\nProtected data also comprises metadata that might be generated without users being aware of it.\nThis means, no further information about the sender or the message is leaked.\nMetadata that is protected as part of the privacy-preserving property does not cover protecting the identities of sender and receiver.\nIdentities are protected by the [anonymity property](#anonymity).\n\nOften privacy is realized by the confidentiality property of security.\nThis neither makes privacy and security the same, nor the one a sub category of the other.\nWhile security is abstract itself (its properties can be realized in various ways), privacy lives on a more abstract level using security properties.\nPrivacy typically does not use integrity and availability.\nAn adversary who has no access to the private data, because the message has been encrypted, could still alter the message.\n\nWaku offers confidentiality via secure channels set up with the help of the [Noise Protocol Framework](https://noiseprotocol.org/).\nUsing these secure channels, message content is only disclosed to the intended receivers.\nThey also provide good metadata protection properties.\nHowever, we do not have a metadata protection analysis as of yet,\nwhich is part of our privacy/anonymity roadmap.\n\n\n### Anonymity\n\nPrivacy and anonymity are closely linked.\nBoth the identity of a user and data that allows inferring a user's identity should be part of the privacy policy.\nFor the purpose of analysis, we want to have a clearer separation between these concepts.\n\nWe define anonymity as *unlinkablity of users' identities and their shared data and/or actions*.\n\nWe subdivide anonymity into *receiver anonymity* and *sender anonymity*.\n\n#### Receiver Anonymity\n\nWe define receiver anonymity as *unlinkability of users' identities and the data they receive and/or related actions*.\nThe data transmitted via Waku relay must be a [Waku message](https://rfc.vac.dev/spec/14/), which contains a content topic field.\nBecause each message is associated with a content topic, and each receiver is interested in messages with specific content topics,\nreceiver anonymity in the context of Waku corresponds to *subscriber-topic unlinkability*.\nAn example for the \"action\" part of our receiver anonymity definition is subscribing to a specific topic.\n\nThe Waku message's content topic is not related to the libp2p pubsub topic.\nFor now, Waku uses a single libp2p pubsub topic, which means messages are propagated via a single mesh of peers.\nWith this, the receiver discloses its participation in Waku on the gossipsub layer.\nWe will leave the analysis of libp2p gossipsub to a future article within this series, and only provide a few hints and pointers here.\n\nWaku offers k-anonymity regarding content topic interest in the global adversary model.\n[K-anonymity](https://en.wikipedia.org/wiki/K-anonymity) in the context of Waku means an attacker can link receivers to content topics with a maximum certainty of $1/k$.\nThe larger $k$, the less certainty the attacker gains.\nReceivers basically hide in a pool of $k$ content topics, any subset of which could be topics they subscribed to.\nThe attacker does not know which of those the receiver actually subscribed to,\nand the receiver enjoys [plausible deniability](https://en.wikipedia.org/wiki/Plausible_deniability#Use_in_cryptography) regarding content topic subscription.\nAssuming there are $n$ Waku content topics, a receiver has $n$-anonymity with respect to association to a specific content topic.\n\nTechnically, Waku allows distributing messages over several libp2p pubsub topics.\nThis yields $k$-anonymity, assuming $k$ content topics share the same pubsub topic.\nHowever, if done wrongly, such sharding of pubsub topics can breach anonymity.\nA formal specification of anonymity-preserving topic sharding building on the concepts of [partitioned topics](https://specs.status.im/spec/10#partitioned-topic) is part of our roadmap.\n\nAlso, Waku is not directly concerned with 1:1 communication, so for this post, 1:1 communication is out of scope.\nChannels for 1:1 communication can be implemented on top of Waku relay.\nIn the future, a 1:1 communication protocol might be added to Waku.\nSimilar to topic sharding, it would maintain receiver anonymity leveraging [partitioned topics](https://specs.status.im/spec/10#partitioned-topic).\n\n#### Sender Anonymity\n\nWe define sender anonymity as *unlinkability of users' identities and the data they send and/or related actions*.\nBecause the data in the context of Waku is Waku messages, sender anonymity corresponds to *sender-message unlinkability*.\n\nIn summary, Waku offers weak sender anonymity because of [Waku's strict no sign policy](https://rfc.vac.dev/spec/11/#signature-policy),\nwhich has its origins in the [Ethereum consensus specs](https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/p2p-interface.md#why-are-we-using-the-strictnosign-signature-policy).\n[17/WAKU-RLN-RELAY](https://rfc.vac.dev/spec/17/) and [18/WAKU2-SWAP](https://rfc.vac.dev/spec/18/) mitigate replay and injection attacks.\n\nWaku currently does not offer sender anonymity in stronger attacker models, as well as cannot protect against targeted attacks in weaker attacker models like the single or multi node attacker.\nWe will cover this in more detail in later sections.\n\n### Anonymity Trilemma\n\n[The Anonymity trilemma](https://freedom.cs.purdue.edu/projects/trilemma.html) states that only two out of *strong anonymity*, *low bandwidth*, and *low latency* can be guaranteed in the global on-net attacker model.\nWaku's goal, being a modular set of protocols, is to offer any combination of two out of these three properties, as well as blends.\nAn example for blending is an adjustable number of pubsub topics and peers in the respective pubsub topic mesh; this allows tuning the trade-off between anonymity and bandwidth.\n\n![Figure 2: Anonymity Trilemma: pick two. ](/img/anonymity_trilemma.svg)\n\nA fourth factor that influences [the anonymity trilemma](https://freedom.cs.purdue.edu/projects/trilemma.html) is *frequency and patterns* of messages.\nThe more messages there are, and the more randomly distributed they are, the better the anonymity protection offered by a given anonymous communication protocol.\nSo, incentivising users to use the protocol, for instance by lowering entry barriers, helps protecting the anonymity of all users.\nThe frequency/patterns factor is also related to the above described k-anonymity.\n\n### Censorship Resistance\n\nAnother security related property that Waku aims to offer is censorship resistance.\nCensorship resistance guarantees that users can participate even if an attacker tries to deny them access.\nSo, censorship resistance ties into the availability aspect of security.\nIn the context of Waku that means users should be able to send messages as well as receive all messages they are interested in,\neven if an attacker tries to prevent them from disseminating messages or tries to deny them access to messages.\n\nCurrently, Waku only guarantees censorship resistance in the weak single node attacker model.\nWhile currently employed secure channels mitigate targeted censorship, e.g. blocking specific content topics,\ngeneral censorship resistance in strong attacker models is part of our roadmap.\nAmong other options, we will investigate [Pluggable Transports](https://www.pluggabletransports.info/about/) in future articles.\n\n## Attacker Types\n\nThe following lists various attacker types with varying degrees of power.\nThe more power an attacker has, the more difficult it is to gain the respective attacker position.\n\nEach attacker type comes in a passive and an active variant.\nWhile a passive attacker can stay hidden and is not suspicious,\nthe respective active attacker has more (or at least the same) deanonymization power.\n\nWe also distinguish between internal and external attackers.\n\n### Internal\n\nWith respect to Waku relay, an internal attacker participates in the same pubsub topic as its victims.\nWithout additional measures on higher layer protocols, access to an internal position is easy to get.\n\n#### Single Node\n\nThis attacker controls a single node.\nBecause this position corresponds to normal usage of Waku relay, it is trivial to obtain.\n\n#### Multi Node\n\nThis attacker controls several nodes. We assume a smaller static number of controlled nodes.\nThe multi node position can be achieved relatively easily by setting up multiple nodes.\nBotnets might be leveraged to increase the number of available hosts.\nMulti node attackers could use [Sybil attacks](https://en.wikipedia.org/wiki/Sybil_attack) to increase the number of controlled nodes.\nA countermeasure is for nodes to only accept libp2p gossipsub graft requests from peers with different IP addresses, or even different subnets.\n\n#### Linearly Scaling Nodes\n\nThis attacker controls a number of nodes that scales linearly with the number of nodes in the network.\nThis attacker is especially interesting to investigate in the context of DHT security,\nwhich Waku uses for ambient peer discovery.\n\n### External\n\nAn external attacker can only see encrypted traffic (protected by a secure channel set up with [Noise](https://rfc.vac.dev/spec/35/)).\nBecause an internal position can be easily obtained,\nin practice external attackers would mount combined attacks that leverage both internal an external attacks.\nWe cover this more below when describing attacks.\n\n#### Local\n\nA local attacker has access to communication links in a local network segment.\nThis could be a rogue access point (with routing capability).\n\n#### AS\n\nAn AS attacker controls a single AS (autonomous system).\nA passive AS attacker can listen to traffic on arbitrary links within the AS.\nAn active AS attacker can drop, inject, and alter traffic on arbitrary links within the AS.\n\nIn practice, a malicious ISP would be considered as an AS attacker.\nA malicious ISP could also easily setup a set of nodes at specific points in the network,\ngaining internal attack power similar to a strong multi node attacker.\n\n#### Global On-Net\n\nA global on-net attacker has complete overview over the whole network.\nA passive global attacker can listen to traffic on all links,\nwhile the active global attacker basically carries the traffic: it can freely drop, inject, and alter traffic at all positions in the network.\nThis basically corresponds to the [Dolev-Yao model](https://en.wikipedia.org/wiki/Dolev%E2%80%93Yao_model).\n\nAn entity with this power would, in practice, also have the power of the internal linearly scaling nodes attacker.\n\n## Attack-based Threat Analysis\n\nThe following lists various attacks including the weakest attacker model in which the attack can be successfully performed.\nThe respective attack can be performed in all stronger attacker models as well.\n\nAn attack is considered more powerful if it can be successfully performed in a weaker attacker model.\n\nIf not stated otherwise, we look at these attacks with respect to their capability to deanonymize the message sender.\n\n### Scope\n\nIn this post, we introduce a simple tightly scoped threat model for Waku v2 Relay, which will be extended in the course of this article series.\n\nIn this first post, we will look at the relay protocol in isolation.\nEven though many threats arise from layers Waku relay is based on, and layers that in turn live on top of relay,\nwe want to first look at relay in isolation because it is at the core of Waku v2.\nAddressing and trying to solve all security issues of a complex system at once is an overwhelming task, which is why we focus on the soundness of relay first.\n\nThis also goes well with the modular design philosophy of Waku v2, as layers of varying levels of security guarantees can be built on top of relay, all of which can relay on the guarantees that Waku provides.\nInstead of looking at a multiplicative explosion of possible interactions, we look at the core in this article, and cover the most relevant combinations in future posts.\n\nFurther restricting the scope, we will look at the data field of a relay message as a black box.\nIn a second article on Waku v2 relay, we will look into the data field, which according to the [specification of Waku v2 relay](https://rfc.vac.dev/spec/11/#message-fields) must be a [Waku v2 message](https://rfc.vac.dev/spec/14/).\nWe only consider messages with version field `2`, which indicates that the payload has to be encoded using [35/WAKU2-NOISE](https://rfc.vac.dev/spec/35/).\n\n### Prerequisite: Get a Specific Position in the Network\n\nSome attacks require the attacker node(s) to be in a specific position in the network.\nIn most cases, this corresponds to trying to get into the mesh peer list for the desired pubsub topic of the victim node.\n\nIn libp2p gossipsub, and by extension Waku v2 relay, nodes can simply send a graft message for the desired topic to the victim node.\nIf the victim node still has open slots, the attacker gets the desired position.\nThis only requires the attacker to know the gossipsub multiaddress of the victim node.\n\nA linearly scaling nodes attacker can leverage DHT based discovery systems to boost the probability of malicious nodes being returned, which in turn significantly increases the probability of attacker nodes ending up in the peer lists of victim nodes.\n[Waku v2 discv5](https://vac.dev/wakuv2-apd) will employ countermeasures that mitigate the amplifying effect this attacker type can achieve.\n\n### Replay Attack\n\nIn the scope we defined above, Waku v2 is resilient against replay attacks.\nGossipSub nodes, and by extension Waku relay nodes, feature a `seen` cache, and only relay messages they have not seen before.\nFurther, replay attacks will be punished by [RLN](https://rfc.vac.dev/spec/17/) and [SWAP](https://rfc.vac.dev/spec/18/).\n\n### Neighbourhood Surveillance\n\nThis attack can be performed by a single node attacker that is connected to all peers of the victim node $v$ with respect to a specific topic mesh. \nThe attacker also has to be connected to $v$.\nIn this position, the attacker will receive messages $m_v$ sent by $v$ both on the direct path from $v$, and on indirect paths relayed by peers of $v$.\nIt will also receive messages $m_x$ that are not sent by $v$. These messages $m_x$ are relayed by both $v$ and the peers of $v$.\nMessages that are received (significantly) faster from $v$ than from any other of $v$'s peers are very likely messages that $v$ sent,\nbecause for these messages the attacker is one hop closer to the source.\n\nThe attacker can (periodically) measure latency between itself and $v$, and between itself and the peers of $v$ to get more accurate estimates for the expected timings.\nAn AS attacker (and if the topology allows, even a local attacker) could also learn the latency between $v$ and its well-behaving peers.\nAn active AS attacker could also increase the latency between $v$ and its peers to make the timing differences more prominent.\nThis, however, might lead to $v$ switching to other peers.\n\nThis attack cannot (reliably) distinguish messages $m_v$ sent by $v$ from messages $m_y$ relayed by peers of $v$ the attacker is not connected to.\nStill, there are hop-count variations that might be leveraged.\nMessages $m_v$ always have a hop-count of 1 on the path from $v$ to the attacker, while all other paths are longer.\nMessages $m_y$ might have the same hop-count on the path from $v$ as well as on other paths.\n\n### Controlled Neighbourhood\n\nIf a multi node attacker manages to control all peers of the victim node, it can trivially tell which messages originated from $v$.\n\n### Observing Messages\n\nIf Waku relay was not protected with Noise, the AS attacker could simply check for messages leaving $v$ which have not been relayed to $v$.\nThese are the messages sent by $v$.\nWaku relay protects against this attack by employing secure channels setup using Noise.\n\n### Correlation\n\nMonitoring all traffic (in an AS or globally), allows the attacker to identify traffic correlated with messages originating from $v$.\nThis (alone) does not allow an external attacker to learn which message $v$ sent, but it allows identifying the respective traffic propagating through the network.\nThe more traffic in the network, the lower the success rate of this attack.\n\nCombined with just a few nodes controlled by the attacker, the actual message associated with the correlated traffic can eventually be identified.\n\n### DoS\n\nAn active single node attacker could run a disruption attack by\n\n* (1) dropping messages that should be relayed\n* (2) flooding neighbours with bogus messages\n\nWhile (1) has a negative effect on availability, the impact is not significant.\nA linearly scaling botnet attacker, however, could significantly disrupt the network with such an attack.\n(2) is thwarted by [RLN](https://rfc.vac.dev/spec/17/).\nAlso [SWAP](https://rfc.vac.dev/spec/18/) helps mitigating DoS attacks.\n\nA local attacker can DoS Waku by dropping all Waku traffic within its controlled network segment.\nAn AS attacker can DoS Waku within its authority, while a global attacker can DoS the whole network.\nA countermeasure are censorship resistance techniques like [Pluggable Transports](https://www.pluggabletransports.info/about/).\n\n## Summary and Future Work\n\nCurrently, Waku v2 relay offers k-anonymity with respect to receiver anonymity.\nThis also includes k-anonymity towards legitimate members of the same topic.\n\nWaku v2 relay offers sender anonymity in the single node attacker model with its [strict no sign policy](https://rfc.vac.dev/spec/11/#signature-policy).\nCurrently, Waku v2 does not guarantee sender anonymity in the multi node and stronger attacker models.\nHowever, we are working on modular anonymity-preserving protocols and building blocks as part of our privacy/anonymity roadmap.\nThe goal is to allow tunable anonymity with respect to trade offs between *strong anonymity*, *low bandwidth*, and *low latency*.\nAll of these cannot be fully guaranteed as the [the anonymity trilemma](https://freedom.cs.purdue.edu/projects/trilemma.html) states.\nSome applications have specific requirements, e.g. low latency, which require a compromise on anonymity.\nAnonymity-preserving mechanisms we plan to investigate and eventually specify as pluggable anonymity protocols for Waku comprise\n\n* [Dandelion++](https://arxiv.org/abs/1805.11060) for lightweight anonymity;\n* [onion routing](https://en.wikipedia.org/wiki/Onion_routing) as a building block adding a low latency anonymization layer;\n* [a mix network](https://en.wikipedia.org/wiki/Mix_network) for providing strong anonymity (on top of onion routing) even in the strongest attacker model at the cost of higher latency.\n\nThese pluggable anonymity-preserving protocols will form a sub-set of the Waku v2 protocol set.\nAs an intermediate step, we might directly employ Tor for onion-routing, and [Nym](https://nymtech.net/) as a mix-net layer.\n\nIn future research log posts, we will cover further Waku v2 protocols and identify anonymity problems that will be added to our roadmap.\nThese protocols comprise\n\n* [13/WAKU2-STORE](https://rfc.vac.dev/spec/13/), which can violate receiver anonymity as it allows filtering by content topic.\n  A countermeasure is using the content topic exclusively for local filters.\n* [12/WAKU2-FILTER](https://rfc.vac.dev/spec/12/), which discloses nodes' interest in topics;\n* [19/WAKU2-LIGHTPUSH](https://rfc.vac.dev/spec/19/), which also discloses nodes' interest in topics and links the lightpush client as the sender of a message to the lightpush service node;\n* [21/WAKU2-FTSTORE](https://rfc.vac.dev/spec/21/), which discloses nodes' interest in specific time ranges allowing to infer information like online times.\n\nWhile these protocols are not necessary for the operation of Waku v2, and can be seen as pluggable features,\nwe aim to provide alternatives without the cost of lowering the anonymity level.\n\n## References\n\n* [10/WAKU2](https://rfc.vac.dev/spec/10/)\n* [11/WAKU2-RELAY](https://rfc.vac.dev/spec/11/)\n* [libp2p GossipSub](https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/README.md)\n* [Security](https://en.wikipedia.org/wiki/Information_security)\n* [Authentication](https://en.wikipedia.org/wiki/Authentication)\n* [Non-repudiation](https://en.wikipedia.org/wiki/Non-repudiation)\n* [Noise Protocol Framework](https://noiseprotocol.org/)\n* [plausible deniability](https://en.wikipedia.org/wiki/Plausible_deniability#Use_in_cryptography)\n* [Waku v2 message](https://rfc.vac.dev/spec/14/)\n* [partitioned topics](https://specs.status.im/spec/10#partitioned-topic)\n* [Sybil attack](https://en.wikipedia.org/wiki/Sybil_attack)\n* [Dolev-Yao model](https://en.wikipedia.org/wiki/Dolev%E2%80%93Yao_model)\n* [35/WAKU2-NOISE](https://rfc.vac.dev/spec/35/)\n* [33/WAKU2-DISCV5](https://vac.dev/wakuv2-apd)\n* [strict no sign policy](https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/p2p-interface.md#why-are-we-using-the-strictnosign-signature-policy)\n* [Waku v2 strict no sign policy](https://rfc.vac.dev/spec/11/#signature-policy)\n* [17/WAKU-RLN-RELAY](https://rfc.vac.dev/spec/17/)\n* [anonymity trilemma](https://freedom.cs.purdue.edu/projects/trilemma.html)\n* [18/WAKU2-SWAP](https://rfc.vac.dev/spec/18/)\n* [Pluggable Transports](https://www.pluggabletransports.info/about/)\n* [Nym](https://nymtech.net/)\n* [Dandelion++](https://arxiv.org/abs/1805.11060)\n* [13/WAKU2-STORE](https://rfc.vac.dev/spec/13/)\n* [12/WAKU2-FILTER](https://rfc.vac.dev/spec/12/)\n* [19/WAKU2-LIGHTPUSH](https://rfc.vac.dev/spec/19/)\n* [21/WAKU2-FTSTORE](https://rfc.vac.dev/spec/21/)\n\n\n","metadata":{"layout":"post","name":"Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay","title":"Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay","date":"2022-07-22T10:00:00.000Z","author":"kaiserd","published":true,"permalink":"/wakuv2-relay-anon","categories":"research","summary":"Introducing a basic threat model and privacy/anonymity analysis for the Waku v2 relay protocol.","image":"/img/anonymity_trilemma.svg","discuss":"https://forum.vac.dev/t/discussion-waku-privacy-and-anonymity-analysis/149","_includes":["math"]},"toc":[{"content":"Informal Definitions: Security, Privacy, and Anonymity","slug":"informal-definitions-security-privacy-and-anonymity","lvl":2,"i":0,"seen":0},{"content":"Security","slug":"security","lvl":3,"i":1,"seen":0},{"content":"Privacy","slug":"privacy","lvl":3,"i":2,"seen":0},{"content":"Anonymity","slug":"anonymity","lvl":3,"i":3,"seen":0},{"content":"Receiver Anonymity","slug":"receiver-anonymity","lvl":4,"i":4,"seen":0},{"content":"Sender Anonymity","slug":"sender-anonymity","lvl":4,"i":5,"seen":0},{"content":"Anonymity Trilemma","slug":"anonymity-trilemma","lvl":3,"i":6,"seen":0},{"content":"Censorship Resistance","slug":"censorship-resistance","lvl":3,"i":7,"seen":0},{"content":"Attacker Types","slug":"attacker-types","lvl":2,"i":8,"seen":0},{"content":"Internal","slug":"internal","lvl":3,"i":9,"seen":0},{"content":"Single Node","slug":"single-node","lvl":4,"i":10,"seen":0},{"content":"Multi Node","slug":"multi-node","lvl":4,"i":11,"seen":0},{"content":"Linearly Scaling Nodes","slug":"linearly-scaling-nodes","lvl":4,"i":12,"seen":0},{"content":"External","slug":"external","lvl":3,"i":13,"seen":0},{"content":"Local","slug":"local","lvl":4,"i":14,"seen":0},{"content":"AS","slug":"as","lvl":4,"i":15,"seen":0},{"content":"Global On-Net","slug":"global-on-net","lvl":4,"i":16,"seen":0},{"content":"Attack-based Threat Analysis","slug":"attack-based-threat-analysis","lvl":2,"i":17,"seen":0},{"content":"Scope","slug":"scope","lvl":3,"i":18,"seen":0},{"content":"Prerequisite: Get a Specific Position in the Network","slug":"prerequisite-get-a-specific-position-in-the-network","lvl":3,"i":19,"seen":0},{"content":"Replay Attack","slug":"replay-attack","lvl":3,"i":20,"seen":0},{"content":"Neighbourhood Surveillance","slug":"neighbourhood-surveillance","lvl":3,"i":21,"seen":0},{"content":"Controlled Neighbourhood","slug":"controlled-neighbourhood","lvl":3,"i":22,"seen":0},{"content":"Observing Messages","slug":"observing-messages","lvl":3,"i":23,"seen":0},{"content":"Correlation","slug":"correlation","lvl":3,"i":24,"seen":0},{"content":"DoS","slug":"do-s","lvl":3,"i":25,"seen":0},{"content":"Summary and Future Work","slug":"summary-and-future-work","lvl":2,"i":26,"seen":0},{"content":"References","slug":"references","lvl":2,"i":27,"seen":0}]},"navProps":{"metadata":{"published":true,"title":"Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay","layout":"post","name":"Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay","date":"2022-07-22T10:00:00.000Z","author":"kaiserd","permalink":"/wakuv2-relay-anon","categories":"research","summary":"Introducing a basic threat model and privacy/anonymity analysis for the Waku v2 relay protocol.","image":"img/anonymity_trilemma.svg","discuss":"https://forum.vac.dev/t/discussion-waku-privacy-and-anonymity-analysis/149","_includes":["math"]},"navOrder":1658484000,"localPath":"research/2022-07-22-relay-anonymity.md","path":["wakuv2-relay-anon"],"children":[],"isDir":false},"routeParams":{"path":["wakuv2-relay-anon"]}},"__N_SSG":true},"page":"/[[...path]]","query":{"path":["wakuv2-relay-anon"]},"buildId":"-5vfLOflCSkQPJRugO7ZO","isFallback":false,"dynamicIds":[9440],"gsp":true,"scriptLoader":[]}</script></body></html>